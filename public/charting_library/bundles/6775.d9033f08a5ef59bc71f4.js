(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[6775],{316167:(t,e,o)=>{"use strict";o.d(e,{blendColors:()=>a,generateBlendColors:()=>l});var r=o(283873),i=o(154834),s=o(724377);const a=(t,e)=>(0,s.rgbaToString)((0,s.blendRgba)((0,s.parseRgba)(t),(0,s.parseRgba)(e)));function l(t,e){const o=(0,i.default)(t),s=Object.keys(o);for(const i of s){const s=t[i];(0,r.default)(s)?o[i]=a(s,e):o[i]=l(s,e)}return o}},734602:(t,e,o)=>{"use strict";o.d(e,{useGlobalCloseOnScrollAndCustomEvents:()=>s});var r=o(50959),i=o(370981);function s(t){(0,r.useEffect)((()=>{return t=a,window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t);var t}),[]),(0,r.useEffect)((()=>{if(t.length)return function(t,e){for(const o of t)o.subscribe(null,e);return()=>{for(const o of t)o.unsubscribe(null,e)}}(t,a)}),t)}function a(){(0,i.globalCloseMenu)()}},914090:(t,e,o)=>{"use strict";o.d(e,{TooltipPopup:()=>n});var r=o(50959),i=o(624216),s=o(370981),a=o(180185),l=o(144421);const n=(0,r.forwardRef)(((t,e)=>{const{onClose:o,onForceClose:n,onClickOutside:d,className:c,...h}=t,u=(0,r.useRef)(null);(0,r.useEffect)((()=>(s.globalCloseDelegate.subscribe(null,n),()=>{s.globalCloseDelegate.unsubscribe(null,n)})),[n]);const p=(0,r.useCallback)((e=>{t.onKeyDown?.(e),27===(0,a.hashFromEvent)(e)&&(e.preventDefault(),n())}),[n]),_=(0,r.useCallback)((()=>{u.current&&u.current.focus({preventScroll:!0})}),[]);return r.createElement(i.PopupMenu,{className:c,isOpened:!0,tabIndex:-1,reference:t=>{"function"==typeof e?e(t):(0,l.isObject)(e)&&(e.current=t),u.current=t},onClose:o,onClickOutside:d,onKeyDown:p,onOpen:_,...h},t.children)}));n.displayName="TooltipPopup"},879619:t=>{t.exports={title:"title-u3QJgF_p"}},729314:(t,e,o)=>{"use strict";o.d(e,{ToolWidgetMenuSummary:()=>a});var r=o(50959),i=o(497754),s=o(879619);function a(t){return r.createElement("div",{className:i(t.className,s.title)},t.children)}},171812:(t,e,o)=>{"use strict";var r;o.d(e,{TradedItemType:()=>r}),function(t){t[t.Position=0]="Position",t[t.Order=1]="Order"}(r||(r={}))},986775:(t,e,o)=>{"use strict";o.d(e,{TradedGroupBase:()=>lo,isTradedGroupCustomSource:()=>eo});var r=o(154834),i=o(650151),s=o(609838),a=o(119131),l=o(587060),n=o(894862),d=o(721762),c=o(171812),h=o(764146),u=o(597346),p=o(538453),_=o(360887),y=o(934722);const m=y.LineStyle.Solid,f=y.LineStyle.Dashed;var b,C,v,g=o(489891),P=o(918873),k=o(115145),T=o(621278),x=o(884684),M=o(617233),w=o(917053),S=o(721048),B=o(287104),D=o(610555),I=o(799573),L=o(887084),R=o(612930);function O(t){return t.hasOwnProperty("tp")&&t.hasOwnProperty("sl")}!function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(b||(b={})),function(t){t[t.TPSLHorizontalMargin=10]="TPSLHorizontalMargin",t[t.ConfirmHorizontalMargin=11]="ConfirmHorizontalMargin",t[t.CancelHorizontalMargin=4]="CancelHorizontalMargin",t[t.ButtonTextPadding=5]="ButtonTextPadding"}(C||(C={}));class W extends B.ItemRenderer{constructor(){super(...arguments),this._wasTPMoved=!1,this._wasSLMoved=!1}hitTest(t,e){
const{horizontalPixelRatio:o,verticalPixelRatio:r}=e,s=this.rectWithOffsets(e),a=Math.round(t.x*o),l=Math.round(t.y*r),n=a>=s.left,d=a<=s.right,c=n&&d,h=l>=s.top&&l<=s.bottom,u={cursorType:L.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:9})};if(this._data.disabled)return new x.HitTestResult(x.HitTarget.Custom,u);if(this._isPriceLineIntersected(a,l,e))return super.hitTest(t,e);if(!h||!c)return null;const p=Math.round(s.top/r),_=void 0!==this._data.callbacks.onMoveProjectionTP&&1===this._data.tp?.visibility;if(_&&a>=s.tp.left&&a<s.tp.left+s.tp.width){const t=Math.round(s.tp.left/o),e=Math.round(s.tp.width/o),r=t=>{this._data.callbacks.onMoveProjectionTP&&this._data.callbacks.onMoveProjectionTP(t),this._wasTPMoved=!0},a=()=>{this._wasTPMoved&&this._data.callbacks.onFinishMoveTP&&this._data.callbacks.onFinishMoveTP(),this._wasTPMoved=!1};return new x.HitTestResult(x.HitTarget.Custom,{...u,cursorType:L.PaneCursorType.Pointer,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:5}),pressedMouseMoveHandler:r,touchMoveHandler:r,mouseUpHandler:a,touchEndHandler:a,cancelMoveHandler:this._data.callbacks.onCancelMove,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.tp).title,rect:{x:t,y:p,w:e,h:this._height}}})}const y=s.sl.left+s.sl.width,m=void 0!==this._data.callbacks.onMoveProjectionSL&&1===this._data.sl?.visibility;if(m&&a>=s.sl.left&&a<y){const t=Math.round(s.sl.width/o),e=Math.round(s.sl.left/o),a=Math.round(s.bottom/r),l=t=>{this._data.callbacks.onMoveProjectionSL&&this._data.callbacks.onMoveProjectionSL(t),this._wasSLMoved=!0},n=()=>{this._wasSLMoved&&this._data.callbacks.onFinishMoveSL&&this._data.callbacks.onFinishMoveSL(),this._wasSLMoved=!1};let d,c;const h=this._data.callbacks.onClickSL;if(void 0!==h){const o=o=>{const r=o.clientX-o.localX,i=o.clientY-o.localY,s=new D.Point(e+r,a+i);h((o=>o.x>e&&o.x<=e+t&&o.y>p&&o.y<=a),s)};d=o,c=t=>{t.preventDefault(),o(t)}}return new x.HitTestResult(x.HitTarget.Custom,{...u,cursorType:h?L.PaneCursorType.Default:L.PaneCursorType.Pointer,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:6}),pressedMouseMoveHandler:l,touchMoveHandler:l,mouseUpHandler:n,touchEndHandler:n,clickHandler:d,tapHandler:c,cancelMoveHandler:this._data.callbacks.onCancelMove,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.sl).title,rect:{x:e,y:p,w:t,h:this._height}}})}const f=y-s.body.left<0?a>=y&&a<s.body.left:a>=s.body.right&&a<s.tp.left;if((_||m)&&f)return new x.HitTestResult(x.HitTarget.Custom,u);if(this._hasConfirmButton()&&(0,i.ensureDefined)(this._data.confirm)){const t=s.confirm.left+s.confirm.width;if(a>=s.confirm.left&&a<t){let t={};if(void 0!==this._data.callbacks.onMove){const e=t=>{this._data.callbacks.onMove&&this._data.callbacks.onMove(t),this._wasSourceMoved=!0},o=()=>{this._wasSourceMoved&&this._data.callbacks.onFinishMove&&this._data.callbacks.onFinishMove(),this._wasSourceMoved=!1};t={pressedMouseMoveHandler:e,touchMoveHandler:e,mouseUpHandler:o,touchEndHandler:o,
cancelMoveHandler:this._data.callbacks.onCancelMove}}return new x.HitTestResult(x.HitTarget.Custom,{...u,...t,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:7}),cursorType:L.PaneCursorType.Pointer,clickHandler:this._data.callbacks.onConfirm,tapHandler:this._data.callbacks.onConfirm})}const o=this._calcConfirmRect(e,s.borderWidth).offset;if(t-s.body.left<0?a>=t&&a<s.tp.left:a>=s.confirm.left-o&&a<s.confirm.left)return new x.HitTestResult(x.HitTarget.Custom,u)}const b=this._cancelButtonHittest(a,e,u);return void 0!==b?b:void 0!==this.data().informer&&a>s.informer.left&&a<s.informer.left+s.informer.width?new x.HitTestResult(x.HitTarget.Custom,{...u,cursorType:L.PaneCursorType.Default,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:9}),touchContextMenuHandler:()=>{},tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.informer).title,rect:{x:s.informer.left/o,y:p,w:s.informer.width/o,h:this._height},tooltipHideDelay:I.mobiletouch?1500:0}}):super.hitTest(t,e)}draw(t,e){if(super.draw(t,e),!this._isDataVisibleInViewport(e)||!this._data.visible)return;const o=this.rectWithOffsets(e),r=o.bottom-o.top,s=o.yMid,{horizontalPixelRatio:a,verticalPixelRatio:l}=e;void 0!==this._data.informer&&(0,R.drawExclamationIcon)({ctx:t,x:o.informer.left,y:o.yMid-9*l,horizontalPixelRatio:a,verticalPixelRatio:l}),this._isTPSLVisible()&&(0!==o.tp.width&&1===(0,i.ensureDefined)(this._data.tp).visibility&&this._drawButton(t,e,r,o.borderRadius,s,o.tp,this._data.tp,o.borderWidth),0!==o.sl.width&&1===(0,i.ensureDefined)(this._data.sl).visibility&&this._drawButton(t,e,r,o.borderRadius,s,o.sl,this._data.sl,o.borderWidth)),this._hasConfirmButton()&&this._drawButton(t,e,r,o.borderRadius,s,o.confirm,this._data.confirm,o.borderWidth),this._hasCancelButton()&&this._drawButton(t,e,r,o.borderRadius,s,o.cancel,this._data.cancel,o.borderWidth)}drawBackground(t,e){if(!this._data.visible)return;const o=this.rectWithOffsets(e);if(this._isDataVisibleInViewport(e)&&this._isTPSLVisible()){const r=[];void 0!==this._data.tp?.hintArea&&r.push(this._data.tp.hintArea),void 0!==this._data.sl?.hintArea&&r.push(this._data.sl.hintArea);for(const i of r){const r=i.rectToUp;t.fillStyle=i.backgroundColor,t.fillRect(0,r?0:o.yMid,e.bitmapSize.width,r?o.yMid:Math.round(e.bitmapSize.height-o.yMid))}}super.drawBackground(t,e)}rect(t){return super.rect(t)}rectWithOffsets(t){return super.rectWithOffsets(t)}_calculateCacheRectWithOffsets(t){let e=super._calculateCacheRectWithOffsets(t);return e={...e,tp:{...e.tp,left:this._calcCoordinateWithOffset(e.tp.left,e.tp.left+e.tp.width).left},sl:{...e.sl,left:this._calcCoordinateWithOffset(e.sl.left,e.sl.left+e.sl.width).left}},void 0!==e.confirm&&(e.confirm={...e.confirm,left:this._calcCoordinateWithOffset(e.confirm.left,e.confirm.left+e.confirm.width).left}),void 0!==e.cancel&&(e.cancel={...e.cancel,left:this._calcCoordinateWithOffset(e.cancel.left,e.cancel.left+e.cancel.width).left}),e}_calculateCacheRect(t){
const e=super._calculateCacheRect(t),{horizontalPixelRatio:o}=t,r=this._calcTPSLRect(t,e.borderWidth),i=this._calcConfirmRect(t,e.borderWidth),s=this._calcCancelRect(t,e.borderWidth);let a=0,l=0;const n=this._data.bodyAlignment===w.TradedGroupHorizontalAlignment.Left;n?(l=e.body.right+r.offset,a=l+r.tp-(r.tp>0?e.borderWidth:0)):(a=e.body.left-r.offset-r.sl,l=a-(r.tp>0?r.tp-e.borderWidth:0));let d=0;i.confirm>0&&(d=n?a+r.sl+i.offset:l-i.confirm-i.offset-e.borderWidth);let c=0;s.width>0&&(c=n?d+s.offset+s.width:d-s.offset-s.width);let h=c||d||l||a||e.qty.left,u=e.right;return n&&(h=e.left,s.width>0?u=c+s.width:i.confirm>0?u=d+i.confirm:a>0&&(u=a+r.sl)),n||void 0===this.data().informer||(h=h-e.informer.width-5*o,e.informer={width:e?.informer.width,left:h}),{...e,left:h,right:u,tp:{width:r.tp,left:l},sl:{width:r.sl,left:a},confirm:{width:i.confirm,left:d},cancel:{width:s.width,left:c}}}_drawLine(t,e){if(!this._data.callbacks.onFinishMoveSL&&!this._data.callbacks.onFinishMoveTP)return void super._drawLine(t,e);const o=this.rectWithOffsets(e),r=e.bitmapSize.width;if(t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*e.horizontalPixelRatio)),(0,M.setLineStyle)(t,this._data.line.style),(0,M.drawHorizontalLine)(t,o.yMid,o.body.right,r),this._data.line.extend)(0,M.drawHorizontalLine)(t,o.yMid,0,o.body.left);else{const e=1===this._data.tp?.visibility,r=1===this._data.sl?.visibility;if(e||r){const e=r?o.sl.left+o.sl.width:o.tp.left+o.tp.width;(0,M.drawHorizontalLine)(t,o.yMid,e,o.body.left)}if(this._hasConfirmButton()){const e=o.confirm.left+o.confirm.width;(0,M.drawHorizontalLine)(t,o.yMid,e,o.body.left)}}void 0!==this._data.informer&&(0,R.drawErrorNotificationBackdrop)({ctx:t,x:0,y:o.yMid,w:r,h:20,horizontalPixelRatio:e.horizontalPixelRatio,verticalPixelRatio:e.verticalPixelRatio}),t.restore()}_calcAllWidth(t,e,o,r,i,s){const a=super._calcAllWidth(t,e,o,r,i,s);if(!this._data.tp&&!this._data.sl&&!this._hasConfirmButton())return a;const l=this._calcTPSLRect(t,s),n=this._calcConfirmRect(t,s),d=this._calcCancelRect(t,s);return a+l.tp+l.sl+l.offset+n.confirm+n.offset+d.width+d.offset}_calcConfirmRect(t,e){if(!this._hasConfirmButton())return{confirm:0,offset:0};const{horizontalPixelRatio:o}=t,r=this._textWidth(this._ctxInternal,(0,i.ensureDefined)(this._data.confirm).text);return{confirm:Math.round(r*o),offset:Math.round(10*o)}}_calcCancelRect(t,e){if(!this._hasCancelButton())return{width:0,offset:0};const{horizontalPixelRatio:o}=t,r=2*e,i=this._textWidth(this._ctxInternal,"Cancel"),s=Math.round(4*o),a=5*o;return{width:Math.round(i*o)+r+a,offset:s}}_calcTPSLRect(t,e){const{horizontalPixelRatio:o}=t,r=2*e,i=this._textWidth(this._ctxInternal,void 0!==this._data.tp?this._data.tp.text:""),s=Math.round(i*o)+(i&&r),a=this._textWidth(this._ctxInternal,void 0!==this._data.sl?this._data.sl.text:""),l=Math.round(a*o)+(a&&r);return{tp:s,sl:l,offset:l>0||s>0?Math.round(10*o):0}}_drawButton(t,e,o,r,i,s,a,l){if(void 0===a)return;const n=this.rectWithOffsets(e);(0,
M.drawRoundRectWithInnerBorder)(t,s.left,n.top,s.width,o,a.backgroundColor,r),a.active.visible&&(0,M.drawRoundRectWithInnerBorder)(t,s.left,n.top,s.width,o,a.active.backgroundColor,r);const d=a.active.visible&&void 0!==a.active.borderColor?a.active.borderColor:a.borderColor;(0,M.drawRoundRectWithInnerBorder)(t,s.left,n.top,s.width,o,"transparent",r,l,d,a.borderStyle);const c=s.left+s.width/2;a.underlineText?this._drawUnderlinedText(t,e,a.text,a.textColor,c,i):this._drawText(t,e,a.text,a.textColor,c,i)}_isTPSLVisible(){return Boolean(this._data.tp)||Boolean(this._data.sl)}_hasConfirmButton(){return Boolean(this._data.callbacks.onConfirm&&this._data.confirm)}_hasCancelButton(){return Boolean(this._data.cancel)}_cancelButtonHittest(t,e,o){const r=this.rectWithOffsets(e);if(this._data.cancel){const i=r.cancel.left+r.cancel.width;if(t>=r.cancel.left&&t<i){let t={};if(void 0!==this._data.callbacks.onMove){const e=t=>{this._data.callbacks.onMove&&this._data.callbacks.onMove(t),this._wasSourceMoved=!0},o=()=>{this._wasSourceMoved&&this._data.callbacks.onFinishMove&&this._data.callbacks.onFinishMove(),this._wasSourceMoved=!1};t={pressedMouseMoveHandler:e,touchMoveHandler:e,mouseUpHandler:o,touchEndHandler:o,cancelMoveHandler:this._data.callbacks.onCancelMove}}return new x.HitTestResult(x.HitTarget.Custom,{...o,...t,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:8}),cursorType:L.PaneCursorType.Pointer,clickHandler:this._data.callbacks.onCancel,tapHandler:this._data.callbacks.onCancel})}const s=this._calcCancelRect(e,r.borderWidth).offset;if(i-r.body.left<0?t>=i&&t<r.tp.left:t>=r.cancel.left-s&&t<r.cancel.left)return new x.HitTestResult(x.HitTarget.Custom,o)}}}class H extends B.ItemRenderer{constructor(){super(...arguments),this._left=0}hitTest(t,e){const o=this.rectWithOffsets(e),r=Math.round(t.x*e.horizontalPixelRatio),i=Math.round(t.y*e.verticalPixelRatio),s=r>=o.left,a=r<=o.right,l=s&&a;if(!(i>=o.top&&i<=o.bottom)||!l)return null;const n={cursorType:L.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...(0,B.activeItemToHitTestResultData)({id:this._data.id})};return this._data.disabled?new x.HitTestResult(x.HitTarget.Custom,n):new x.HitTestResult(x.HitTarget.Custom,{...n,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:9})})}applyOffset(t){const e=(0,i.ensureDefined)(this._data.drawWithTPOffset?t.projItemTpLeft:this._data.drawWithSLOffset?t.projItemSlLeft:0);this._left!==e&&(this._left=e,this.clearCache()),this._offsets=t}_calculateCacheRect(t){const{horizontalPixelRatio:e}=t;let o=super._calculateCacheRect(t);const r=2*o.borderWidth,i=this._mainTextWidth(this._ctxInternal),s=this._quantityWidth(this._ctxInternal),a=Math.round(i*e+s*e)+(i&&r)+(s&&o.borderWidth),l=this._left+a,n=o.informer.width,d=5*e;if(o={...o,left:this._left,right:l,body:{...o.body,left:this._left,right:l},text:{left:this._left+o.qty.width+o.borderWidth,width:o.text.width,rightDividerWidth:0},qty:{left:this._left+o.borderWidth,width:o.qty.width-o.borderWidth,rightDividerWidth:o.qty.rightDividerWidth},informer:{width:n,
left:this._left-d-n}},this._data.bodyAlignment!==w.TradedGroupHorizontalAlignment.Left)return o;const c=o.body.left-o.text.width-Number(o.qty.rightDividerWidth);return{...o,top:o.top,bottom:o.bottom,body:{left:o.body.left-o.text.width-Number(o.qty.rightDividerWidth)-o.borderWidth,right:o.qty.left+o.qty.width+o.borderWidth},text:{left:c,width:o.text.width+Number(o.qty.rightDividerWidth),rightDividerWidth:o.qty.rightDividerWidth},qty:{left:o.qty.left,width:o.qty.width-Number(o.qty.rightDividerWidth),rightDividerWidth:0},informer:{width:n,left:c-d-n}}}_calcAllWidth(t,e,o,r,i,s){const a=2*s;return Math.round(o*t.horizontalPixelRatio)+(o&&a)}}!function(t){t[t.SpacingBetweenReverseLines=3]="SpacingBetweenReverseLines",t[t.ArrowHeight=9]="ArrowHeight",t[t.ArrowWidth=3]="ArrowWidth",t[t.ReverseButtonOffset=10]="ReverseButtonOffset",t[t.ArrowHorizontalPadding=9]="ArrowHorizontalPadding",t[t.BorderRadius=4]="BorderRadius"}(v||(v={}));class A extends W{constructor(){super(...arguments),this._bodyBorderRadius=4}hitTest(t,e){const{horizontalPixelRatio:o,verticalPixelRatio:r}=e,s=this.rectWithOffsets(e),a=Math.round(t.x*o),l=Math.round(t.y*r),n=a>=s.left,d=a<=s.right,c=n&&d,h=l>=s.top&&l<=s.bottom,u=Math.round(s.top/r);if(!h||!c)return null;const p={cursorType:L.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:9})};if(this._data.disabled)return new x.HitTestResult(x.HitTarget.Custom,p);const _=this._hasReverseButton()&&(0,i.ensureDefined)(this._data.reverse);if(_&&1===_.visibility){const t=s.reverse.left+s.reverse.width;if(a>=s.reverse.left&&a<t){const t=Math.round(s.reverse.left/o),e=Math.round(s.reverse.width/o);return new x.HitTestResult(x.HitTarget.Custom,{...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:4}),cursorType:L.PaneCursorType.Pointer,hideCrosshairLinesOnHover:!0,contextMenuHandler:this._data.callbacks.onContextMenu,touchContextMenuHandler:this._data.callbacks.onContextMenu,clickHandler:this._data.callbacks.onReverse,tapHandler:this._data.callbacks.onReverse,tooltip:{text:_.title,rect:{x:t,y:u,w:e,h:this._height}}})}const r=this._calcReverseRect(e).offset,i=0!==s.cancel.width?s.cancel:s.tp;if(t-s.body.left<0?a>=t&&a<i.left:a>=s.reverse.left-r&&a<s.reverse.left)return new x.HitTestResult(x.HitTarget.Custom,p)}return super.hitTest(t,e)}draw(t,e){if(super.draw(t,e),!this._isReverseVisible()||!this._isDataVisibleInViewport(e)||!this._data.visible)return;const o=this.rectWithOffsets(e);this._drawReverseButton(t,e,o.reverse.left,o.top,o.reverse.width,o.bottom-o.top,o.borderWidth,o.borderRadius)}rect(t){return super.rect(t)}rectWithOffsets(t){return super.rectWithOffsets(t)}_calculateCacheRectWithOffsets(t){const e=super._calculateCacheRectWithOffsets(t);return{...e,reverse:{...e.reverse,left:this._calcCoordinateWithOffset(e.reverse.left,e.reverse.left+e.reverse.width).left}}}_calculateCacheRect(t){const e=super._calculateCacheRect(t);if(!this._data?.callbacks.onReverse||!this._hasReverseButton())return{...e,reverse:{width:0,left:0}}
;const o=this._calcReverseRect(t),r=this._data.bodyAlignment===w.TradedGroupHorizontalAlignment.Left,i=r?e.right+o.offset:e.left-o.width-o.offset,s=r?e.left:i,a=r?i+o.width:e.right;return{...e,left:s,right:a,reverse:{width:o.width,left:i}}}_calcAllWidth(t,e,o,r,i,s){const a=super._calcAllWidth(t,e,o,r,i,s);if(!this._data?.callbacks.onReverse||!this._hasReverseButton())return a;const l=this._calcReverseRect(t);return a+l.width+l.offset}_drawLine(t,e){if(!this._data?.callbacks.onReverse)return void super._drawLine(t,e);const{verticalPixelRatio:o}=e,r=this.rectWithOffsets(e),i=e.bitmapSize.width,s=r.reverse.left+r.reverse.width;if(t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*o)),(0,M.setLineStyle)(t,this._data.line.style),(0,M.drawHorizontalLine)(t,r.yMid,r.body.right,i),this._isReverseVisible()&&(0,M.drawHorizontalLine)(t,r.yMid,s,r.body.left),this._data.line.extend){const e=this._isReverseVisible()?r.reverse.left:r.body.left;(0,M.drawHorizontalLine)(t,r.yMid,0,e)}t.restore()}_drawQtyBackground(t,e,o,r,s){const a=(0,i.ensureDefined)(this._data.qty),l=o.bottom-o.top,n=o.top+o.borderWidth,d=l-2*o.borderWidth,c=o.borderRadius-o.borderWidth,h=o.qty.left-o.borderWidth,u=o.qty.width+o.borderWidth;let p=0;s?p=r?c:[0,c,c,0]:r&&(p=[c,0,0,c]),(0,M.drawRoundRectWithInnerBorder)(t,h,n,u,d,a.backgroundColor,p),a.active.visible&&(0,M.drawRoundRectWithInnerBorder)(t,o.qty.left,n,o.qty.width,d,a.active.backgroundColor,p)}_calcReverseRect(t){return{width:Math.round(29*t.horizontalPixelRatio),offset:Math.round(10*t.horizontalPixelRatio)}}_drawReverseButton(t,e,o,r,s,a,l,n){const d=(0,i.ensureDefined)(this._data.reverse),c=d.active;t.save(),(0,M.drawRoundRectWithInnerBorder)(t,o,r,s,a,d.backgroundColor,n,l,d.borderColor),c.visible&&(0,M.drawRoundRectWithInnerBorder)(t,o,r,s,a,c.backgroundColor,n,l,"transparent");const{horizontalPixelRatio:h,verticalPixelRatio:u}=e,p=Math.round(3*h),_=Math.round(3*h),y=Math.round(9*u),m=Math.round(o+(s-p)/2),f=Math.round(m+p),b=r+l+Math.round((a-y)/2-l),C=b+y,v=d.iconColor;t.lineWidth=l,(0,R.drawHalfArrow)(t,m,b,v,!1,y,_),(0,R.drawHalfArrow)(t,f,C,v,!0,y,_),t.restore()}_isReverseVisible(){return this._hasReverseButton()&&1===(0,i.ensureDefined)(this._data.reverse).visibility}_hasReverseButton(){return Boolean(this._data.callbacks.onReverse&&this._data.reverse)}}var V,F,N;!function(t){t[t.ButtonTextPadding=5]="ButtonTextPadding",t[t.CancelHorizontalMargin=4]="CancelHorizontalMargin",t[t.ConfirmHorizontalMargin=11]="ConfirmHorizontalMargin"}(V||(V={}));class q extends B.ItemRenderer{hitTest(t,e){const{horizontalPixelRatio:o}=e,r=this.rectWithOffsets(e),s=Math.round(t.x*o),a={cursorType:L.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:9})};if(this._hasConfirmButton()&&(0,i.ensureDefined)(this._data.confirm)){const t=r.confirm.left+r.confirm.width;if(s>=r.confirm.left&&s<t){let t={};if(void 0!==this._data.callbacks.onMove){const e=t=>{
this._data.callbacks.onMove&&this._data.callbacks.onMove(t),this._wasSourceMoved=!0},o=()=>{this._wasSourceMoved&&this._data.callbacks.onFinishMove&&this._data.callbacks.onFinishMove(),this._wasSourceMoved=!1};t={pressedMouseMoveHandler:e,touchMoveHandler:e,mouseUpHandler:o,touchEndHandler:o,cancelMoveHandler:this._data.callbacks.onCancelMove}}return new x.HitTestResult(x.HitTarget.Custom,{...a,...t,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:7}),cursorType:L.PaneCursorType.Pointer,clickHandler:this._data.callbacks.onConfirm,tapHandler:this._data.callbacks.onConfirm})}const o=this._calcConfirmRect(e,r.borderWidth).offset;if(s>=r.confirm.left-o&&s<r.confirm.left)return new x.HitTestResult(x.HitTarget.Custom,a)}const l=this._cancelButtonHitTest(s,e,a);return void 0!==l?l:super.hitTest(t,e)}draw(t,e){if(super.draw(t,e),!this._isDataVisibleInViewport(e)||!this._data.visible)return;const o=this.rectWithOffsets(e),r=o.bottom-o.top,i=o.yMid;this._hasConfirmButton()&&this._drawButton({ctx:t,yText:i,height:r,renderingInfo:e,borderWidth:o.borderWidth,bracketButtonData:this._data.confirm,borderRadius:o.borderRadius,buttonCoordinates:o.confirm}),this._hasCancelButton()&&this._drawButton({ctx:t,yText:i,height:r,renderingInfo:e,bracketButtonData:this._data.cancel,borderWidth:o.borderWidth,buttonCoordinates:o.cancel,borderRadius:o.borderRadius})}rect(t){return super.rect(t)}rectWithOffsets(t){return super.rectWithOffsets(t)}_calculateCacheRect(t){const e=super._calculateCacheRect(t),o=this._calcConfirmRect(t,e.borderWidth),r=this._calcCancelRect(t,e.borderWidth),i=this._data.bodyAlignment===w.TradedGroupHorizontalAlignment.Left;let s=0,a=0;i?(a=e.body.right+r.offset+r.width,s=a+o.offset+o.width):(s=e.body.left-o.offset-o.width,a=s-r.width-r.offset),o.width>0&&(s=i?s:s-e.borderWidth);let l=a||s||e.qty.left,n=e.right;return i&&(l=e.left,r.width>0?n=a+r.width:o.width>0&&(n=s+o.width)),{...e,left:l,right:n,cancel:{width:r.width,left:a},confirm:{width:o.width,left:s}}}_calcAllWidth(t,e,o,r,i,s){const a=super._calcAllWidth(t,e,o,r,i,s),l=this._calcConfirmRect(t,s),n=this._calcCancelRect(t,s);return a+l.width+l.offset+n.width+n.offset}_calcConfirmRect(t,e){if(!this._hasConfirmButton())return{width:0,offset:0};const{horizontalPixelRatio:o}=t,r=this._textWidth(this._ctxInternal,(0,i.ensureDefined)(this._data.confirm).text);return{offset:o,width:Math.round(r*o)}}_calcCancelRect(t,e){if(!this._hasCancelButton())return{width:0,offset:0};const{horizontalPixelRatio:o}=t,r=2*e,i=this._textWidth(this._ctxInternal,"Cancel"),s=5*o;return{offset:Math.round(4*o),width:Math.round(i*o)+r+s}}_drawButton(t){if(void 0===t.bracketButtonData)return;const{ctx:e,yText:o,height:r,borderWidth:i,borderRadius:s,renderingInfo:a,bracketButtonData:l,buttonCoordinates:n}=t,d=this.rectWithOffsets(a);(0,M.drawRoundRectWithInnerBorder)(e,n.left,d.top,n.width,r,l.backgroundColor,s),l.active.visible&&(0,M.drawRoundRectWithInnerBorder)(e,n.left,d.top,n.width,r,l.active.backgroundColor,s)
;const c=l.active.visible&&void 0!==l.active.borderColor?l.active.borderColor:l.borderColor;(0,M.drawRoundRectWithInnerBorder)(e,n.left,d.top,n.width,r,"transparent",s,i,c,l.borderStyle);const h=n.left+n.width/2;l.underlineText?this._drawUnderlinedText(e,a,l.text,l.textColor,h,o):this._drawText(e,a,l.text,l.textColor,h,o)}_cancelButtonHitTest(t,e,o){const r=this.rectWithOffsets(e);if(this._data.cancel){const i=r.cancel.left+r.cancel.width;if(t>=r.cancel.left&&t<i){let t={};if(void 0!==this._data.callbacks.onMove){const e=t=>{this._data.callbacks.onMove&&this._data.callbacks.onMove(t),this._wasSourceMoved=!0},o=()=>{this._wasSourceMoved&&this._data.callbacks.onFinishMove&&this._data.callbacks.onFinishMove(),this._wasSourceMoved=!1};t={pressedMouseMoveHandler:e,touchMoveHandler:e,mouseUpHandler:o,touchEndHandler:o,cancelMoveHandler:this._data.callbacks.onCancelMove}}return new x.HitTestResult(x.HitTarget.Custom,{...o,...t,...(0,B.activeItemToHitTestResultData)({id:this._data.id,part:8}),cursorType:L.PaneCursorType.Pointer,clickHandler:this._data.callbacks.onCancel,tapHandler:this._data.callbacks.onCancel})}const s=this._calcCancelRect(e,r.borderWidth).offset;if(t>=r.cancel.left-s&&t<r.cancel.left)return new x.HitTestResult(x.HitTarget.Custom,o)}}_hasConfirmButton(){return Boolean(this._data.callbacks.onConfirm&&this._data.confirm)}_hasCancelButton(){return Boolean(this._data.cancel)}}!function(t){t[t.MinOffsetForVisibleLine=12]="MinOffsetForVisibleLine"}(F||(F={})),function(t){t.FontWeight="normal"}(N||(N={}));class E{constructor(t,e){this._textWidthCache=new S.TextWidthCache,this._items=[],this._minMainTextWidthCache=new Map,this._itemsRectsInfoCache=null,this._font=(0,T.makeFont)(t,k.CHART_FONT_FAMILY,"","normal"),this._tradedGroupRenderersController=e}itemRenderers(){return this._items}clearCache(){this._itemsRectsInfoCache=null,this._items.forEach((t=>t.clearCache()))}clearTextCache(){this._textWidthCache.reset()}setData(t){this._data=t}clearItems(){this._items=[]}addItem(t){const e=function(t,e,o,r){if(t.type===B.ItemsRendererType.Position)return new A(t,e,o,r);if(t.type===B.ItemsRendererType.WithBracketButtons)return new W(t,e,o,r);if(t.type===B.ItemsRendererType.BracketWithoutParent)return new q(t,e,o,r);if(t.type===B.ItemsRendererType.Projection)return new H(t,e,o,r);if(t.type===B.ItemsRendererType.Default)return new B.ItemRenderer(t,e,o,r);throw new Error("Unknown traded item renderer's type")}(t,this._textWidthCache,(0,i.ensureNotNull)(this._font),this._minTextWidth.bind(this));this._items.push(e)}applyHorizontalOffset(t,e){if(null!==this._itemsRectsInfoCache)return;const o=this._items.filter((t=>t.data().visible)).map((t=>t.rect(e)));if(0===o.length)return;let r,i,s=1/0,a=-1/0;for(const t of o){s=Math.min(s,t.yMid),a=Math.max(a,t.yMid);O(t)&&(r=t.tp.left,i=t.sl.left)}const{bitmapSize:l,horizontalPixelRatio:n}=e;let d,c,h=t.rightmostBorder,u=t.leftmostBorder;const p=h-u;if(this._data.horizontalAlignment===w.TradedGroupHorizontalAlignment.Left)h>l.width&&(c=Math.max(l.width-p,Math.round(12*n)));else if(u<0){
const t=Math.round(12*n);d=l.width-p>t?p:l.width-t}if(void 0!==r&&void 0!==i){if(void 0!==c){const t=u-c;r-=t,i-=t}if(void 0!==d){const t=d-h;r+=t,i+=t}}void 0!==c&&(u=c),void 0!==d&&(h=d),this._itemsRectsInfoCache={rightmostBorder:h,leftmostBorder:u,leftmostForItemOffset:c,rightmostForItemOffset:d,yMin:s,yMax:a,projItemTpLeft:r,projItemSlLeft:i};for(const t of this._items)t.applyOffset(this._itemsRectsInfoCache)}hitTest(t,e){if(!this._paneHasVisibleItems())return null;this._tradedGroupRenderersController.alignItems(e);for(let o=this._items.length-1;o>=0;o--){const r=this._items[o].hitTest(t,e);if(null!==r)return r}return this._data.disableTouchInteraction(),this._data?.disableNoOverlap?new x.HitTestResult(x.HitTarget.MovePointBackground,{clickHandler:this._data.disableNoOverlap,tapHandler:this._data.disableNoOverlap,contextMenuHandler:this._data.disableNoOverlap,touchContextMenuHandler:this._data.disableNoOverlap}):null}drawBackground(t,e){if(!this._paneHasVisibleItems())return;this._tradedGroupRenderersController.alignItems(e);for(const o of this._items)o.drawBackground(t,e);const o=this._items.find((t=>{return"movingFillFromArea"in(e=t.data())&&void 0!==e.movingFillFromArea;var e})),r=this._items.find((t=>t.data().isMovingFillTo));if(o&&r){const i=o.data();if(void 0!==i.movingFillFromArea){t.fillStyle=i.movingFillFromArea.backgroundColor;const s=o.rectWithOffsets(e),a=r.rectWithOffsets(e),l=Math.min(s.yMid,a.yMid),n=Math.max(s.yMid,a.yMid)-l;t.fillRect(0,l,e.bitmapSize.width,n)}}}draw(t,e){if(!this._paneHasVisibleItems())return;this._tradedGroupRenderersController.alignItems(e);for(const o of this._items)o.drawLine(t,e);const{bitmapSize:o,horizontalPixelRatio:r}=e,i=this._itemsRectsInfoCache?.rightmostBorder??null,s=this._itemsRectsInfoCache?.leftmostBorder??null,a=Math.round(12*r),l=this._data.horizontalAlignment===w.TradedGroupHorizontalAlignment.Left,n=l?s:i,d=l?-1:1;if(null!==n&&n+d*a<=o.width){const i=l?0:o.width,s=Math.round(this._data.rightPadding*r),a=n+d*(Math.min(s,i-d*n)/2);this._drawVertLine(t,e,a);for(const o of this._items)o.drawPointOnLine(t,e,a)}for(const o of this._items)o.draw(t,e)}clearMinTextWidthByItemId(t){this._minMainTextWidthCache.has(t)&&this._minMainTextWidthCache.delete(t)}clearMinTextWidthCache(){this._minMainTextWidthCache.clear()}_minTextWidth(t,e){if(!t.text.text)return 0;e.save(),e.font=(0,i.ensureNotNull)(this._font);const o=Math.ceil(this._textWidthCache.measureText(e,t.text.text)),r=this._minMainTextWidthCache.get(t.id);if(void 0===r||o>r){const r=Math.ceil(this._textWidthCache.measureText(e,"0"));this._minMainTextWidthCache.set(t.id,o+r)}return e.restore(),this._minMainTextWidthCache.get(t.id)??0}_drawVertLine(t,e,o){const r=this._data.vertLine;null!==r&&null!==this._itemsRectsInfoCache&&this._itemsRectsInfoCache.yMax!==this._itemsRectsInfoCache.yMin&&(t.strokeStyle=r.color,t.lineWidth=Math.max(1,Math.floor(r.thickness*e.horizontalPixelRatio)),(0,M.setLineStyle)(t,r.style),(0,M.drawVerticalLine)(t,o,this._itemsRectsInfoCache.yMin,this._itemsRectsInfoCache.yMax))}
_paneHasVisibleItems(){return this._items.filter((t=>t.data().visible)).length>0}}var G,z=o(229144),j=o(802672),Q=o(465688),$=o(829609),U=o(613113),Y=o(316167),X=o(478139);!function(t){t[t.PointShadowTransparency=80]="PointShadowTransparency",t[t.OverlayTransparency=50]="OverlayTransparency",t[t.ActiveColorTransparency=85]="ActiveColorTransparency",t[t.HintTPTransparency=90]="HintTPTransparency",t[t.MovingTPTransparency=80]="MovingTPTransparency",t[t.HintSLTransparency=85]="HintSLTransparency",t[t.MovingSLTransparency=70]="MovingSLTransparency"}(G||(G={}));const K=$.colorsPalette["color-white"],J=K,Z=$.colorsPalette["color-tv-blue-50"],tt=$.colorsPalette["color-tv-blue-100"],et=$.colorsPalette["color-tv-blue-200"],ot=$.colorsPalette["color-tv-blue-500"],rt=$.colorsPalette["color-tv-blue-600"],it=$.colorsPalette["color-cold-gray-150"],st=$.colorsPalette["color-cold-gray-300"],at=$.colorsPalette["color-ripe-red-50"],lt=$.colorsPalette["color-ripe-red-100"],nt=$.colorsPalette["color-ripe-red-100"],dt=$.colorsPalette["color-ripe-red-500"],ct=$.colorsPalette["color-ripe-red-600"],ht=$.colorsPalette["color-minty-green-50"],ut=$.colorsPalette["color-minty-green-100"],pt=$.colorsPalette["color-minty-green-500"],_t=$.colorsPalette["color-tan-orange-50"],yt=$.colorsPalette["color-tan-orange-200"],mt=$.colorsPalette["color-tan-orange-500"],ft=(0,U.generateColor)(K,50),bt=(0,Y.blendColors)(mt,ft),Ct=(0,Y.blendColors)(pt,ft),vt=(0,Y.blendColors)(dt,ft),gt=(0,Y.blendColors)(ot,ft),Pt=(0,U.generateColor)(et,85),kt=(0,U.generateColor)(nt,85),Tt=(0,U.generateColor)(ut,85),xt=(0,U.generateColor)(pt,90),Mt=(0,U.generateColor)(pt,80),wt=(0,U.generateColor)(yt,85),St=(0,U.generateColor)(mt,85),Bt=(0,U.generateColor)(mt,70),Dt=(0,U.generateColor)(et,80),It=(0,U.generateColor)(nt,80),Lt=(0,U.generateColor)(ut,80),Rt=(0,U.generateColor)(yt,80),Ot={pointShadowColor:Dt,labelTickColor:et,lineColor:et,borderBackgroundColor:K,borderColor:et,pointBackgroundColor:K,disabledLineColor:tt,positivePlColor:Ct,negativePlColor:vt,qty:{backgroundColor:K,textColor:gt,dividerColor:Z,activeColor:Pt},text:{backgroundColor:K,textColor:gt,dividerColor:Z,buttonTextColor:gt,activeColor:Pt},close:{backgroundColor:K,iconColor:gt,activeColor:Pt},confirm:{disableBackgroundColor:it,backgroundColor:ot,borderColor:ot,textColor:J,disableTextColor:st,activeColor:rt},informer:{backgroundColor:X.errorNotificationBackdrop,iconColor:dt}},Wt={pointShadowColor:It,labelTickColor:nt,lineColor:nt,borderBackgroundColor:K,borderColor:nt,pointBackgroundColor:K,disabledLineColor:lt,positivePlColor:Ct,negativePlColor:vt,qty:{backgroundColor:K,textColor:vt,dividerColor:at,activeColor:kt},text:{backgroundColor:K,textColor:vt,dividerColor:at,buttonTextColor:vt,activeColor:kt},close:{backgroundColor:K,iconColor:vt,activeColor:kt},confirm:{disableBackgroundColor:it,backgroundColor:dt,borderColor:dt,textColor:J,disableTextColor:st,activeColor:ct},informer:{backgroundColor:X.errorNotificationBackdrop,iconColor:dt}},Ht={pointShadowColor:Lt,labelTickColor:ut,lineColor:ut,
borderBackgroundColor:K,borderColor:ut,pointBackgroundColor:K,positivePlColor:Ct,negativePlColor:vt,qty:{backgroundColor:K,textColor:Ct,dividerColor:ht,activeColor:Tt},text:{backgroundColor:K,textColor:Ct,dividerColor:ht,buttonTextColor:Ct,activeColor:Tt,hintAreaColor:xt},close:{backgroundColor:K,iconColor:Ct,activeColor:Tt},informer:{backgroundColor:X.errorNotificationBackdrop,iconColor:dt},movingBackgroundColor:Mt},At={pointShadowColor:Rt,labelTickColor:yt,lineColor:yt,borderBackgroundColor:K,borderColor:yt,pointBackgroundColor:K,positivePlColor:Ct,negativePlColor:vt,qty:{backgroundColor:K,textColor:bt,dividerColor:_t,activeColor:wt},text:{backgroundColor:K,textColor:bt,dividerColor:_t,buttonTextColor:bt,activeColor:wt,hintAreaColor:St},close:{backgroundColor:K,iconColor:bt,activeColor:wt},informer:{backgroundColor:X.errorNotificationBackdrop,iconColor:dt},movingBackgroundColor:Bt},Vt={buy:{normal:Ot,disabled:(0,Y.generateBlendColors)(Ot,ft)},sell:{normal:Wt,disabled:(0,Y.generateBlendColors)(Wt,ft)},takeProfit:{normal:Ht,disabled:(0,Y.generateBlendColors)(Ht,ft)},stopLoss:{normal:At,disabled:(0,Y.generateBlendColors)(At,ft)}};var Ft;!function(t){t[t.ActiveColorTransparency=85]="ActiveColorTransparency",t[t.IconDisabledTransparency=80]="IconDisabledTransparency",t[t.PointShadowTransparency=70]="PointShadowTransparency",t[t.OverlayTransparency=50]="OverlayTransparency",t[t.HintTPTransparency=85]="HintTPTransparency",t[t.MovingTPTransparency=75]="MovingTPTransparency",t[t.HintSLTransparency=90]="HintSLTransparency",t[t.MovingSLTransparency=80]="MovingSLTransparency"}(Ft||(Ft={}));const Nt=$.colorsPalette["color-white"],qt=$.colorsPalette["color-tv-blue-a800"],Et=$.colorsPalette["color-tv-blue-a700"],Gt=$.colorsPalette["color-tv-blue-a700"],zt=$.colorsPalette["color-tv-blue-500"],jt=$.colorsPalette["color-tv-blue-600"],Qt=$.colorsPalette["color-cold-gray-600"],$t=$.colorsPalette["color-cold-gray-750"],Ut=$.colorsPalette["color-cold-gray-900"],Yt=$.colorsPalette["color-ripe-red-500"],Xt=$.colorsPalette["color-ripe-red-600"],Kt=$.colorsPalette["color-ripe-red-a800"],Jt=$.colorsPalette["color-ripe-red-a800"],Zt=$.colorsPalette["color-ripe-red-a800"],te=$.colorsPalette["color-minty-green-a800"],ee=$.colorsPalette["color-minty-green-500"],oe=$.colorsPalette["color-tan-orange-a800"],re=$.colorsPalette["color-tan-orange-500"],ie="#0D3D41",se="#453826",ae=(0,U.generateColor)(Ut,50),le=(0,Y.blendColors)(ee,ae),ne=(0,Y.blendColors)(Yt,ae),de=(0,Y.blendColors)(zt,ae),ce=(0,Y.blendColors)(re,ae),he=(0,U.generateColor)(Et,85),ue=((0,U.generateColor)(Et,80),(0,U.generateColor)(Kt,85)),pe=((0,U.generateColor)(Kt,80),(0,U.generateColor)(te,85)),_e=(0,U.generateColor)(ee,85),ye=(0,U.generateColor)(ee,75),me=((0,U.generateColor)(te,80),(0,U.generateColor)(oe,85)),fe=(0,U.generateColor)(re,90),be=(0,U.generateColor)(re,80),Ce=((0,U.generateColor)(oe,80),(0,U.generateColor)(Et,70)),ve=(0,U.generateColor)(Kt,70),ge=(0,U.generateColor)(te,70),Pe=(0,U.generateColor)(oe,70),ke={pointShadowColor:Ce,labelTickColor:Et,lineColor:Et,
borderBackgroundColor:Ut,borderColor:Et,pointBackgroundColor:Ut,disabledLineColor:Gt,positivePlColor:le,negativePlColor:ne,qty:{backgroundColor:Ut,textColor:de,dividerColor:qt,activeColor:he},text:{backgroundColor:Ut,textColor:de,dividerColor:qt,buttonTextColor:de,activeColor:he},close:{backgroundColor:Ut,iconColor:de,activeColor:he},confirm:{disableBackgroundColor:$t,backgroundColor:zt,borderColor:zt,textColor:Nt,disableTextColor:Qt,activeColor:jt},informer:{backgroundColor:X.errorNotificationBackdrop,iconColor:Yt}},Te={pointShadowColor:ve,labelTickColor:Kt,lineColor:Kt,borderBackgroundColor:Ut,borderColor:Kt,pointBackgroundColor:Ut,disabledLineColor:Jt,positivePlColor:le,negativePlColor:ne,qty:{backgroundColor:Ut,textColor:ne,dividerColor:Zt,activeColor:ue},text:{backgroundColor:Ut,textColor:ne,dividerColor:Zt,buttonTextColor:ne,activeColor:ue},close:{backgroundColor:Ut,iconColor:ne,activeColor:ue},confirm:{disableBackgroundColor:$t,backgroundColor:Yt,borderColor:Yt,textColor:Nt,disableTextColor:Qt,activeColor:Xt},informer:{backgroundColor:X.errorNotificationBackdrop,iconColor:Yt}},xe={pointShadowColor:ge,labelTickColor:te,lineColor:te,borderBackgroundColor:Ut,borderColor:te,pointBackgroundColor:Ut,positivePlColor:le,negativePlColor:ne,qty:{backgroundColor:Ut,textColor:le,dividerColor:ie,activeColor:pe},text:{backgroundColor:Ut,textColor:le,dividerColor:ie,buttonTextColor:le,activeColor:pe,hintAreaColor:_e},close:{backgroundColor:Ut,iconColor:le,activeColor:pe},informer:{backgroundColor:X.errorNotificationBackdrop,iconColor:Yt},movingBackgroundColor:ye},Me={pointShadowColor:Pe,labelTickColor:oe,lineColor:oe,borderBackgroundColor:Ut,borderColor:oe,pointBackgroundColor:Ut,positivePlColor:le,negativePlColor:ne,qty:{backgroundColor:Ut,textColor:ce,dividerColor:se,activeColor:me},text:{backgroundColor:Ut,textColor:ce,dividerColor:se,buttonTextColor:ce,activeColor:me,hintAreaColor:fe},close:{backgroundColor:Ut,iconColor:ce,activeColor:me},informer:{backgroundColor:X.errorNotificationBackdrop,iconColor:Yt},movingBackgroundColor:be},we={buy:{normal:ke,disabled:(0,Y.generateBlendColors)(ke,ae)},sell:{normal:Te,disabled:(0,Y.generateBlendColors)(Te,ae)},takeProfit:{normal:xe,disabled:(0,Y.generateBlendColors)(xe,ae)},stopLoss:{normal:Me,disabled:(0,Y.generateBlendColors)(Me,ae)}};var Se=o(154426);function Be(t,e,o,r){const i=o()?we:Vt,s=o()?r?.darkTheme:r?.lightTheme;let a,l;const d=t.bracketType();null!==d?(a=d===n.BracketType.TakeProfit?i.takeProfit:i.stopLoss,l=d===n.BracketType.TakeProfit?s?.takeProfit:s?.stopLoss):a=t.isBuyDirection()?i.buy:i.sell;const c=e.disabled()?a.disabled:a.normal,h=e.disabled()?l?.disabled:l?.normal,u=t.lineStyle(),p=null===d?y.LineStyle.Dashed:y.LineStyle.Dotted;return(0,Se.deepExtend)({},{...c,borderStyle:u,labelBorderVisible:!0,lineStyle:p},h??{})}var De,Ie=o(687039);!function(t){t[t.HoveredColorTransparency=85]="HoveredColorTransparency",t[t.MinQtyWidth=30]="MinQtyWidth"}(De||(De={}));class Le{constructor(t,e,o,r,i,s){this._item=t,this._source=e,this._chartModel=o,this._mainItemStyle=r,
this._isNoOverlapMode=i.isNoOverlapMode,this._isTouchInteractionEnabled=i.isTouchInteractionEnabled,this._displayMode=i.displayMode,this._rightPadding=i.rightPadding,this._groupLineColor=i.groupLineColor,this._y=i.y,this._externalCallbacks=s}_isProfitLossHidden(){return 0===this._displayMode}_isProfitLossShorten(){return 2!==this._displayMode}_isCloseVisible(){return 0!==this._displayMode}_minQtyWidth(){return 0===this._displayMode?30:0}_isHoveredItem(t){return this._source.hoveredItem()?.id===t.id()}_isHoveredItemPart(t,e){return this._isHoveredItem(t)&&this._source.hoveredItem()?.part===e}_isSelectedItem(t){return this._source.selectedItem()?.id===t.id()}_isHoveredItemWithButtons(t){if(!t)return!1;const{takeProfit:e,stopLoss:o,trailingStop:r}=(0,Q.bracketsByType)(this._source.items().projectionBrackets);return this._isHoveredItem(t)||Boolean(e&&this._isHoveredItem(e))||Boolean(o&&this._isHoveredItem(o))||Boolean(r&&this._isHoveredItem(r))}_isHoveredStopItemStopLimit(){const t=this._source.items().main,e=this._source.items().stopLimit;return!!(t&&e&&(0,u.isLimitPartStopLimitOrderItem)(e))&&this._isHoveredItem(t)}_isActiveSource(){return this._source.isHovered()||this._source.isSelected()}_itemWithButtons(){if(this._isNoOverlapMode)return;const t=this._source.baseItem();if(void 0===t&&this._source.isEdited()){const t=this._source.items().brackets[0];return t&&!(0,Q.isPreBracketOrder)(t.data().id)&&(0,Ie.isBracketOrderRawData)(t.data())?t:void 0}return t}_projectionBracketsForItem(t){return t!==this._itemWithButtons()?[]:this._source.items().projectionBrackets}_renderDataForTPSLButtons(t){if(t!==this._itemWithButtons())return{};const e={borderStyle:this._source.isPlaced()?t.lineStyle():(0,i.ensureDefined)(this._source.mainItem()).lineStyle()},o={},{takeProfit:r,stopLoss:s,trailingStop:a,guaranteedStop:l}=(0,Q.bracketsByType)(this._source.items().projectionBrackets);if(r){const s=null===r.price(),a=this._isHoveredItemPart(t,5),l=Re(r,this._source,(()=>this._chartModel.dark().value()),e);o.tp={id:r.id(),visibility:s&&this._isMainButtonsVisible()?1:0,text:r.qtyText(),title:r.tooltip(),underlineText:!1,textColor:s?l.text.buttonTextColor:l.text.textColor,backgroundColor:l.text.backgroundColor,borderColor:l.borderColor,borderStyle:l.borderStyle,active:{visible:a,backgroundColor:a?l.text.activeColor:l.text.backgroundColor},hintArea:a&&s&&this._isMainButtonsVisible()?{rectToUp:t.isBuyDirection(),backgroundColor:(0,i.ensureDefined)(l.text.hintAreaColor)}:void 0}}const n=s||a||l;if(n){const r=null===n.price(),s=this._isHoveredItemPart(t,6),a=Re(n,this._source,(()=>this._chartModel.dark().value()),e);o.sl={id:n.id(),visibility:r&&this._isMainButtonsVisible()?1:0,text:n.qtyText(),title:n.tooltip(),underlineText:this._hasAdditionalStopTypes(),textColor:r?a.text.buttonTextColor:a.text.textColor,backgroundColor:a.text.backgroundColor,borderColor:a.borderColor,borderStyle:a.borderStyle,active:{visible:s,backgroundColor:s?a.text.activeColor:a.text.backgroundColor},hintArea:s&&r&&this._isMainButtonsVisible()?{
rectToUp:!t.isBuyDirection(),backgroundColor:(0,i.ensureDefined)(a.text.hintAreaColor)}:void 0}}return o}_renderDataForLine(t){return{drawOnTop:this._isActiveSource()&&!this._isNoOverlapMode,thickness:this._source.lineWidth(),style:t.lineStyle,color:t.lineColor,extend:this._source.isLineExtended(),shouldOffsetPointerEvents:this._source.isPlusButtonVisible()}}_renderDataForQty(t){return{text:(0,z.forceLTRStr)(this._item.qtyText()),minTextWidth:this._minQtyWidth(),textColor:t.textColor,backgroundColor:t.backgroundColor,dividerColor:t.dividerColor,isDividerVisible:!0,active:{visible:this._isHoveredItemPart(this._item,1),backgroundColor:t.activeColor}}}_renderDataForText(t){return{text:this._isProfitLossHidden()?"":this._item.profitLossText(this._isProfitLossShorten()),textColor:t.textColor,backgroundColor:t.backgroundColor,dividerColor:t.dividerColor,active:{visible:!1,backgroundColor:t.activeColor}}}_renderDataForPoint(){const{takeProfit:t,stopLoss:e,trailingStop:o,guaranteedStop:r}=(0,Q.bracketsByType)(this._source.items().projectionBrackets),i=e||o||r,s=this._item===this._itemWithButtons(),a=s&&t&&null===t.price()&&this._isHoveredItem(t),l=s&&i&&null===i.price()&&this._isHoveredItem(i),n=this._isHoveredItem(this._item)||a||l?this._mainItemStyle.pointShadowColor:void 0,d=this._isSelectedItem(this._item)?this._groupLineColor:this._mainItemStyle.pointBackgroundColor,c=this._groupLineColor;return{visible:this._isActiveSource(),borderStyle:m,borderColor:c,backgroundColor:d,shadowColor:n}}_renderDataForClose(t){if(this._item.supportClose()&&this._isCloseVisible())return{backgroundColor:t.backgroundColor,iconColor:t.iconColor,active:{visible:this._isHoveredItemPart(this._item,3),backgroundColor:t.activeColor}}}_renderDataForConfirm(){if(this._item!==this._itemWithConfirmButton()||!this._isMainButtonsVisible())return;const t=(0,h.isOrderLikeItem)(this._item)?Re(this._item,this._source,(()=>this._chartModel.dark().value())):(0,P.getDefaultStyleForPositionItem)(this._item.isBuyDirection(),this._source.isBlocked(),(()=>this._chartModel.dark().value()),this._item.lineStyle(),this._source.styleOverrides?.()?.position),e=(0,i.ensureDefined)(t.confirm),o=this._isHoveredItemPart(this._item,7),r=!this._source.hasError(),s=r?e.backgroundColor:e.disableBackgroundColor,a=r?(0,i.ensureDefined)(e.borderColor):e.disableBackgroundColor,l=r?e.textColor:e.disableTextColor;return{text:this._confirmButtonText(),textColor:l,backgroundColor:s,borderColor:a,borderStyle:y.LineStyle.Solid,active:{visible:o&&r,backgroundColor:e.activeColor,borderColor:e.activeColor}}}_renderDataForCancel(){if(this._item!==this._itemWithCancelButton()||!this._isMainButtonsVisible())return;const t=(0,h.isOrderLikeItem)(this._item)?Re(this._item,this._source,(()=>this._chartModel.dark().value())):(0,P.getDefaultStyleForPositionItem)(this._item.isBuyDirection(),this._source.isBlocked(),(()=>this._chartModel.dark().value()),this._item.lineStyle(),this._source.styleOverrides?.()?.position),e=(0,i.ensureDefined)(t.cancel),o=this._isHoveredItemPart(this._item,8);return{
text:this._cancelButtonText(),textColor:e.textColor,backgroundColor:e.backgroundColor,borderColor:e.borderColor,borderStyle:y.LineStyle.Solid,active:{visible:o,backgroundColor:e.backgroundColor,borderColor:e.borderColor}}}_renderDataGeneral(t){let e=0;const o=this._item.price();if(null!==o){e=(this._chartModel.mainSeries().priceScale().isInverted()?-1:1)*o}return{y:this._y,visible:this._item.isVisible(),isTouchInteractionEnabled:this._isTouchInteractionEnabled,sortingIndex:e,id:this._item.id(),disabled:this._source.disabled(),borderBackgroundColor:this._borderBackgroundColor(t),borderColor:t.borderColor,borderStyle:t.borderStyle,bodyAlignment:this._source.horizontalAlignment(),rightPadding:this._rightPadding}}_callbacks(t=[]){const e={enableTouchInteraction:()=>this._externalCallbacks.setTouchInteractionMode(!0)},o={label:`[${this._modeGaLabel()}]`};this._item.hasContextMenu()&&(e.onContextMenu=t=>this._item.onContextMenu(t,o));const{takeProfit:r,stopLoss:i,trailingStop:s,guaranteedStop:a}=(0,Q.bracketsByType)(t),l=i||s||a;return e.onCancelMove=()=>this._source.cancelMove?.()??!1,r&&(e.onMoveProjectionTP=t=>this._source.onMove(r.id(),t),e.onFinishMoveTP=()=>this._source.onFinishMoveProjectionBracket(r.id(),{...o,event:"Add bracket from btn"})),l&&(e.onMoveProjectionSL=t=>this._source.onMove(l.id(),t),e.onFinishMoveSL=()=>this._source.onFinishMoveProjectionBracket(l.id(),{...o,event:"Add bracket from btn"}),this._hasAdditionalStopTypes()&&(e.onClickSL=(t,e)=>l.toggleType(t,e,o))),this._isNoOverlapMode&&(e.allInteractionsHandler=()=>this._externalCallbacks.setNoOverlapMode(!1)),this._isMainButtonsVisible()&&(e.onConfirm=()=>this._source.onConfirm(this._item.id(),o),e.onCancel=()=>this._source.onCancel(this._item.id(),o)),e}_isMainButtonsVisible(){if(2===this._displayMode)return!0;return!!this._source.hasConfirmButton()&&this._source.isActiveSource()||this._isHoveredItemWithButtons(this._item)||this._isHoveredStopItemStopLimit()||this._source.isSelected()}_borderBackgroundColor(t){return t.borderStyle===y.LineStyle.Solid?"transparent":t.borderBackgroundColor}_modeGaLabel(){switch(this._displayMode){case 2:return"Standard view";case 1:return"Medium view";case 0:return"Minimal view"}}_confirmButtonText(){return this._item.confirmText(!0)}_cancelButtonText(){return this._item.cancelText(!0)}_itemWithConfirmButton(){if(this._source.hasConfirmButton()&&!j.isResizableDrawerEnabled)return this._itemWithButtons()}_itemWithCancelButton(){if(this._source.hasCancelButton()&&!j.isResizableDrawerEnabled)return this._itemWithButtons()}_hasAdditionalStopTypes(){return Number(this._source.isStopLossSupported())+Number(this._source.isTrailingStopSupported())+Number(this._source.isGuaranteedStopSupported())>1}}function Re(t,e,o,r={}){return(e.isPlaced()?g.getDefaultStyleForOrderItem:Be)(t,e,o,e.styleOverrides?.()?.order)}const Oe=s.t(null,void 0,o(898818)),We=s.t(null,void 0,o(759783));class He extends Le{rendererData(){const t=(0,
P.getDefaultStyleForPositionItem)(this._item.isBuyDirection(),this._source.isBlocked(),(()=>this._chartModel.dark().value()),this._item.lineStyle(),this._source.styleOverrides?.()?.position);let e;const o=this._renderDataForClose(t.close);void 0!==o&&(e={...o,title:We});const r=this._item.extractErrorMessage(),i=r?{title:r,iconColor:t.informer.iconColor,backgroundColor:t.informer.backgroundColor}:void 0;return{type:B.ItemsRendererType.Position,...this._renderDataGeneral(t),...this._renderDataForTPSLButtons(this._item),callbacks:this._callbacks(this._projectionBracketsForItem(this._item)),line:this._renderDataForLine(t),qty:{...this._renderDataForQty(t.qty)},text:{...this._renderDataForText(t.text),title:this._item.profitLossTooltip(),textColor:this._item.profitLossTextColor(),active:{visible:!1,backgroundColor:t.qty.activeColor}},point:this._renderDataForPoint(),close:e,reverse:this._renderDataForReverse(t.reverse),informer:i,confirm:this._renderDataForConfirm(),cancel:this._renderDataForCancel(),isMovingFillTo:this._item===this._itemWithButtons()}}_callbacks(t=[]){const e=super._callbacks(t),o={label:`[${this._modeGaLabel()}]`};return this._item.supportClose()&&this._isCloseVisible()&&(e.onClose=()=>this._item.onClose(o)),this._shouldReverseShown()&&(e.onReverse=()=>this._item.onReverse(o)),this._item.supportModify()&&(e.onModify=()=>this._item.onModify(o)),this._isMainButtonsVisible()&&(e.onConfirm=()=>this._source.onConfirm(this._item.id(),o),e.onCancel=()=>this._source.onCancel(this._item.id(),o)),e}_renderDataForReverse(t){if(!this._shouldReverseShown())return;const e=2===this._displayMode||(this._isHoveredItemWithButtons(this._item)||this._source.isSelected());return{title:Oe,visibility:e?1:0,backgroundColor:t.backgroundColor,iconColor:t.iconColor,borderColor:t.borderColor,active:{visible:this._isHoveredItemPart(this._item,4),backgroundColor:t.activeColor}}}_shouldReverseShown(){return this._item.supportReverse()&&this._source.isReverseVisible()&&this._isReverseVisible()}_isReverseVisible(){return 2===this._displayMode&&!this._isNoOverlapMode}}class Ae extends Le{rendererData(){const t=this._itemWithButtons(),e=this._item===t,o=Re(this._item,this._source,(()=>this._chartModel.dark().value()));let r;const s=this._renderDataForClose(o.close);void 0!==s&&(r={...s,title:this._item.texts().close.title});const a=this._item.extractErrorMessage(),l=a?{title:a,iconColor:o.informer.iconColor,backgroundColor:o.informer.backgroundColor}:void 0,d=this._item.bracketType();let c=!1;if(!this._source.allItemsHadBeenMoved()&&!e&&void 0!==t&&null!==d&&this._item.isMoving()){const e=(this._item.price()??-1/0)<(t?.price()??-1/0);c=d===n.BracketType.TakeProfit?t.isBuyDirection()?!e:e:t.isBuyDirection()?e:!e}let h=e?B.ItemsRendererType.WithBracketButtons:B.ItemsRendererType.Default;const u=this._source.mainItem();return h!==B.ItemsRendererType.Default||void 0!==u&&u.data().qty===this._item.data().qty||(h=B.ItemsRendererType.BracketWithoutParent),{type:h,isGroupInErrorState:this._source.isInErrorState?.(),
...this._renderDataGeneral(o),...this._renderDataForTPSLButtons(this._item),callbacks:this._callbacks(this._projectionBracketsForItem(this._item)),line:this._renderDataForLine(o),qty:{...this._renderDataForQty(o.qty),title:this._item.texts().qty.title},text:{...this._renderDataForText(o.text),title:this._item.profitLossTooltip()},point:this._renderDataForPoint(),close:r,confirm:this._renderDataForConfirm(),cancel:this._renderDataForCancel(),informer:l,movingFillFromArea:c?{backgroundColor:(0,i.ensureDefined)(o.movingBackgroundColor)}:void 0,isMovingFillTo:!this._source.allItemsHadBeenMoved()&&e}}_callbacks(t=[]){const e=this._source,o=super._callbacks(t),r={label:`[${this._modeGaLabel()}]`};if(this._item.isMovingEnabled()&&!this._isNoOverlapMode&&(o.onMove=t=>e.onMove(this._item.id(),t),o.onFinishMove=()=>e.onFinishMove(this._item.id(),r)),this._item.supportModify()&&(o.onModify=()=>this._item.onModify(r)),this._item.supportClose()&&this._isCloseVisible()&&(o.onClose=()=>this._item.onClose(r)),this._item.canQtyCalcModify())o.onQtyModify=(t,e)=>this._item.toggleQtyModify(t,e,r);else{const t=this._source.mainItem();void 0!==t&&t.id()===this._item.id()&&this._item.supportModify()&&(o.onQtyModify=()=>{this._item.onModify(r)})}return o}}class Ve extends Ae{constructor(t){const{item:e,source:o,chartModel:r,mainItemStyle:i,additionalData:s,callbacks:a}=t;super(e,o,r,i,s,a),this._source=o}_callbacks(t=[]){const e=super._callbacks(t),o={label:`[${this._modeGaLabel()}]`};return this._item.supportClose()&&this._isCloseVisible()&&(e.onClose=async()=>this._source.onClose(o)),this._isNoOverlapMode||(this._item.isMovingEnabled()&&(e.onMove=t=>this._source.onMove(this._item.id(),t),e.onFinishMove=()=>this._source.onFinishMove(this._item.id(),o)),this._item.canSwitchType()&&(e.onText=(t,e)=>this._item.toggleType(t,e,o))),e}_renderDataForText(t){return{...super._renderDataForText(t),active:{visible:this._isHoveredItemPart(this._item,2),backgroundColor:t.activeColor}}}}class Fe extends Le{rendererData(){const t=Be(this._item,this._source,(()=>this._chartModel.dark().value()),this._source.styleOverrides?.()?.order),e=this._item.bracketType()===n.BracketType.TakeProfit,o=this._item.extractErrorMessage(),r=o?{title:o,iconColor:t.informer.iconColor,backgroundColor:t.informer.backgroundColor}:void 0,s=this._item.bracketType()===n.BracketType.StopLoss||this._item.bracketType()===n.BracketType.TrailingStop||this._item.bracketType()===n.BracketType.GuaranteedStop,a=(0,i.ensureDefined)(this._itemWithButtons()),l=(this._item.price()??-1/0)<(a.price()??-1/0),d=this._item.bracketType()===n.BracketType.TakeProfit?a.isBuyDirection()?!l:l:a.isBuyDirection()?l:!l;return{type:B.ItemsRendererType.Projection,...this._renderDataGeneral(t),drawWithTPOffset:e,drawWithSLOffset:s,movingFillFromArea:d?{backgroundColor:(0,i.ensureDefined)(t.movingBackgroundColor)}:void 0,isGroupInErrorState:this._source.isInErrorState?.(),callbacks:this._callbacks(),line:this._renderDataForLine(t),qty:this._renderDataForQty(t.qty),text:{...this._renderDataForText(t.text),
title:this._item.profitLossText(),active:{visible:!1,backgroundColor:t.qty.activeColor}},informer:r,point:this._renderDataForPoint(),close:this._renderDataForClose(t.close),isMovingFillTo:!1}}}function Ne(t){const{item:e,source:o,chartModel:r,mainItemStyle:i,additionalData:s,callbacks:a}=t;if((0,u.isPositionItem)(e))return new He(e,o,r,i,s,a);if((0,u.isPreOrderItem)(e))return new Ve({item:e,source:o,chartModel:r,mainItemStyle:i,additionalData:s,callbacks:a});if((0,u.isProjectionBracketItem)(e))return new Fe(e,o,r,i,s,a);if((0,h.isOrderLikeItem)(e))return new Ae(e,o,r,i,s,a);throw new Error("Unknown traded item type")}var qe,Ee;!function(t){t[t.NormalRightBodyPadding=64]="NormalRightBodyPadding",t[t.MobileRightBodyPadding=40]="MobileRightBodyPadding",t[t.FontSize=13]="FontSize"}(qe||(qe={})),function(t){t[t.Large=380]="Large",t[t.Small=280]="Small"}(Ee||(Ee={}));class Ge{constructor(t,e,o){this._prevItemTokens=new Map,this._displayMode=2,this._invalidated=!0,this._isTouchInteractionEnabled=!0,this._chartModel=t,this._source=e,this._tradedGroupRenderersController=o,this._showOrderProperty=e.showOrderProperty(),this._showPositionProperty=e.showPositionProperty(),this._renderer=new E(13,this._tradedGroupRenderersController),this._tradedGroupRenderersController.registerRenderer(this._renderer),this._source.positionDisplayMode().subscribe(this._renderer,this._renderer.clearMinTextWidthCache),this._source.bracketsDisplayMode().subscribe(this._renderer,this._renderer.clearMinTextWidthCache)}destroy(){this._tradedGroupRenderersController.removeRenderer(this._renderer),this._source.positionDisplayMode().unsubscribe(this._renderer,this._renderer.clearMinTextWidthCache),this._source.bracketsDisplayMode().unsubscribe(this._renderer,this._renderer.clearMinTextWidthCache)}update(){this._invalidated=!0}makeSureIsUpdated(t){if(this._invalidated){const e=this._displayMode;this._calculateMode(t.mediaSize.width),e!==this._displayMode&&this._renderer.clearMinTextWidthCache(),this._tradedGroupRenderersController.invalidateCache(),this._updateImpl(),this._invalidated=!1}}renderer(){return this._renderer}priceToCoordinate(t){if(null===t)return null;const e=this._chartModel.mainSeries(),o=e.firstValue();return null===o?null:e.priceScale().priceToCoordinate(t,o)}_calculateMode(t){this._displayMode=t<Ee.Large?1:2}_mainItemStyle(){const t=this._source.mainItem();return void 0===t?(0,g.getStyleForOppositeDirection)(this._source.items().brackets[0],this._source,(()=>this._chartModel.dark().value()),this._source.styleOverrides?.()?.order):(0,h.isPositionLikeItem)(t)?(0,P.getDefaultStyleForPositionItem)(t.isBuyDirection(),this._source.isBlocked(),(()=>this._chartModel.dark().value()),t.lineStyle(),this._source.styleOverrides?.()?.position):((0,i.assert)((0,h.isOrderLikeItem)(t),"Unexpected traded item type"),Re(t,this._source,(()=>this._chartModel.dark().value())))}_rightPadding(){return 2!==this._displayMode?40:64}_sortedItems(){const t=[],e=this._source.items();let o=null,r=null,i=null;const s=e.brackets.slice()
;if(s.push(...e.projectionBrackets),void 0!==e.stopLimit&&s.push(e.stopLimit),void 0!==e.main&&s.push(e.main),this._tradedGroupRenderersController.isNoOverlapMode())return s;for(const e of s)this._source.movingItem()?.id===e.id()?i=e:this._source.hoveredItem()?.id===e.id()?r=e:this._source.selectedItem()?.id===e.id()?o=e:t.push(e);return null!==o&&t.push(o),null!==r&&t.push(r),null!==i&&t.push(i),t}_updateImpl(){if(this._renderer.clearItems(),!this._showOrderProperty.value()&&!this._showPositionProperty.value()||this._isNoData())return;const t=this._mainItemStyle(),e=this._source.isSelected(),o=e&&this._source.isHoveredOtherTradedGroup()?(0,i.ensureDefined)(t.disabledLineColor):t.lineColor,r=this._rightPadding(),s={vertLine:null,horizontalAlignment:this._source.horizontalAlignment(),rightPadding:r,disableTouchInteraction:()=>{0}};(this._source.isHovered()||e)&&(s.vertLine={thickness:this._source.lineWidth(),style:this._source.isPlaced()?m:f,color:o}),this._tradedGroupRenderersController.isNoOverlapMode()&&(s.disableNoOverlap=()=>this._tradedGroupRenderersController.setNoOverlapMode(!1)),this._renderer.setData(s);const a=new Map;for(const e of this._sortedItems()){const i=this.priceToCoordinate(e.price());if(!e.isVisible()||null===i)continue;const s=Ne({item:e,mainItemStyle:t,source:this._source,chartModel:this._chartModel,additionalData:{isNoOverlapMode:this._tradedGroupRenderersController.isNoOverlapMode(),isTouchInteractionEnabled:this._isTouchInteractionEnabled,displayMode:this._displayMode,rightPadding:r,groupLineColor:o,y:i},callbacks:{setNoOverlapMode:t=>this._tradedGroupRenderersController.setNoOverlapMode(t),setTouchInteractionMode:t=>{this._isTouchInteractionEnabled=t}}}).rendererData();this._renderer.addItem(s),a.set(`${s.id} ${e.isBuyDirection()}`,s.id)}this._prevItemTokens.forEach(((t,e)=>{a.has(e)||this._renderer.clearMinTextWidthByItemId(t)})),this._prevItemTokens=a}_isNoData(){const t=this._source.items();return void 0===t.main&&void 0===t.stopLimit&&0===t.brackets.length}}var ze=o(814624);class je extends ze.PriceAxisView{constructor(t,e,o,r){super(),this._model=t,this._data=e,this._priceScaleFormatter=o,this._styleGetter=r}itemId(){return this._data.id()}_updateRendererData(t,e,o){if(t.visible=!1,!this._data.isVisible())return;const r=this._model.mainSeries(),i=r.priceScale(),s=r.firstValue();if(null===s)return;const a=this._data.price();if(null===a)return;const l=this._styleGetter();o.background=l.qty.backgroundColor,o.borderColor=l.labelBorderVisible?l.borderColor:void 0,o.borderStyle=l.labelBorderVisible?l.borderStyle:void 0,o.textColor=l.qty.textColor,o.coordinate=i.priceToCoordinate(a,s),t.borderVisible=l.labelBorderVisible,t.text=this._formatPrice(a),t.tickColor=l.labelTickColor,t.visible=!0}_formatPrice(t){return this._priceScaleFormatter().format(t,{cutFractionalByPrecision:false})}}var Qe,$e=o(885861);class Ue extends $e.PriceLineAxisView{constructor(t,e,o,r,i,s,a){super(),this._chartModel=t,this._data=e,this._source=o,this._showProperty=s,this._height=r,this._verticalPadding=i,
this._styleGetter=a}itemId(){return this._data.id()}_value(){const t=this._chartModel.mainSeries(),e=t.firstValue(),o=this._data.price();if(null===o||null===e)return{noData:!0};const r=t.priceScale().priceToCoordinate(o,e);return{noData:!1,floatCoordinate:r,coordinate:r,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",formattedPriceIndexedTo100:"",text:"",index:0}}_updateRendererData(t,e,o){const r=this._styleGetter();t.linestyle=r.borderStyle,o.additionalPaddingTop=this._verticalPadding,o.additionalPaddingBottom=this._verticalPadding,super._updateRendererData(t,e,o)}_priceLineColor(t){return this._styleGetter().lineColor}_lineWidth(){return this._source.lineWidth()}_lineStyle(){return this._styleGetter().borderStyle}_backgroundAreaHeight(){return this._height}_isVisible(){return this._showProperty.value()}}function Ye(t,e,o){if((0,u.isPositionItem)(o)){const r=()=>(0,P.getDefaultStyleForPositionItem)(o.isBuyDirection(),e.isBlocked(),(()=>t.dark().value()),o.lineStyle(),e.styleOverrides?.()?.position);return{priceAxisView:new je(t,o,(()=>e.priceScaleFormatter()),r),priceLineAxisView:new Ue(t,o,e,19,0,e.showPositionProperty(),r)}}(0,i.assert)((0,h.isOrderLikeItem)(o),"Unexpected traded item type");const r=()=>e.isPlaced()?(0,g.getDefaultStyleForOrderItem)(o,e,(()=>t.dark().value()),e.styleOverrides?.()?.order):Be(o,e,(()=>t.dark().value()));return{priceAxisView:new je(t,o,(()=>e.priceScaleFormatter()),r),priceLineAxisView:new Ue(t,o,e,17,1,e.showOrderProperty(),r)}}!function(t){t[t.OrderBackgroundHeight=17]="OrderBackgroundHeight",t[t.OrderVerticalPadding=1]="OrderVerticalPadding",t[t.PositionBackgroundHeight=19]="PositionBackgroundHeight",t[t.PositionVerticalPadding=0]="PositionVerticalPadding"}(Qe||(Qe={}));class Xe{constructor(t,e){this._model=t,this._source=e}updateAllViews(t){void 0!==this._views.main&&(this._views.main.priceAxisView.update(t),this._views.main.priceLineAxisView.update(t)),void 0!==this._views.stopLimit&&(this._views.stopLimit.priceAxisView.update(t),this._views.stopLimit.priceLineAxisView.update(t));for(const e of this._views.brackets)e.priceAxisView.update(t),e.priceLineAxisView.update(t);for(const e of this._views.project.brackets)e.priceAxisView.update(t),e.priceLineAxisView.update(t)}views(t,e){const o=this._source.movingItem()||null,r=this._source.hoveredItem()||null,i=this._source.selectedItem()||null,s=null!==o?o.id:null,a=null!==r?r.id:null,l=null!==i?i.id:null,n=[],d=[];let c=null,h=null,u=null,p=null,_=null,y=null;const m=this._views.brackets.slice();m.push(...this._views.project.brackets),this._views.main&&m.push(this._views.main),this._views.stopLimit&&m.push(this._views.stopLimit);for(const t of m)t.priceAxisView.itemId()===s?(c=t.priceAxisView,h=t.priceLineAxisView):t.priceAxisView.itemId()===a?(u=t.priceAxisView,p=t.priceLineAxisView):t.priceAxisView.itemId()===l?(_=t.priceAxisView,y=t.priceLineAxisView):(n.push(t.priceAxisView),d.push(t.priceLineAxisView));return null!==_&&null!==y&&(n.push(_),d.push(y)),null!==u&&null!==p&&(n.push(u),d.push(p)),
null!==c&&null!==h&&(n.push(c),d.push(h)),[n,d]}recreateViews(){const t=this._source.items(),e=t.projectionBrackets.filter((t=>null!==t.price())).map((t=>Ye(this._model,this._source,t)));this._views={brackets:t.brackets.map((t=>Ye(this._model,this._source,t))),project:{brackets:e}},void 0!==t.main&&(this._views.main=Ye(this._model,this._source,t.main)),void 0!==t.stopLimit&&(this._views.stopLimit=Ye(this._model,this._source,t.stopLimit))}}var Ke=o(760775),Je=o(484686),Ze=o(851310),to=o(794671);function eo(t){return t instanceof lo}const oo=s.t(null,void 0,o(155304)),ro=s.t(null,void 0,o(14821)),io=s.t(null,void 0,o(337539));function so(t){return void 0!==t&&((0,h.isOrderItemRawData)(t)||(0,h.isPreOrderItemRawData)(t))&&4===t.type}const ao={contextMenu:{cancel:s.t(null,void 0,o(719634)),edit:(0,Ze.appendEllipsis)(s.t(null,void 0,o(224522)))},qty:{title:(0,Ze.appendEllipsis)(s.t(null,void 0,o(224522)))},close:{title:s.t(null,void 0,o(719634))}};class lo extends a.CustomSourceBase{constructor(t,e,o,r,i,s,a,l,n,c){super(t,e),this._hadBeenModifiedAllItems=!1,this._isDestroyed=!1,this._bracketStopType=d.StopType.StopLoss,this._items={brackets:[],projectionBrackets:[]},this._blockedData=null,this._isBlocked=!1,this._mainSeries=e.mainSeries(),this._properties=o,this._configFlags=r,r.supportStopLoss?this._bracketStopType=d.StopType.StopLoss:r.supportTrailingStop?this._bracketStopType=d.StopType.TrailingStop:r.supportGuaranteedStop&&(this._bracketStopType=d.StopType.GuaranteedStop),this._globalVisibility=i,this._globalVisibility.subscribe(this.redraw.bind(this)),this._callbacks=a,this._symbolDataProvider=l,this._symbolDataProvider.onUpdate().subscribe(this,(()=>{this._updateProjectionBracketsItems(),this.items(!0).forEach((t=>{t.fireProfitLossChange(),t.setTexts(this._createTexts())})),this.redraw()})),this._qtySuggester=n,this._paneView=new Ge(this._model,this,c),this._tradedGroupRenderersController=c,this._priceViewsGroup=new Xe(this._model,this),this._rawDataSpawn=s.spawn(),this._rawDataSpawn.subscribe(this._setData.bind(this)),this._properties.positionPL.visibility.subscribe(this,this.redraw),this._properties.bracketsPL.visibility.subscribe(this,this.redraw),this._properties.positionPL.display.subscribe(this,(()=>{this.redraw()})),this._properties.bracketsPL.display.subscribe(this,(()=>{this.redraw()})),this._tradedGroupRenderersController.noOverlapModeChanged().subscribe(this.redraw.bind(this)),this._properties.showPositions.subscribe(this,(()=>{this._tradedGroupRenderersController.setNoOverlapMode(!1)})),this._properties.showOrders.subscribe(this,(()=>{this._tradedGroupRenderersController.setNoOverlapMode(!1)})),this._model.mainSeries().dataEvents().symbolResolved().subscribe(this,(()=>{this._tradedGroupRenderersController.setNoOverlapMode(!1)})),this._model.onSelectedSourceChanged().subscribe(this,(()=>{this._model.selection().allSources().filter((t=>!eo(t))).length>0&&this._tradedGroupRenderersController.setNoOverlapMode(!1)})),this._model.hoveredSourceChanged().subscribe(this,(()=>{
if(!this._symbolDataProvider.isActualSymbol())return;const t=this._model.hoveredSource();(null===t||t!==this&&eo(t))&&this.redraw()}))}destroy(){this._properties.showOrders.destroy(),this._properties.showPositions.destroy(),this._properties.positionPL.visibility.unsubscribeAll(this),this._properties.positionPL.display.unsubscribeAll(this),this._properties.bracketsPL.visibility.unsubscribeAll(this),this._properties.bracketsPL.display.unsubscribeAll(this),this._model.mainSeries().dataEvents().symbolResolved().unsubscribeAll(this),this._rawDataSpawn.destroy(),this._items.main?.destroy(),this._items.stopLimit?.destroy(),this._items.brackets.forEach((t=>t.destroy())),this._items.projectionBrackets.forEach((t=>t.destroy())),this._globalVisibility.unsubscribe(),this._paneView.destroy(),this._symbolDataProvider.onUpdate().unsubscribeAll(this),this._symbolDataProvider.destroy(),this._isDestroyed=!0}isSelectionEnabled(){return!0}priceScaleFormatter(){return this._mainSeries.formatter()}showPositionProperty(){return this._properties.showPositions}showOrderProperty(){return this._properties.showOrders}bracketStopType(){return this._bracketStopType}setBracketStopType(t){this._bracketStopType=t,this._updateProjectionBracketsItems(!0),this.redraw()}isStopLossSupported(){const t=this.items().main;return void 0!==t&&(Boolean(t.data().supportStopLoss)&&((0,u.isPositionItem)(t)?this._symbolDataProvider.supportPositionBrackets():this._symbolDataProvider.supportOrderBrackets()))}isTrailingStopSupported(){const t=this.items().main;return void 0!==t&&(Boolean(t.data().supportTrailingStop)&&((0,u.isPositionItem)(t)?this._symbolDataProvider.supportPositionBrackets():this._symbolDataProvider.supportOrderBrackets()))}isGuaranteedStopSupported(){const t=this.items().main;return void 0!==t&&(Boolean(t.data().supportGuaranteedStop)&&((0,u.isPositionItem)(t)?this._symbolDataProvider.supportPositionBrackets():this._symbolDataProvider.supportOrderBrackets()))}supportRiskControlsAndInfo(){return!!this._symbolDataProvider.supportRiskControlsAndInfo()}isReverseVisible(){return this._properties.showReverse.value()}isPlusButtonVisible(){return this._properties.plusButtonVisibility.value()}lineWidth(){return this._properties.lineProperties.width.value()}lineStyle(){return this._properties.lineProperties.style.value()}isLineExtended(){return this._properties.lineProperties.extend.value()}isPositionPLVisible(){return this._properties.positionPL.visibility}positionDisplayMode(){return this._properties.positionPL.display}isBracketsPLVisible(){return this._properties.bracketsPL.visibility}bracketsDisplayMode(){return this._properties.bracketsPL.display}horizontalAlignment(){return this._properties.horizontalAlignment.value()}isBlocked(){return this._isBlocked}disabled(){return this.isBlocked()}hasError(){return!1}isConfirmButtonOnDomWidget(){return!1}setIsBlocked(t){const e=this._isBlocked;this._isBlocked=t,!0===e&&!1===this._isBlocked&&this.syncData(),this.redraw()}isHovered(){return this._model.hoveredSource()===this}isHoveredOtherTradedGroup(){
return!this.isHovered()&&eo(this._model.hoveredSource())}isSelected(){return this._model.selection().isSelected(this)}items(t,e){if(t){const t=[];return this._items.stopLimit&&!e?.exceptStopLimit&&t.push(this._items.stopLimit),this._items.main&&!e?.exceptMain&&t.push(this._items.main),e?.exceptBrackets||t.push(...this._items.brackets),e?.exceptProjection||t.push(...this._items.projectionBrackets),t}return this._items}baseItem(){return this._items.stopLimit??this._items.main}findItem(t){let e=this.items(!0).find((e=>e.id()===t));return void 0===e&&(e=this.items(!0).find((e=>{const o=e.data();return"id"in o&&o.id===t}))),(0,i.assert)(void 0!==e,`Traded item with id ${t} is not found`),e}findItemWithType(t,e){const o=e===c.TradedItemType.Position?u.isPositionItem:h.isOrderLikeItem;return this.items(!0,{exceptStopLimit:!0}).find((e=>o(e)&&e.data().id===t))}movingItem(){const t=this._model.customSourceBeingMoved()===this&&this._model.customSourceMovingHitTestData()||null;return null===t||void 0===t.activeItem?null:t.activeItem}hoveredItem(){const t=this._model.hoveredSource()===this&&this._model.lastHittestData()||null;return null===t||void 0===t.activeItem?null:t.activeItem}selectedItem(){const t=this._model.selection().isSelected(this)&&this._model.lastSelectedHittestData()||null;return null===t||void 0===t.activeItem?null:t.activeItem}priceScale(){return this._mainSeries.priceScale()}updateAllViews(){this._paneView.update(),this._priceViewsGroup.updateAllViews((0,l.sourceChangeEvent)(this.id()))}updateViewsForPane(t){this._isSourceShouldBeShownOnPane(t)&&this.updateAllViews()}paneViews(t){return this._isSourceShouldBeShownOnPane(t)?[this._paneView]:[]}priceAxisViews(t,e){if(!this._isSourceShouldBeShownOnPane(t))return[];const[o,r]=this._priceViewsGroup.views(t,e);return t.findTargetPriceAxisViews(this,e,o,r)}redraw(){this.updateAllViews(),this._isSourceShouldBeShown()&&this._model.updateSource(this)}syncData(){this._isDestroyed||(null!==this._blockedData?(this._setData(this._blockedData),this._blockedData=null):this._setData(this._rawDataSpawn.value()))}allItemsSupportMove(t){if(void 0===this._items.main)return!1;for(const t of this._items.projectionBrackets)if(null!==t.price())return!1;return!(t.length<2)&&t.every((t=>(0,h.isOrderLikeItem)(t)&&t.isMovingEnabled()))}allItemsHadBeenMoved(){return this._hadBeenModifiedAllItems}onMove(t,e,o=!1){const r=this.findItem(t),s=r.price(),a=this.items(!0);if(o&&this.setIsBlocked(!0),e.shiftKey&&null!==r.price()&&this.allItemsSupportMove(a)){this._hadBeenModifiedAllItems=!0;const t=(0,i.ensureNotNull)(r.calcPriceDiff(e));a.forEach((e=>{(0,u.isProjectionBracketItem)(e)||e.applyPriceDiff(t)})),this._callbacks.hideChartHint()}else{if(r===this._items.main&&this._items.main.data().trailingStopPips&&null!==r.price()){const t=(0,i.ensureNotNull)(r.calcPriceDiff(e));a.forEach((e=>{(0,u.isOrderItem)(e)&&e.bracketType()===n.BracketType.TrailingStop&&!0===e.data().supportMove&&e.applyPriceDiff(t)}))}r.onMove(e),this._updateLimitPartOfStopLimitOrderIfNeeded(),
this._moveOtherProjectionBracketIfNeeded(r)}null===s&&null!==r.price()&&this._priceViewsGroup.recreateViews(),this.redraw()}styleOverrides(){return null}isEdited(){return!1}_updateStopLimit(t){const e=this._items.main,o=this._items.stopLimit;so(t.main)&&void 0===o?this._items.stopLimit=this._createStopLimitItem(t,e):so(t.main)&&void 0!==o?o.setData(this._dataForStopLimitOrder(t.main)):void 0!==o&&(this._convertStopLimitOrderToMainItem(t.main,o),this._deleteStopLimitItem())}_positionVisibilityGetter(){return this._isSourceShouldBeShown()&&this.showPositionProperty().value()}_orderVisibilityGetter(){return this._isSourceShouldBeShown()&&this.showOrderProperty().value()}_setData(t,e=!0){if(this.isBlocked())this._blockedData=t,(0,u.isPositionItem)(this._items.main)&&void 0!==t.main&&((0,i.assert)((0,h.isPositionItemRawData)(t.main)),this._items.main.setData(t.main));else{const o=t.main?.symbol??t.brackets[0]?.symbol??null;t=(0,r.default)(t),e?this._updateItems(t):this._createItems(t),this._updateProjectionBracketsItems(),this._priceViewsGroup.recreateViews(),this._symbolDataProvider.start(o)}this.redraw()}_processedBracketData(t){return t}_createStopLimitItem(t,e){let o;if(void 0!==t.main&&((0,h.isOrderItemRawData)(t.main)||(0,h.isPreOrderItemRawData)(t.main))&&((0,u.isOrderItem)(e)||(0,u.isPreOrderItem)(e))&&4===e.type()){const e=this._dataForStopLimitOrder(t.main);o=(0,p.createItem)(p.TradedGroupItemType.LimitPartStopLimitOrder,e,this,this._model,{itemExternalServices:{symbolDataProvider:this._symbolDataProvider,qtySuggester:this._qtySuggester,tradedGroupRenderersController:this._tradedGroupRenderersController},visibilityGetters:{order:this._orderVisibilityGetter.bind(this),position:this._positionVisibilityGetter.bind(this)},sourceCallbacks:this._callbacks},ao)}return o}_deleteStopLimitItem(){this._items.stopLimit?.destroy(),delete this._items.stopLimit}_isSourceShouldBeShown(){return!!this._globalVisibility.value()&&(!!this._symbolDataProvider.isActualSymbol()&&!(window.TradingView.printing&&!(0,Je.isTradingObjVisibleOnScreenshot)()))}_getToggleStopTypeMenuHandler(){const t=[];return this.isStopLossSupported()&&t.push({title:oo,value:d.StopType.StopLoss}),this.isTrailingStopSupported()&&t.push({title:ro,value:d.StopType.TrailingStop}),this.isGuaranteedStopSupported()&&t.push({title:io,value:d.StopType.GuaranteedStop}),(e,o,r,i,s)=>{const a=this.mainItem();if(e){const t=a&&(0,u.isPositionItem)(a)?"Chart Position":"Chart Order";this._callbacks.trackEvent(t,"Stop loss type menu opening",r.label??"")}if(t.length>1){const r=this._model.timeScale(),a=[r.onScroll(),r.barSpacingChanged(),this._mainSeries.onSymbolIntervalChanged()],l=t.findIndex((t=>t.value===this._bracketStopType));(0,_.updateDropdownMenu)(e,o,t,l,"Stop bracket type",a,(t=>this.setBracketStopType(t)),i,s)}}}_updateLimitPartOfStopLimitOrderIfNeeded(){const t=this._items.main,e=this._items.stopLimit,o=e?.data();o&&void 0!==t&&(0,u.isOrderItem)(t)&&t.setData({...t.data(),limitPrice:o.limitPrice})}_moveOtherProjectionBracketIfNeeded(t){
const e=this._items.main,o=[...this._items.projectionBrackets,...this._items.brackets.filter((t=>(0,Q.isPreBracketOrder)(t.data().id)))];if(!((0,u.isProjectionBracketItem)(t)||(0,Q.isPreBracketOrder)(t.data().id))||void 0===e||!e.supportOnlyPairBrackets()||o.length<2)return;const r=(0,i.ensureNotNull)(e.price()),s=(0,i.ensureNotNull)(t.price())-r,a=(0,i.ensureDefined)(o.find((e=>e!==t))),l=r-s;if((0,u.isProjectionBracketItem)(a))a.setPrice(l);else{const t={...a.data(),price:l};1===t.type?t.limitPrice=l:t.stopPrice=l,a.setData(t)}}_createItems(t){const e=this._createMainItem(t),o=this._createStopLimitItem(t,e);this._items={main:e,stopLimit:o,brackets:t.brackets.map((t=>this._createBracketItem(t))),projectionBrackets:[]}}_updateItems(t){void 0===this._items.main&&void 0!==t.main?this._items.main=this._createMainItem(t):void 0!==this._items.main&&void 0!==t.main?this._updateMainItem(t.main):void 0!==this._items.main&&void 0===t.main&&this._deleteMainItem(),this._updateStopLimit(t),this._updateBrackets(t.brackets)}_updateBrackets(t){const e=[];this._items.brackets.forEach((o=>{const r=t.findIndex((t=>t.id===o.data().id));-1!==r?(o.setData(this._processedBracketData(t[r])),t.splice(r,1)):e.push(o)})),e.forEach((t=>{const e=this._items.brackets.findIndex((e=>e.data().id===t.data().id));-1!==e&&(this._items.brackets[e].destroy(),this._items.brackets.splice(e,1))})),t.forEach((t=>{const e=this._createBracketItem(t);this._items.brackets.push(e)}))}_updateProjectionBracketsItems(t=!1){const e=this._items.main;if(void 0===e||!e.supportBrackets())return;const{takeProfit:o,stopLoss:r,guaranteedStop:s,trailingStop:a}=(0,Q.bracketsByType)(this._items.brackets),l=r??a??s,{takeProfit:d,stopLoss:c,guaranteedStop:h,trailingStop:u}=(0,Q.bracketsByType)(this._items.projectionBrackets),_=c??u??h;[[o,d],[l,_]].forEach((([t,o])=>{const r=e.qty();if(null!==r&&o?.setQty(r),t&&o){const t=this._items.projectionBrackets.indexOf(o);this._items.projectionBrackets[t].destroy(),this._items.projectionBrackets.splice(t,1)}}));const y=e.data();if(!o&&!d){const t=(0,Q.buildProjectionBracketData)(to.projectBracketPrefix,n.BracketType.TakeProfit,y),e=(0,p.createItem)(p.TradedGroupItemType.ProjectionBracket,t,this,this._model,{itemExternalServices:{symbolDataProvider:this._symbolDataProvider,qtySuggester:this._qtySuggester,tradedGroupRenderersController:this._tradedGroupRenderersController},visibilityGetters:{order:this._orderVisibilityGetter.bind(this),position:this._positionVisibilityGetter.bind(this)},sourceCallbacks:this._callbacks},ao);this._items.projectionBrackets.push(e)}if(!l&&!_||t){const t=(0,i.ensureNotNull)((0,Ke.getBracketTypeByStopType)(this._bracketStopType)),e=(0,Q.buildProjectionBracketData)(to.projectBracketPrefix,t,y);if(_)_.setData(e);else{const t={itemExternalServices:{symbolDataProvider:this._symbolDataProvider,qtySuggester:this._qtySuggester,tradedGroupRenderersController:this._tradedGroupRenderersController},visibilityGetters:{order:this._orderVisibilityGetter.bind(this),position:this._positionVisibilityGetter.bind(this)},
sourceCallbacks:this._callbacks};0;const o=(0,p.createItem)(p.TradedGroupItemType.ProjectionBracket,e,this,this._model,t,ao);this._items.projectionBrackets.push(o)}}}_deleteMainItem(){(0,i.ensureDefined)(this._items.main).destroy(),delete this._items.main,this._deleteStopLimitItem()}_isSourceShouldBeShownOnPane(t){return t.containsMainSeries()}}},449859:(t,e,o)=>{"use strict";o.d(e,{BaseItem:()=>g,numericFormatters:()=>y,plSign:()=>_});var r=o(609838),i=o(650151),s=o(229144),a=o(144421),l=o(627692),n=o(90461),d=o(917053),c=o(611821),h=o(934722),u=o(894862),p=o(502586);function _(t,e){return`${t>0?"+":t<0?"":""}${e?"":""}`}const y={integerFormatter:(0,c.getNumericFormatter)(0),oneDecimalFormatter:(0,c.getNumericFormatter)(1),twoDecimalFormatter:(0,c.getNumericFormatter)(2)},m=r.t(null,void 0,o(169961)),f=r.t(null,void 0,o(168222)),b=r.t(null,void 0,o(874115)),C=r.t(null,void 0,o(904543)),v=r.t(null,void 0,o(7953));class g{constructor(t,e,o,r,i,s,a){this._contextMenu=null,this._profitLossChanged=new l.Delegate,this._mainSeries=o,this._source=e,this._symbolDataProvider=r,this._gaOrigin=i,this._infoGetters=s,this._itemCommands=a,this._texts=s.texts,this.setData(t)}destroy(){this._formatPlWV?.destroy(),this._plColorWV?.destroy(),this._profitLossChanged.destroy(),this._contextMenu?.hide()}data(){return this._data}texts(){return this._texts}setTexts(t){this._texts=t}price(){return this._data.price}setData(t){this._data=(0,a.clone)(t)}priceText(){return(0,i.ensureNotNull)(this._symbolDataProvider.symbolData()).priceFormatter.format((0,i.ensureNotNull)(this.price()))}supportOnlyPairBrackets(){return!1}plColorWV(){return void 0===this._plColorWV&&(this._plColorWV=(0,n.createWVFromGetterAndSubscription)((()=>this.profitLossTextColor()),this._profitLossChanged)),this._plColorWV}formatPlWV(){return void 0===this._formatPlWV&&(this._formatPlWV=(0,n.createWVFromGetterAndSubscription)((()=>this.profitLossText()),this._profitLossChanged)),this._formatPlWV}hasContextMenu(){return this.supportModify()||this.supportClose()}useMinTickFormatter(){return!0}isBuyDirection(){return 1===this._data.side}isVisible(){return this._infoGetters.visibility()}fireProfitLossChange(){this._profitLossChanged.fire()}profitLossText(t){if(!this._data)return"";const e=this._potentialProfitLoss();if(null===e)return"";let o;switch(this._infoGetters.displayMode.value()){case d.PlDisplay.Money:o=this.moneyText(e,!0);break;case d.PlDisplay.Pips:o=this.pipsText(e,!0);break;case d.PlDisplay.Percentage:o=this.percentageText(e,!0)}return(0,s.startWithLTR)(o)}percentageText(t,e){const o=_(t,e),r=this._source.baseItem(),i=r?.price()??null;if(null===i)return"";const s=100*t/i*this._data.side;return`${o}${y.twoDecimalFormatter.format(Math.abs(s))}%`}moneyText(t,e){if(!this._source.supportRiskControlsAndInfo())return"";const o=this._symbolDataProvider.pipValue();if(null===o||(0,a.isNaN)(o.sellPipValue)||(0,a.isNaN)(o.buyPipValue))return"";const r=_(t,e),s=(0,
i.ensureNotNull)(this._symbolDataProvider.symbolData()),l=t/(s.pipSize||s.minTick)*this._data.side,n=this.isBuyDirection()?o.buyPipValue:o.sellPipValue,d=Math.abs((0,p.pipsToRiskInCurrency)(l,this._data.qty,n,s.priceMagnifier,s.lotSize));return`${`${r}${y.twoDecimalFormatter.format(d)}`} ${this.currency()}`}pipsText(t,e){const s=_(t,e),a=(0,i.ensureNotNull)(this._symbolDataProvider.symbolData()),l=isFinite(a.pipSize)&&a.pipSize!==a.minTick?y.oneDecimalFormatter:y.integerFormatter,n=t*this._data.side/(a.pipSize||a.minTick),d=Math.abs(n),c=l.format(d),h=r.t(null,{plural:"pips",count:d},o(674759)),p=r.t(null,{plural:"ticks",count:d},o(111913));switch(this._symbolDataProvider.pipValueType()){case u.PipValueType.Pips:return`${s}${c} ${h}`;case u.PipValueType.Ticks:return`${s}${c} ${p}`}return""}priceTooltip(){const t=this.price(),e=null!==t?this._source.priceScaleFormatter().format(t):"";return`${v} ${e}`}tryBasePlOnLast(){return!1}lineStyle(){return h.LineStyle.Solid}confirmText(t){if(this._source.isPlaced())return b;const e=1===this._data.side?m:f;return t?e:`${e} ${this.qtyText()} @ ${this.priceText()}`}cancelText(t){return C}extractErrorMessage(){return this._source.extractItemErrorMessage?.(this.id())??null}_trackEventGA(t){const{origin:e=this._gaOrigin,event:o,label:r}=t;(0,i.assert)(!!o,"GA Event shouldn' be empty"),this._itemCommands.trackEvent(e,o,r)}_quantityText(t){return(0,i.ensureNotNull)(this._symbolDataProvider.symbolData()).quantityFormatter.format(t)}}},287104:(t,e,o)=>{"use strict";o.d(e,{ItemRenderer:()=>b,ItemsRendererType:()=>r,activeItemToHitTestResultData:()=>m});var r,i,s=o(650151),a=o(610555),l=o(799573),n=o(884684),d=o(887084),c=(o(691552),o(601227)),h=o(617233),u=o(917053),p=o(612930);function _(t,e,o,r,i,s){t.save(),t.fillStyle=s,t.fillRect(e,o,r,i),t.restore()}!function(t){t[t.Position=0]="Position",t[t.WithBracketButtons=1]="WithBracketButtons",t[t.Projection=2]="Projection",t[t.Default=3]="Default",t[t.BracketWithoutParent=4]="BracketWithoutParent"}(r||(r={})),function(t){t[t.BorderWidth=1]="BorderWidth",t[t.TextHorizontalPadding=7]="TextHorizontalPadding",t[t.BodyHeight=19]="BodyHeight",t[t.BodyHeightMobile=23]="BodyHeightMobile",t[t.CloseSize=7]="CloseSize",t[t.CloseHorizontalLeftPadding=8]="CloseHorizontalLeftPadding",t[t.CloseHorizontalRightPadding=8]="CloseHorizontalRightPadding",t[t.BorderRadius=4]="BorderRadius",t[t.PointRadius=2.5]="PointRadius",t[t.PointBorderWidth=1]="PointBorderWidth",t[t.ShadowAdditionalRadius=3]="ShadowAdditionalRadius",t[t.CenterBodyPercentagePadding=40]="CenterBodyPercentagePadding",t[t.RightBodyPercentagePadding=5]="RightBodyPercentagePadding",t[t.InformerWidth=18]="InformerWidth",t[t.InfrormerMargin=5]="InfrormerMargin",t[t.NotificationBackdropHeight=20]="NotificationBackdropHeight",t[t.PlusButtonOffset=20]="PlusButtonOffset"}(i||(i={}));const y=c.CheckMobile.any()||c.CheckMobile.isIPad();function m(t){return{activeItem:t,equals:e=>!!e.activeItem&&e.activeItem.id===t.id&&e.activeItem.part===t.part}}function f(t,e,o,r,i){return s=>{s.preventDefault()
;const l=s.clientX-s.localX,n=s.clientY-s.localY,d=new a.Point(e+l,r+n);t((t=>t.x>e&&t.x<=e+i&&t.y>o&&t.y<=r),d)}}class b{constructor(t,e,o,r){this._height=y?23:19,this._bodyBorderRadius=4,this._font=null,this._offsets=null,this._alignedTop=null,this._wasSourceMoved=!1,this._cache=null,this._cacheWithOffset=null,this._textWidthCache=e,this._minMainTextWidthGetter=r,this._data=t,this._font=o,this._initCtx()}data(){return this._data}clearCache(){this._cache=null,this._cacheWithOffset=null}applyOffset(t){this._offsets=t}setAlignedTopCoordinate(t){this._alignedTop=t}hitTest(t,e){const o=this.rectWithOffsets(e),{horizontalPixelRatio:r,verticalPixelRatio:i}=e,a=Math.round(t.x*r),c=Math.round(t.y*i),h=a>=o.left,u=a<=o.right,p=h&&u,_=c>=o.top&&c<=o.bottom,y={cursorType:d.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...m({id:this._data.id,part:9})};if(this._data.disabled)return new n.HitTestResult(n.HitTarget.Custom,y);let b={};if(void 0!==this._data.callbacks.onMove){const t=t=>{this._data.callbacks.onMove&&this._data.callbacks.onMove(t),this._wasSourceMoved=!0},e=()=>{this._wasSourceMoved&&this._data.callbacks.onFinishMove&&this._data.callbacks.onFinishMove(),this._wasSourceMoved=!1};b={pressedMouseMoveHandler:t,touchMoveHandler:t,mouseUpHandler:e,touchEndHandler:e,cancelMoveHandler:this._data.callbacks.onCancelMove}}const C=this._data.callbacks.onContextMenu,v=this._data.callbacks.onContextMenu,g={...y,...b,hasOwnShortcutsBehaviourFor:{shiftKey:!0},contextMenuHandler:C,touchContextMenuHandler:v};if(this._isPriceLineIntersected(a,c,e))return new n.HitTestResult(n.HitTarget.Custom,{...g,...m({id:this._data.id,part:9}),cursorType:d.PaneCursorType.VerticalResize});if(!_||!p)return null;const P=Math.round(o.top/i);if(a>=o.close.left&&u&&void 0!==this._data.callbacks.onClose){const t=Math.round(o.body.right/r),e=Math.round(o.close.left/r);return new n.HitTestResult(n.HitTarget.Custom,{...g,...m({id:this._data.id,part:3}),cursorType:d.PaneCursorType.Pointer,clickHandler:this._data.callbacks.onClose,tapHandler:this._data.callbacks.onClose,tooltip:{extendMargin:!0,text:(0,s.ensureDefined)(this._data.close).title,rect:{x:e,y:P,w:t-e,h:this._height}}})}if(this._data.callbacks?.allInteractionsHandler)return new n.HitTestResult(n.HitTarget.Custom,{...y,clickHandler:this._data.callbacks.allInteractionsHandler,tapHandler:this._data.callbacks.allInteractionsHandler,contextMenuHandler:this._data.callbacks.allInteractionsHandler,touchContextMenuHandler:this._data.callbacks.allInteractionsHandler});if(a>=o.text.left&&a<o.close.left){const t=Math.round(o.text.left/r),e=Math.round(o.bottom/i),s=Math.round(o.text.width/r);if(void 0!==this._data.callbacks.onText){const o=f(this._data.callbacks.onText,t,P,e,s),r=t=>{t.preventDefault(),!0===this._data.isTouchInteractionEnabled?o(t):this._data.callbacks.enableTouchInteraction()};return new n.HitTestResult(n.HitTarget.Custom,{...g,...m({id:this._data.id,part:2}),cursorType:d.PaneCursorType.Pointer,clickHandler:o,tapHandler:r,tooltip:{extendMargin:!0,text:this._data.text.title,rect:{x:t,y:P,
w:s,h:this._height}}})}const a=Math.round(o.close.left/r);return new n.HitTestResult(n.HitTarget.Custom,{...g,...m({id:this._data.id,part:2}),cursorType:this._data.callbacks.onMove?d.PaneCursorType.Pointer:d.PaneCursorType.Default,tooltip:this._data.text.title?{extendMargin:!0,content:{type:"html",data:this._data.text.title},rect:{x:t,y:P,w:a-t,h:this._height}}:void 0})}const k=this._data.callbacks.onQtyModify;if(a>o.qty.left&&a<o.text.left&&void 0!==k){const t=Math.round(o.qty.left/r),e=f(k,t,P,Math.round(o.bottom/i),Math.round(o.qty.width/r)),a=t=>{t.preventDefault(),!0===this._data.isTouchInteractionEnabled?e(t):this._data.callbacks.enableTouchInteraction()},l=Math.round(o.text.left/r);return new n.HitTestResult(n.HitTarget.Custom,{...y,...b,...m({id:this._data.id,part:1}),cursorType:d.PaneCursorType.Pointer,clickHandler:e,tapHandler:a,tooltip:{extendMargin:!0,text:(0,s.ensureDefined)(this._data.qty).title,rect:{x:t,y:P,w:l-t,h:this._height}}})}return void 0!==this.data().informer&&a>o.informer.left&&a<o.informer.left+o.informer.width?new n.HitTestResult(n.HitTarget.Custom,{...g,...m({id:this._data.id,part:9}),cursorType:d.PaneCursorType.Default,touchContextMenuHandler:()=>{},tooltip:{extendMargin:!0,text:(0,s.ensureDefined)(this._data.informer).title,rect:{x:o.informer.left/r,y:P,w:o.informer.width/r,h:this._height},tooltipHideDelay:l.mobiletouch?1500:0}}):new n.HitTestResult(n.HitTarget.Custom,g)}drawBackground(t,e){!this._data.line.drawOnTop&&this._data.visible&&this._drawLine(t,e)}drawLine(t,e){this._isDataVisibleInViewport(e)&&this._data.line.drawOnTop&&this._data.visible&&this._drawLine(t,e)}drawPointOnLine(t,e,o){if(!this._isDataVisibleInViewport(e)||!this._data.point.visible||!this._data.visible)return;const r=this.rectWithOffsets(e),{horizontalPixelRatio:i,verticalPixelRatio:s}=e,a=Math.round(3*i),l=Math.max(1,Math.floor(1*i)),n=l/2,d=2.5*i+n,c=o+(n%1==0?0:.5),p=r.yMid+(n%1==0?0:.5);this._data.line.extend||this._data.bodyAlignment!==u.TradedGroupHorizontalAlignment.Left||(t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*s)),(0,h.setLineStyle)(t,this._data.line.style),(0,h.drawHorizontalLine)(t,r.yMid,c,r.left),t.restore()),t.save(),t.lineWidth=l,(0,h.setLineStyle)(t,this._data.point.borderStyle),this._data.point.shadowColor&&!this._data.disabled&&(t.fillStyle=this._data.point.shadowColor,(0,h.createCircle)(t,c,p,d+a),t.fill()),t.strokeStyle=this._data.point.borderColor,t.fillStyle=this._data.point.backgroundColor,(0,h.createCircle)(t,c,p,d),t.fill(),t.stroke(),Boolean(this._data.point.shadowColor)||((0,h.createCircle)(t,c,p,d+i),t.strokeStyle=this._data.text.backgroundColor,t.stroke()),t.restore()}draw(t,e){if(!this._data.visible)return;const o=this.rectWithOffsets(e);if(!this._isDataVisibleInViewport(e))return;const r=0!==o.qty.width,i=0!==o.text.width,a=0!==o.close.width,l=o.body.right-o.body.left,n=o.bottom-o.top,d=o.top+o.borderWidth,c=n-2*o.borderWidth,u=o.borderRadius-o.borderWidth,{verticalPixelRatio:y,horizontalPixelRatio:m}=e
;void 0!==this._data.informer&&(0,p.drawExclamationIcon)({ctx:t,x:o.informer.left,y:o.yMid-9*y,horizontalPixelRatio:m,verticalPixelRatio:y}),(0,h.drawRoundRectWithInnerBorder)(t,o.body.left,o.top,l,n,this._data.borderBackgroundColor,o.borderRadius,o.borderWidth,this._data.borderColor,this._data.borderStyle);let f=o.body.left+o.borderWidth;if(r){const r=(0,s.ensureDefined)(this._data.qty);this._drawQtyWithBackground(t,e,o,!0,!a&&!i),f+=o.qty.width,o.qty.rightDividerWidth&&(_(t,f,d,o.qty.rightDividerWidth,c,r.dividerColor),f+=o.qty.rightDividerWidth)}if(i&&(this._drawTextWithBackground(t,e,o,!r,!a),f+=o.text.width,o.text.rightDividerWidth&&(_(t,f,d,o.text.rightDividerWidth,c,this._data.text.dividerColor),f+=o.text.rightDividerWidth)),a){const r=(0,s.ensureDefined)(this._data.close),i=o.body.right-f-o.borderWidth;(0,h.drawRoundRectWithInnerBorder)(t,f,d,i,c,r.backgroundColor,[0,u,u,0]),r.active.visible&&(0,h.drawRoundRectWithInnerBorder)(t,f,d,i,c,r.active.backgroundColor,[0,u,u,0]),this._drawCloseButton(t,e,f,o.top,o.close.width,n,o.borderWidth)}}rect(t){return null===this._cache&&(this._cache=this._calculateCacheRect(t)),this._cache}rectWithOffsets(t){return null===this._cacheWithOffset&&(this._cacheWithOffset=this._calculateCacheRectWithOffsets(t)),this._cacheWithOffset}_calculateCacheRect(t){const{horizontalPixelRatio:e,verticalPixelRatio:o,bitmapSize:r}=t,i=Math.max(1,Math.floor(1*e)),s=this._bodyBorderRadius,a=Math.max(s,Math.floor(s*e)),l=this._quantityWidth(this._ctxInternal),n=Math.round(l*e),d=this._mainTextWidth(this._ctxInternal),c=Math.round(d*e),h=this._data.callbacks.onClose?this._closeWidth():0,p=Math.round(h*e),_=this.data().isGroupInErrorState?Math.round(18*e):0;let y=0;const m=l&&(d||h),f=d&&h;y+=m&&1,y+=f&&1;const b=n+c+p+i*y+2*i;let C=Math.round(this._height*e);const v=Math.max(1,Math.floor(e));C%2!=v%2&&(C+=1);const g=Math.round(this._data.y*o),P=Math.floor(g+v/2-C/2)-Math.floor(.5*o),k=this._data.bodyAlignment===u.TradedGroupHorizontalAlignment.Center?Math.round(40*r.width/100):Math.round(this._data.rightPadding*e);let T=k;const x=this._data.bodyAlignment===u.TradedGroupHorizontalAlignment.Left;x&&(T=r.width-k-b);let M=r.width-T,w=M-b;let S=w+n+(n&&i)+(n&&i),B=S+c+(c&&i),D=w+(n&&i);const I=_+5*e;let L=D-I;x&&this.data().isGroupInErrorState&&(w+=I,S+=I,D+=I,M+=I,B+=I,L=D-I);let R=w;return void 0!==this.data().informer&&(R=x?L:w-I),{borderWidth:i,borderRadius:a,yMid:g,top:P,bottom:P+C,left:R,right:M,body:{left:w,right:M},qty:{width:n,left:D,rightDividerWidth:m&&this._data.qty?.isDividerVisible?i:0},text:{width:c,left:S,rightDividerWidth:f?i:0},close:{width:p,left:B},informer:{width:_,left:L}}}_calculateCacheRectWithOffsets(t){const e=this.rect(t),{left:o,right:r}=this._calcCoordinateWithOffset(e.left,e.right),{left:i,right:s}=this._calcCoordinateWithOffset(e.body.left,e.body.right);return{...e,left:o,right:r,top:this._alignedTop?this._alignedTop:e.top,bottom:this._alignedTop?this._alignedTop+(e.bottom-e.top):e.bottom,body:{...e.body,left:i,right:s},qty:{...e.qty,
left:this._calcCoordinateWithOffset(e.qty.left,e.qty.left+e.qty.width).left},text:{...e.text,left:this._calcCoordinateWithOffset(e.text.left,e.text.left+e.text.width).left},close:{...e.close,left:this._calcCoordinateWithOffset(e.close.left,e.close.left+e.close.width).left}}}_calcCoordinateWithOffset(t,e){if(null!==this._cache){const o=this._offsets?.leftmostForItemOffset??null;if(null!==o){const r=t-(this._cache.left-o);return{left:r,right:r+(e-t)}}const r=this._offsets?.rightmostForItemOffset??null;if(null!==r){const o=e+(r-this._cache.right);return{left:o-(e-t),right:o}}}return{left:t,right:e}}_calcAllWidth(t,e,o,r,i,s){return e+o+r+i+2*s}_isDataVisibleInViewport(t){const e=Math.ceil(this._height/2);return this._data.y>=-e&&this._data.y<=t.mediaSize.height+e}_mainTextWidth(t){return this._data.text.text?this._minMainTextWidthGetter(this._data,t)+14:0}_closeWidth(){return 23}_measureTextWidth(t,e){if(!e)return 0;const o=t.font;t.font=(0,s.ensureNotNull)(this._font);const r=Math.ceil(this._textWidthCache.measureText(t,e));return t.font=o,r}_textWidth(t,e){const o=this._measureTextWidth(t,e);return o?Math.round(14+o):0}_quantityWidth(t){const e=this._measureTextWidth(t,this._data.qty?.text);return Math.round(Math.max(this._height,14+e,this._data.qty?.minTextWidth??0))}_drawLine(t,e){const o=this.rectWithOffsets(e),r=e.bitmapSize.width;t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*e.horizontalPixelRatio)),(0,h.setLineStyle)(t,this._data.line.style),void 0!==this._data.informer&&(0,p.drawErrorNotificationBackdrop)({ctx:t,x:0,y:o.yMid,w:e.bitmapSize.width,h:20,horizontalPixelRatio:e.horizontalPixelRatio,verticalPixelRatio:e.verticalPixelRatio}),(0,h.drawHorizontalLine)(t,o.yMid,o.body.right,r),this._data.line.extend&&(0,h.drawHorizontalLine)(t,o.yMid,0,o.body.right),t.restore()}_drawQtyBackground(t,e,o,r,i){const a=(0,s.ensureDefined)(this._data.qty),l=o.bottom-o.top,n=o.top+o.borderWidth,d=l-2*o.borderWidth,c=o.borderRadius-o.borderWidth;let u=0;i?u=r?c:[0,c,c,0]:r&&(u=[c,0,0,c]),(0,h.drawRoundRectWithInnerBorder)(t,o.qty.left,n,o.qty.width,d,a.backgroundColor,u),a.active.visible&&(0,h.drawRoundRectWithInnerBorder)(t,o.qty.left,n,o.qty.width,d,a.active.backgroundColor,u)}_drawQtyWithBackground(t,e,o,r,i){const a=(0,s.ensureDefined)(this._data.qty);this._drawQtyBackground(t,e,o,r,i);const l=(o.top+o.bottom)/2,n=o.qty.left+o.qty.width/2;this._drawText(t,e,a.text,a.textColor,n,l)}_drawTextWithBackground(t,e,o,r,i){const a=o.bottom-o.top,l=o.top+o.borderWidth,n=a-2*o.borderWidth,d=o.borderRadius-o.borderWidth;let c=0;i?c=r?d:[0,d,d,0]:r&&(c=[d,0,0,d]),(0,h.drawRoundRectWithInnerBorder)(t,o.text.left,l,o.text.width,n,this._data.text.backgroundColor,c),this._data.text.active.visible&&(0,h.drawRoundRectWithInnerBorder)(t,o.text.left,l,o.text.width,n,this._data.text.active.backgroundColor,c);const u=o.top+a/2,_=o.text.left+o.text.width/2,y=(this._data.qty||this._data.text).text,m=this._getTextYMidCorrection(t,y)*e.verticalPixelRatio;(0,
p.drawText)(t,e,this._data.text.text,_,u,m,this._data.text.textColor,(0,s.ensureNotNull)(this._font))}_drawText(t,e,o,r,i,a,l){const n=o.split("@").join("").toUpperCase(),d=this._getTextYMidCorrection(t,n)*e.verticalPixelRatio;(0,p.drawText)(t,e,o,i,a,d,r,(0,s.ensureNotNull)(this._font),l)}_drawUnderlinedText(t,e,o,r,i,a){const l=this._getTextYMidCorrection(t,o)*e.verticalPixelRatio,n=this._getTextWidth(t,o);(0,p.drawUnderlinedText)(t,e,o,i,a,l,r,(0,s.ensureNotNull)(this._font),n)}_isPriceLineIntersected(t,e,o){const r=this.rectWithOffsets(o),i=t>=r.left&&t<=r.right,s=t<o.bitmapSize.width-20*o.horizontalPixelRatio&&t>r.right;this._data.line.shouldOffsetPointerEvents&&r.left,!1!==this._data.line.extend||t>r.right||this._data.bodyAlignment===u.TradedGroupHorizontalAlignment.Left&&t<r.left&&r.left;return false}_getTextYMidCorrection(t,e){const o=t.font;t.font=(0,s.ensureNotNull)(this._font);const r=this._textWidthCache.yMidCorrection(t,e);return t.font=o,r}_getTextWidth(t,e){const o=t.font;t.font=(0,s.ensureNotNull)(this._font);const r=this._textWidthCache.getMetrics(t,e);return t.font=o,r.width}_drawCloseButton(t,e,o,r,i,l,n){const d=(0,s.ensureDefined)(this._data.close);t.save(),t.lineWidth=n,t.strokeStyle=d.iconColor,t.setLineDash([]);const c=r+l,u=Math.max(1,Math.ceil(7*e.horizontalPixelRatio)),p=Math.max(1,Math.ceil(7*e.verticalPixelRatio)),_=Math.round((i-u)/2),y=Math.round((l-p)/2);(0,h.drawPoly)(t,[new a.Point(o+_,r+y),new a.Point(o+_+u,c-y)],!0),(0,h.drawPoly)(t,[new a.Point(o+_+u,r+y),new a.Point(o+_,c-y)],!0),t.restore()}_initCtx(){const t=document.createElement("canvas");t.width=0,t.height=0,this._ctxInternal=(0,s.ensureNotNull)(t.getContext("2d"))}}},826741:(t,e,o)=>{"use strict";o.d(e,{OrderBaseItem:()=>k});var r=o(650151),i=o(150335),s=o(229144),a=o(610555),l=o(144421),n=o(243716),d=o(934722),c=o(130557),h=o(917053),u=o(668019),p=o(894862),_=o(721762),y=o(166554),m=o(414903),f=o(753552),b=o(494136);var C=o(687039),v=o(465688),g=o(764146),P=o(449859);class k extends P.BaseItem{constructor(t,e,o,r,i,s,a,l="Chart Order"){super(t,e,o,r,l,i,s),this._inEdit=!1,this._isMoving=!1,this._isQtyModifyOpened=!1,this._isResetQtyCalcValue=!1,this._originalQty=null,this._handleQtyModifyClose=(t,e)=>{t(e)?this.applyQty(this.data().qty):this._handleQtyModifyDestroy()},this._handleQtyModifyDestroy=()=>{this.applyQty(this.data().qty),this._isQtyModifyOpened=!1,this._closeQtyCalc()},this._isBracket()&&this._source.bracketsDisplayMode().subscribe(this,this.fireProfitLossChange),a&&(this._qtyModifyCallbacks={onQtyApplyHandler:a.onQtyApplyHandler,onToggleQtyCalcHandler:a.onToggleQtyCalcHandler,qtyInfoGetter:a.qtyInfoGetter},this._qtyProvider=a.qtyProvider,this._suggestedQtySubscription=this._qtyProvider.subscribe((t=>a?.onQtyProviderUpdate?.(t)))),this._originalQty=this.qty()}destroy(){this._isQtyModifyOpened=!1,this._closeQtyCalc(),this._source.bracketsDisplayMode().unsubscribe(this,this.fireProfitLossChange),this._contextMenu?.hide(),this._suggestedQtySubscription?.unsubscribe(),super.destroy()}supportBrackets(){
return!this._isBracket()&&!(0,C.isUnlinkedBracketOrderRawData)(this._data)&&this._symbolDataProvider.supportOrderBrackets()&&this._symbolDataProvider.supportModifyOrderBrackets()&&this._symbolDataProvider.supportAddBracketsToExistingOrder()}canQtyCalcModify(){return Boolean(this._qtyProvider)}toggleQtyModify(t,e,o={}){this.canQtyCalcModify()&&(this._isQtyModifyOpened=!this._isQtyModifyOpened,this._toggleQtyCalc(t,e,o))}modifyQty(t){this.canQtyCalcModify()&&(t<=0?this._isResetQtyCalcValue=!0:(this._isResetQtyCalcValue=!1,(0,r.ensureDefined)(this._qtyModifyCallbacks).onQtyApplyHandler(t)))}applyQty(t){this.modifyQty(t),this._qtyProvider?.applySuggestedQty(this._data.qty),this._originalQty!==t&&this._itemCommands.trackEvent(this._gaOrigin,"Change quantity")}currency(){return this._symbolDataProvider.orderCurrency()??""}canSwitchType(){return!1}id(){return this._id}setData(t){this._inEdit||(super.setData(t),this.fireProfitLossChange(),this._id=this._calcId())}setInEdit(t){this._inEdit=t}type(){return this._data.type}bracketType(){return this._isBracket()?(0,v.getBracketType)(this._data):null}qty(){return this._data.qty}profitLossText(t){return this._data&&this._isBracket()&&this._source.isBracketsPLVisible()?.value()&&this.bracketType()!==p.BracketType.TrailingStop&&(this._source.supportRiskControlsAndInfo()||this._infoGetters.displayMode.value()!==h.PlDisplay.Money)?super.profitLossText(t):this._bracketTypeText(t)}profitLossTextColor(){if(!this._data)return"";const t=this.style();if(!this._isBracket())return t.text.textColor;const e=this._potentialProfitLoss();return null===e?t.text.textColor:(0,u.profitLossTextColor)(t,e,!1)}profitLossTooltip(){const t=this._source.mainItem(),e=t?.price(),o=this.priceTooltip(),r=this._bracketTypeText();if(null==e||!this._isBracket())return o;const i=this._potentialProfitLoss();if(null===i)return r;if(!this._source.isBracketsPLVisible()?.value()||this.bracketType()===p.BracketType.TrailingStop)return o;const a=(0,s.startWithLTR)(this.percentageText(i)),l=(0,s.startWithLTR)(this.pipsText(i)),n=(0,s.startWithLTR)(this.moneyText(i));switch(this._infoGetters.displayMode.value()){case h.PlDisplay.Money:return`${r} ${a} ${l}<br/>${o}`;case h.PlDisplay.Percentage:return`${r} ${n} ${l}<br/>${o}`;case h.PlDisplay.Pips:return`${r} ${n} ${a}<br/>${o}`;default:return`${r} ${l} ${a} ${n}<br/>${o}`}}lineStyle(){return!1===this._source.isPlaced()||!1===this.isWorking()?d.LineStyle.Dotted:d.LineStyle.Solid}calcPriceDiff(t){const e=new a.Point(t.localX,t.localY),o=this._mainSeries.priceScale(),i=this._mainSeries.firstValue();if(null===i)return null;const s=(0,r.ensureNotNull)(this.price());return o.coordinateToPrice(e.y,i)-s}applyPriceDiff(t){this._inEdit=!0,this._data.price=this._calcPriceByDiff(t)}isMoving(){return this._isMoving}setIsMoving(t){this._isMoving=t}onMove(t){const e=this.calcPriceDiff(t);null!==e&&(this._isMoving=!0,this.applyPriceDiff(e),t.isTouch&&(0,r.ensureDefined)(this._itemCommands.exitTrackingMode)())}async onMoveItem(t={},e=!0,o,i=!0){e&&this._source.setIsBlocked(!0);const s=(0,
l.clone)(this._data),a=(0,r.ensureNotNull)(this.price());return s.limitPrice=t.limitPrice??s.limitPrice,s.takeProfit=t.takeProfit??s.takeProfit,s.stopLoss=t.stopLoss??s.stopLoss,s.guaranteedStop=t.guaranteedStop??s.guaranteedStop,s.stopPrice?s.stopPrice=a:s.limitPrice&&(s.limitPrice=a),this._addTrailingStopPipsData(s,t.trailingStop),this._onMoveOrder(s,o,i)}async onFinishMove(t={},e={},o=!0,i,s=!0){o&&this._source.setIsBlocked(!0);const a=(0,l.clone)(this._data),n=(0,r.ensureNotNull)(this.price());a.limitPrice=e.limitPrice??a.limitPrice,a.takeProfit=e.takeProfit??a.takeProfit,a.stopLoss=e.stopLoss??a.stopLoss,a.guaranteedStop=e.guaranteedStop??a.guaranteedStop,a.stopPrice?a.stopPrice=n:a.limitPrice&&(a.limitPrice=n),a.stopType===_.StopType.GuaranteedStop&&(a.guaranteedStop=n),this._addTrailingStopPipsData(a,e.trailingStop),this._trackEventGA(t);const d=await this._onFinishMoveOrder(a,i,s);return this._inEdit=!1,this._isMoving=!1,d}hasContextMenu(){return super.hasContextMenu()||this.isMovingEnabled()}async onContextMenu(t,e){this.fireProfitLossChange(),e=(0,m.mergeGaParams)(e,{origin:this._source.isPlaced()?"Chart Order Context Menu":"Chart Project Order Context Menu"});const o=this._composeContextMenuActions(e),r={side:(0,y.sideToText)(this._data.side),qty:this.qtyText(),price:this.priceText(),orderType:(0,y.orderTypeToText)({orderType:this._data.type})},i=await async function(t,e){const o=[],r=await(0,b.createContextMenuTitle)("Trading.OrderTitle",e);r&&o.push(r);for(const{actionId:e,label:r,onExecute:i}of t)o.push(new n.Action({actionId:e,options:{label:r,onExecute:i}}));return o}(o,r),s=this._infoGetters.noOverlapAction(e,(t=>this._trackEventGA(t)));s&&(i.push(new n.Separator),i.push(s)),this._contextMenu=await(0,b.showContextMenu)(i,t,(()=>{this._contextMenu=null}),{detail:{type:"order",id:this.id().toString()}})}supportOnlyPairBrackets(){return this._data.supportOnlyPairBrackets}_composeContextMenuActions(t){const e=[];return this.supportModifyFromContextMenu()&&e.push({actionId:"Trading.EditOrder",label:this.texts().contextMenu.edit,onExecute:()=>this.onModifyFromContextMenu(t)}),this.supportClose()&&e.push({actionId:"Trading.CancelOrder",label:this.texts().contextMenu.cancel,onExecute:()=>this.onClose(t)}),e}_calcPriceByDiff(t){const{minTick:e,variableMinTickData:o}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()),s=t+(0,r.ensureNotNull)(this.price()),a=(0,c.getMinTick)({minTick:e,price:s,variableMinTickData:o});return(0,i.fixComputationError)(a*Math.round(s/a))}_addTrailingStopPipsData(t,e){const o=this._source.mainItem();if(void 0===o)return;const{side:i,limitPrice:s,price:a}=o.data(),l=1===i?-1:1,{pipSize:n}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()),d=e??t.stopPrice,c=4===((0,g.isPositionLikeItem)(o)?null:o.data().type)&&void 0!==s?s:a;if((0,C.isBracketOrderRawData)(t)&&t.parentId&&t.stopType===_.StopType.TrailingStop&&void 0!==d){if((0,g.isPositionLikeItem)(o)){const{bid:e,ask:o}=(0,r.ensureNotNull)(this._symbolDataProvider.lastData()),s=1===i?e:o;return t.trailingStopPips=(0,
f.calcPipsByPrice)(d,s,l,n),void(t.trailingStopPrice=d)}return t.trailingStopPips=(0,f.calcPipsByPrice)(d,(0,r.ensureNotNull)(c),l,n),void(t.trailingStopPrice=d)}return void 0!==e&&null!==c?(t.trailingStopPips=(0,f.calcPipsByPrice)(e,c,l,n),void(t.trailingStopPrice=e)):void 0}_bracketTypeText(t){if(!this._data)return"";if(this._isBracket()){const e=(0,v.getBracketTypeToText)(this._data.type,this._data.stopType,t);if(null!==e)return e}return t?(0,y.orderTypeToText)({orderType:this._data.type,uppercase:!0,shorten:!0}):`${(0,y.sideToText)(this._data.side)} ${(0,y.orderTypeToText)({orderType:this._data.type,uppercase:!1})}`}_potentialProfitLoss(){const t=this._source.baseItem();if(!this._data||!t)return null;const e=this.price(),{ask:o,bid:r}=this._symbolDataProvider.lastData()||{},i=t.tryBasePlOnLast()&&3===this._data.type&&this._data.stopType===_.StopType.TrailingStop;if(!(0,l.isNumber)(e))return null;const s=i?this.isBuyDirection()?o:r:t.price();return(0,l.isNumber)(s)?(s-e)*this._data.side:null}_isBracket(){const t=this.data();if(!(0,C.isBracketOrderRawData)(t))return!1;const e=this._source.mainItem();return 1!==t.parentType||void 0!==e&&e.data().side!==this._data.side}_closeQtyCalc(){this._toggleQtyCalc((()=>!1),new a.Point(0,0))}_qtyCalcValueGetter(){return this._isResetQtyCalcValue?0:this.data().qty}_toggleQtyCalc(t,e=new a.Point(0,0),o={}){if(!this.canQtyCalcModify())return;!1===this._isQtyModifyOpened&&(this._originalQty=this.qty());const{onToggleQtyCalcHandler:i,qtyInfoGetter:s}=(0,r.ensureDefined)(this._qtyModifyCallbacks);i({isOpened:this._isQtyModifyOpened,position:e,qtyInfoGetter:s,valueGetter:()=>this._qtyCalcValueGetter(),onValueChange:t=>this.modifyQty(t),onClose:e=>this._handleQtyModifyClose(t,e),onDestroy:this._handleQtyModifyDestroy,closeOnClickOutside:!1})}}},570358:(t,e,o)=>{"use strict";o.d(e,{OrderWithMenuItem:()=>a});var r=o(650151),i=o(610555),s=o(826741);class a extends s.OrderBaseItem{constructor(t,e,o,r,i,s,a,l,n){super(t,e,o,r,i,s,l,n),this._isTypeMenuOpened=!1,this._handleTypeMenuClose=(t,e)=>{t(e)||this._handleTypeMenuDestroy()},this._handleTypeMenuDestroy=()=>{this._isTypeMenuOpened=!1},this._typeMenuCallbacks=a}destroy(){this._typeMenuCallbacks?.closeDropdownMenuHandler(),super.destroy()}isMovingEnabled(){return Boolean(this._symbolDataProvider.symbolData()?.isTradable)}toggleType(t,e,o={}){this._typeMenuCallbacks&&(this._isTypeMenuOpened=!this._isTypeMenuOpened,this._toggleTypeMenu(t,e,o))}async onClose(t){}async onModify(t){return!1}async onModifyFromContextMenu(t){return!1}async _onFinishMoveOrder(t,e,o=!0){return!0}async _onMoveOrder(t,e,o=!0){return!0}_toggleTypeMenu(t,e=new i.Point(0,0),o={}){(0,r.ensureDefined)(this._typeMenuCallbacks).onToggleTypeMenuHandler(this._isTypeMenuOpened,e,o,(e=>this._handleTypeMenuClose(t,e)),this._handleTypeMenuDestroy)}}},941520:(t,e,o)=>{"use strict";o.d(e,{preOrderItemId:()=>r});const r="preOrder"},538453:(t,e,o)=>{"use strict";o.d(e,{TradedGroupItemType:()=>r,createItem:()=>m})
;var r,i=o(650151),s=o(154834),a=o(494136),l=o(764146),n=o(292318),d=o(541184),c=o(97394),h=o(918873),u=o(489891),p=o(988304),_=o(95356);class y{constructor(t,e){this._symbol=t,this._qtySuggester=e}subscribe(t){return this._qtySuggester.suggestedQtyChanged(this._symbol).subscribe(t)}async applySuggestedQty(t){this._qtySuggester.setQty(this._symbol,t)}}function m(t,e,o,m,f,b){const C=m.mainSeries(),v=(t,e)=>(0,a.createNoOverlapMenuAction)(f.itemExternalServices.tradedGroupRenderersController,t,e);if(t===r.Order&&(0,l.isOrderItemRawData)(e)){const{dataType:t,...r}=e,i=t=>(0,u.getDefaultStyleForOrderItem)(t,o,(()=>m.dark().value()),o.styleOverrides?.()?.order),s=new y(r.symbol,f.itemExternalServices.qtySuggester);let a;return void 0===e.parentId&&f.qtyModifyCallbacks&&(a={qtyProvider:s,...f.qtyModifyCallbacks}),new c.OrderItem(r,o,C,f.itemExternalServices.symbolDataProvider,{displayMode:o.bracketsDisplayMode(),style:i,visibility:f.visibilityGetters.order,noOverlapAction:v,texts:b},{trackEvent:f.sourceCallbacks.trackEvent,exitTrackingMode:f.sourceCallbacks.exitTrackingMode},void 0,f.gaOrigin)}if(t===r.Position&&(0,l.isPositionItemRawData)(e)){const t=t=>(0,h.getDefaultStyleForPositionItem)(t.isBuyDirection(),o.isBlocked(),(()=>m.dark().value()),t.lineStyle(),o.styleOverrides?.()?.position),{dataType:r,...i}=e;return new p.PositionItem(i,o,C,f.itemExternalServices.symbolDataProvider,{displayMode:o.positionDisplayMode(),style:t,visibility:f.visibilityGetters.position,noOverlapAction:v,texts:b},{trackEvent:f.sourceCallbacks.trackEvent})}if(t===r.LimitPartStopLimitOrder&&(0,l.isOrderItemRawData)(e)){const t=t=>(0,u.getDefaultStyleForOrderItem)(t,o,(()=>m.dark().value()),o.styleOverrides?.()?.order),r={...(0,s.default)(e),price:(0,i.ensureDefined)(e.limitPrice),considerFilledQty:!1},{dataType:a,...l}=r;let n;if(f.qtyModifyCallbacks){n={qtyProvider:new y(l.symbol,f.itemExternalServices.qtySuggester),...(0,i.ensureDefined)(f.qtyModifyCallbacks)}}return new d.LimitPartStopLimitOrderItem(l,o,C,f.itemExternalServices.symbolDataProvider,{displayMode:o.bracketsDisplayMode(),style:t,visibility:f.visibilityGetters.order,noOverlapAction:v,texts:b},{trackEvent:f.sourceCallbacks.trackEvent,exitTrackingMode:f.sourceCallbacks.exitTrackingMode},n)}if(t===r.ProjectionBracket&&(0,l.isOrderItemRawData)(e)){const{dataType:t,...r}=e,i=t=>(0,u.getDefaultStyleForOrderItem)(t,o,(()=>m.dark().value()),o.styleOverrides?.()?.order);return new n.ProjectionBracketItem(r,o,C,f.itemExternalServices.symbolDataProvider,{displayMode:o.bracketsDisplayMode(),style:i,visibility:f.visibilityGetters.order,noOverlapAction:v,texts:b},{trackEvent:f.sourceCallbacks.trackEvent,exitTrackingMode:f.sourceCallbacks.exitTrackingMode},f.menuCallbacks)}if(t===r.PreOrder&&(0,l.isPreOrderItemRawData)(e)){const t=t=>(0,u.getDefaultStyleForOrderItem)(t,o,(()=>m.dark().value()),o.styleOverrides?.()?.order),{dataType:r,...s}=e,a=new y(s.symbol,f.itemExternalServices.qtySuggester);return new _.PreOrderItem(s,o,C,f.itemExternalServices.symbolDataProvider,{
displayMode:o.bracketsDisplayMode(),style:t,visibility:f.visibilityGetters.order,noOverlapAction:v,texts:b},{trackEvent:f.sourceCallbacks.trackEvent,exitTrackingMode:f.sourceCallbacks.exitTrackingMode},f.menuCallbacks,{qtyProvider:a,...(0,i.ensureDefined)(f.qtyModifyCallbacks)},"Chart Place Order")}throw new Error("Unknown traded item type")}!function(t){t[t.Position=0]="Position",t[t.Order=1]="Order",t[t.LimitPartStopLimitOrder=2]="LimitPartStopLimitOrder",t[t.ProjectionBracket=3]="ProjectionBracket",t[t.PreOrder=4]="PreOrder"}(r||(r={}))},597346:(t,e,o)=>{"use strict";o.d(e,{isLimitPartStopLimitOrderItem:()=>h,isOrderItem:()=>d,isPositionItem:()=>n,isPreOrderItem:()=>c,isProjectionBracketItem:()=>u});var r=o(292318),i=o(541184),s=o(97394),a=o(988304),l=o(95356);function n(t){return t instanceof a.PositionItem}function d(t){return t instanceof s.OrderItem}function c(t){return t instanceof l.PreOrderItem}function h(t){return t instanceof i.LimitPartStopLimitOrderItem}function u(t){return t instanceof r.ProjectionBracketItem}},541184:(t,e,o)=>{"use strict";o.d(e,{LimitPartStopLimitOrderItem:()=>n});var r=o(650151),i=o(144421),s=o(166554),a=o(97394),l=o(465688);class n extends a.OrderItem{onMove(t){const e=this.calcPriceDiff(t);null!==e&&(this._isMoving=!0,this._applyPricesForLimitPrice(e),t.isTouch&&(0,r.ensureDefined)(this._itemCommands.exitTrackingMode)())}isWorking(){return!1}async onFinishMove(t,e={},o=!0,s){this._source.setIsBlocked(o);const a=(0,i.clone)(this.data()),n=(0,r.ensureNotNull)(a.price);if(a.limitPrice=n,a.takeProfit=e.takeProfit||a.takeProfit,a.stopLoss=e.stopLoss||a.stopLoss,await this._addTrailingStopPipsData(a),void 0===s&&(s=1),this._trackEventGA(t),(0,l.isProjectionStopPartStopLimit)(a)){this._inEdit=!1,this._isMoving=!1;const t=await(0,r.ensureDefined)(this._data.callbacks.moveOrder)(a.id,a,s);return this._source.setIsBlocked(!1),this._source.syncData(),t}this._source.setIsBlocked(!0);const d=await this._onFinishMoveOrder({...a,dataType:"Order"},s);return this._source.setIsBlocked(!1),this._inEdit=!1,this._isMoving=!1,d}profitLossText(t){return this._source.isPlaced()?this._bracketTypeText(t):(0,s.orderTypeToText)({orderType:this.data().type,uppercase:t,shorten:t})}supportClose(){return!1}_calcId(){return this.data().type}_applyPricesForLimitPrice(t){this._inEdit=!0;const e=this._calcPriceByDiff(t);this._data.limitPrice=e,this._data.price=e}}},97394:(t,e,o)=>{"use strict";o.d(e,{OrderItem:()=>p});var r=o(650151),i=o(144421),s=o(534934),a=o(91603),l=o(894862),n=o(414903),d=o(826741),c=o(465688),h=o(753552);const u=s.enabled("chart_hide_close_order_button");class p extends d.OrderBaseItem{style(){return this._infoGetters.style(this)}isMovingEnabled(){return!!this._symbolDataProvider.symbolData()?.isTradable&&(this._isBracket()?this._data.supportMove&&(0,c.isParentItemSupportBracketModification)(this._source,this._symbolDataProvider):this._data.supportMove)}supportClose(){return!u&&Boolean(this._data.callbacks.cancelOrder)}supportModify(){
return this._isBracket()?Boolean(this._data.callbacks.modifyOrder)&&(0,c.isParentItemSupportBracketModification)(this._source,this._symbolDataProvider):Boolean(this._data.callbacks.modifyOrder)}supportModifyFromContextMenu(){return Boolean(this._data.callbacks.modifyOrderFromContextMenu)}isWorking(){return 6===this._data.status}qtyText(){return super._quantityText(this._data.considerFilledQty?this._data.qty-(this._data.filledQty||0):this._data.qty)}profitLossText(t){return this._data&&this._isBracket()&&this._source.isBracketsPLVisible()?.value()&&this.bracketType()!==l.BracketType.TrailingStop&&!this._isBracketWithoutParent()?super.profitLossText(t):this._bracketTypeText(t)}async onModify(t={},e){return this._onModify(this._data.callbacks.modifyOrder)}async onModifyFromContextMenu(t={},e){return this._onModify(this._data.callbacks.modifyOrderFromContextMenu)}async onClose(t={}){this._source.isBlocked()||(this._source.setIsBlocked(!0),this._trackEventGA((0,n.mergeGaParams)(t,{event:this._source.isPlaced()?"Cancel order":"Cancel bracket"})),await(0,r.ensureDefined)(this._data.callbacks.cancelOrder)(this._data.id,this._symbolDataProvider.symbolData()?.isTradable??!1),this._source.setIsBlocked(!1),this._source.syncData())}moveBracketWithoutParent(t){return this._onMoveOrder(t)}_onFinishMoveOrder(t,e,o=!0){return(0,r.ensureDefined)(this._data.callbacks.modifyOrder)(t.id,t,e,o)}_onMoveOrder(t,e,o=!0){return(0,r.ensureDefined)(this._data.callbacks.moveOrder)(t.id,t,e)}_calcId(){return void 0!==this._data.parentId?(0,r.ensureNotNull)((0,c.getBracketType)(this._data)):this._data.id}_isBracketWithoutParent(){const t=this._source.baseItem();return void 0===t||Math.abs(this.data().qty)!==Math.abs(t.data().qty)}async _onModify(t,e={},o){this._source.setIsBlocked(!0);const s=(0,i.clone)(this._data);await this._addTrailingStopPipsData(s),this._trackEventGA((0,n.mergeGaParams)(e,{event:this._source.isPlaced()?"Edit Order":"Edit project order"})),this._fillTrailingStopDataInParentIfNeeded(s);const a=await(0,r.ensureDefined)(t)(s.id,s,this._getOrderTicketFocusControl(),o);return this._source.setIsBlocked(!1),this._source.syncData(),a}_fillTrailingStopDataInParentIfNeeded(t){if(void 0!==t.parentId)return;const e=this._source.items().brackets.find((t=>t.data().stopType===a.StopType.TrailingStop));if(void 0===e||void 0!==t.trailingStopPips)return;const o=t.price,{price:i,trailingStopPips:s}=e.data();if(void 0!==s)return void(t.trailingStopPips=s);if(null===o||null===i)return;const{pipSize:l}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()),n=1===t.side?-1:1;t.trailingStopPips=(0,h.calcPipsByPrice)(i,o,n,l)}_getOrderTicketFocusControl(){const t=this.bracketType();return null===t?3===this._data.type?2:1:t===l.BracketType.TakeProfit?3:4}}},478139:(t,e,o)=>{"use strict";o.d(e,{buyActive:()=>x,buyPointShadow:()=>R,darkTheme:()=>V,errorNotificationBackdrop:()=>H,overlay:()=>W,sellActive:()=>M,sellPointShadow:()=>O,stopLossActive:()=>D,takeProfitActive:()=>w});var r,i=o(829609),s=o(613113),a=o(560202);!function(t){
t[t.ActiveColorTransparency=85]="ActiveColorTransparency",t[t.IconDisabledTransparency=80]="IconDisabledTransparency",t[t.PointShadowTransparency=70]="PointShadowTransparency",t[t.OverlayTransparency=50]="OverlayTransparency",t[t.BackdropTransparency=10]="BackdropTransparency",t[t.HintTPTransparency=85]="HintTPTransparency",t[t.MovingTPTransparency=75]="MovingTPTransparency",t[t.HintSLTransparency=90]="HintSLTransparency",t[t.MovingSLTransparency=80]="MovingSLTransparency"}(r||(r={}));const l=i.colorsPalette["color-white"],n=i.colorsPalette["color-tv-blue-a800"],d=i.colorsPalette["color-tv-blue-a700"],c=i.colorsPalette["color-tv-blue-500"],h=i.colorsPalette["color-tv-blue-600"],u=i.colorsPalette["color-cold-gray-600"],p=i.colorsPalette["color-cold-gray-750"],_=i.colorsPalette["color-cold-gray-900"],y=i.colorsPalette["color-minty-green-500"],m=i.colorsPalette["color-ripe-red-a800"],f=m,b=i.colorsPalette["color-ripe-red-500"],C=i.colorsPalette["color-ripe-red-600"],v=i.colorsPalette["color-tan-orange-500"],g=i.colorsPalette["color-white"],P=i.colorsPalette["color-cold-gray-700"],k=(0,s.generateColor)(y,70),T=(0,s.generateColor)(v,70),x=(0,s.generateColor)(c,85),M=(0,s.generateColor)(b,85),w=(0,s.generateColor)(y,85),S=(0,s.generateColor)(y,85),B=(0,s.generateColor)(y,75),D=(0,s.generateColor)(v,85),I=(0,s.generateColor)(v,90),L=(0,s.generateColor)(v,80),R=(0,s.generateColor)(c,70),O=(0,s.generateColor)(b,70),W=(0,s.generateColor)(_,50),H=(0,s.generateColor)(b,10),A=((0,s.generateColor)(b,80),(0,s.generateColor)(y,80),(0,s.generateColor)(v,80),(0,s.generateColor)(c,80),{text:l,buySecondary:n,buyDisabled:d,buyPrimary:c,confirmActiveBuy:h,textDisabled:u,backgroundDisabled:p,background:_,takeProfitPrimary:y,sellSecondary:m,sellDisabled:f,sellPrimary:b,confirmActiveSell:C,stopLossPrimary:v,takeProfitSecondary:"#0D3D41",stopLossSecondary:"#453826",buyActive:x,sellActive:M,takeProfitActive:w,takeProfitHintColor:S,takeProfitMovingColor:B,stopLossActive:D,stopLossHintColor:I,stopLossMovingColor:L,buyPointShadow:R,sellPointShadow:O,takeProfitPointShadow:k,stopLossPointShadow:T,overlay:W,errorNotificationBackdrop:H,themedText:g,themedBorder:P}),V=(0,a.generateOrderColorTheme)(A)},371753:(t,e,o)=>{"use strict";o.d(e,{buyPointShadow:()=>L,lightTheme:()=>H,overlay:()=>O,sellPointShadow:()=>R});var r,i=o(829609),s=o(613113),a=o(560202),l=o(478139);!function(t){t[t.PointShadowTransparency=80]="PointShadowTransparency",t[t.OverlayTransparency=50]="OverlayTransparency",t[t.HintTPTransparency=90]="HintTPTransparency",t[t.MovingTPTransparency=80]="MovingTPTransparency",t[t.HintSLTransparency=85]="HintSLTransparency",t[t.MovingSLTransparency=70]="MovingSLTransparency"}(r||(r={}))
;const n=i.colorsPalette["color-tv-blue-50"],d=i.colorsPalette["color-tv-blue-100"],c=i.colorsPalette["color-tv-blue-500"],h=i.colorsPalette["color-cold-gray-150"],u=i.colorsPalette["color-cold-gray-300"],p=i.colorsPalette["color-tv-blue-600"],_=i.colorsPalette["color-minty-green-50"],y=i.colorsPalette["color-minty-green-500"],m=i.colorsPalette["color-ripe-red-50"],f=i.colorsPalette["color-ripe-red-100"],b=i.colorsPalette["color-ripe-red-500"],C=i.colorsPalette["color-ripe-red-600"],v=i.colorsPalette["color-tan-orange-50"],g=i.colorsPalette["color-tan-orange-500"],P=i.colorsPalette["color-white"],k=i.colorsPalette["color-white"],T=i.colorsPalette["color-cold-gray-900"],x=i.colorsPalette["color-cold-gray-150"],M=(0,s.generateColor)(y,80),w=(0,s.generateColor)(g,80),S=(0,s.generateColor)(y,90),B=(0,s.generateColor)(y,80),D=(0,s.generateColor)(g,85),I=(0,s.generateColor)(g,70),L=(0,s.generateColor)(c,80),R=(0,s.generateColor)(b,80),O=(0,s.generateColor)(P,50),W={text:k,buySecondary:n,buyDisabled:d,buyPrimary:c,confirmActiveBuy:p,textDisabled:u,backgroundDisabled:h,background:P,takeProfitPrimary:y,sellSecondary:m,sellDisabled:f,sellPrimary:b,confirmActiveSell:C,stopLossPrimary:g,takeProfitSecondary:_,stopLossSecondary:v,buyActive:l.buyActive,sellActive:l.sellActive,takeProfitActive:l.takeProfitActive,takeProfitHintColor:S,takeProfitMovingColor:B,stopLossActive:l.stopLossActive,stopLossHintColor:D,stopLossMovingColor:I,buyPointShadow:L,sellPointShadow:R,takeProfitPointShadow:M,stopLossPointShadow:w,overlay:O,errorNotificationBackdrop:l.errorNotificationBackdrop,themedText:T,themedBorder:x},H=(0,a.generateOrderColorTheme)(W)},489891:(t,e,o)=>{"use strict";o.d(e,{getDefaultStyleForOrderItem:()=>n,getStyleForOppositeDirection:()=>d});var r=o(934722),i=o(894862),s=o(154426),a=o(371753),l=o(478139);function n(t,e,o,n){const d=o()?l.darkTheme:a.lightTheme,c=o()?n?.darkTheme:n?.lightTheme;let h,u;const p=t.bracketType();null!==p?(h=p===i.BracketType.TakeProfit?d.takeProfit:d.stopLoss,u=p===i.BracketType.TakeProfit?c?.takeProfit:c?.stopLoss,1===t.data().side?(h.normal.confirm=d.buy.normal.confirm,h.normal.cancel=d.buy.normal.cancel,h.disabled.confirm=d.buy.disabled.confirm,h.disabled.cancel=d.buy.disabled.cancel):(h.normal.confirm=d.sell.normal.confirm,h.normal.cancel=d.sell.normal.cancel,h.disabled.confirm=d.sell.disabled.confirm,h.disabled.cancel=d.sell.disabled.cancel)):(h=t.isBuyDirection()?d.buy:d.sell,u=t.isBuyDirection()?c?.buy:c?.sell);const _=e.disabled()?h.disabled:h.normal,y=e.disabled()?u?.disabled:u?.normal,m=e.isPlaced()?t.lineStyle():r.LineStyle.Dotted;return(0,s.deepExtend)({},{..._,lineStyle:m,borderStyle:m,labelBorderVisible:!0},y??{})}function d(t,e,o,i){const n=o()?l.darkTheme:a.lightTheme,d=o()?i?.darkTheme:i?.lightTheme,c=t.isBuyDirection()?n.sell:n.buy,h=t.isBuyDirection()?d?.sell:d?.buy,u=e.disabled()?c.disabled:c.normal,p=e.disabled()?h?.disabled:h?.normal,_=t.isWorking()?e.lineStyle():r.LineStyle.Dotted,y=t.isWorking()?r.LineStyle.Solid:r.LineStyle.Dotted;return(0,s.deepExtend)({},{...u,lineStyle:_,
borderStyle:y,labelBorderVisible:!0},p??{})}},988304:(t,e,o)=>{"use strict";o.d(e,{PositionItem:()=>P});var r=o(650151),i=o(917053),s=o(243716),a=o(534934),l=o(144421),n=o(460916),d=o(671945),c=o(166554),h=o(494136),u=o(753552),p=o(414903),_=o(449859),y=o(609838);const m=(0,o(851310).appendEllipsis)(y.t(null,void 0,o(591932))),f=y.t(null,void 0,o(383236)),b=y.t(null,void 0,o(360196));var C=o(668019);const v=(0,d.getLogger)("Trading.Positions"),g=a.enabled("chart_hide_close_position_button");class P extends _.BaseItem{constructor(t,e,o,r,i,s){super(t,e,o,r,"Chart Position",i,s),this._source.positionDisplayMode().subscribe(this,this.fireProfitLossChange)}destroy(){this._source.positionDisplayMode().unsubscribe(this,this.fireProfitLossChange),super.destroy()}supportBrackets(){return this._symbolDataProvider.supportPositionBrackets()&&this._symbolDataProvider.supportModifyPositionBrackets()}currency(){return this._symbolDataProvider.positionCurrency()??""}profitLossTextColor(){if(!this._data)return"";const t=this._potentialProfitLoss();return null===t?"":(0,C.profitLossTextColor)(this._infoGetters.style(this),t,this._infoGetters.displayMode.value()===i.PlDisplay.Money)}profitLossTooltip(){return this.priceTooltip()}id(){return this._data.id}setData(t){const e=this.data()?.pl??this.data()?.unrealizedPl;super.setData(t),this.data().pl!==e&&this.fireProfitLossChange()}qtyText(){return super._quantityText(this._data.qtyBySide)}qty(){return this._data.qtyBySide}supportOnlyPairBrackets(){return this._data.supportOnlyPairBrackets}supportReverse(){return this._symbolDataProvider.supportPositionReverse()}async onReverse(t={}){t=(0,p.mergeGaParams)(t,{event:"Reverse Position"}),await this._doActionWithBlock("reversePosition",!0,t)}supportClose(){return!g&&this._data.supportClose}async onClose(t={}){t=(0,p.mergeGaParams)(t,{event:"Close Position"}),await this._doActionWithBlock("closePosition",!0,t)}supportModify(){return this.supportBrackets()}supportModifyFromContextMenu(){return this.supportBrackets()}async onModify(t={}){return t=(0,p.mergeGaParams)(t,{event:"Edit Position"}),this._doActionWithBlock("modifyPosition",!0,t,void 0,void 0,!1)}useMinTickFormatter(){return!1}onFinishMove(t={},e={},o=!0,i,s=!0){const a=this._symbolDataProvider.lastData(),l=a?.bid??null,n=a?.ask??null;if(void 0!==e.trailingStop&&l&&n){const t=1===this._data.side?-1:1,o=1===this._data.side?l:n,{pipSize:i}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData());e.trailingStopPips=(0,u.calcPipsByPrice)(e.trailingStop,o,t,i),e.trailingStopPrice=e.trailingStop,e.trailingStop=void 0}return(0,r.ensureDefined)(this._data.callbacks.onFinishModify)(this._data.id,e,i,s)}async onModifyWithBracket(t={},e={},o=!0,i,s=!0){const a=this._symbolDataProvider.lastData(),l=a?.bid??null,n=a?.ask??null;if(void 0!==e.trailingStop&&l&&n){const t=1===this._data.side?-1:1,o=1===this._data.side?l:n,{pipSize:i}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData());e.trailingStopPips=(0,u.calcPipsByPrice)(e.trailingStop,o,t,i),e.trailingStopPrice=e.trailingStop,
e.trailingStop=void 0}return this._doActionWithBlock("modifyPosition",o,t,e,i,s)}hasContextMenu(){return super.hasContextMenu()||this.supportReverse()}moneyText(t,e){return`${(0,_.plSign)(t,e)}${_.numericFormatters.twoDecimalFormatter.format(Math.abs(t))} ${this.currency()}`}async onContextMenu(t,e){this.fireProfitLossChange();const o={};e=(0,p.mergeGaParams)(e,{origin:"Chart Position Context Menu"}),this.supportClose()&&(o.closePosition=this.onClose.bind(this,e)),this.supportReverse()&&(o.reversePosition=this.onReverse.bind(this,e)),this.supportModify()&&(o.protectPosition=this._onProtect.bind(this,e));const r={side:(0,c.sideToText)(this._data.side),qty:this.qtyText(),price:this.priceText()},i=await async function(t,e){const o=[],r=await(0,h.createContextMenuTitle)("Trading.PositionTitle",e);return r&&o.push(r),void 0!==t.protectPosition&&o.push(new s.Action({actionId:"Trading.ModifyPosition",options:{label:m,onExecute:t.protectPosition}})),void 0!==t.closePosition&&o.push(new s.Action({actionId:"Trading.ClosePosition",options:{label:f,onExecute:t.closePosition}})),void 0!==t.reversePosition&&o.push(new s.Action({actionId:"Trading.ReversePosition",options:{label:b,onExecute:t.reversePosition}})),o}(o,r),a=this._infoGetters.noOverlapAction(e,(t=>this._trackEventGA(t)));a&&(i.push(new s.Separator),i.push(a)),this._contextMenu=await(0,h.showContextMenu)(i,t,(()=>{this._contextMenu=null}),{detail:{type:"position",id:this.id()}})}tryBasePlOnLast(){return!0}_potentialProfitLoss(){if(!this._source.isPositionPLVisible().value()||!this._data)return null;const{pl:t,unrealizedPl:e=null,side:o,price:r}=this._data,s=t??e;if(null===s)return null;if(this._infoGetters.displayMode.value()===i.PlDisplay.Money)return s;const{trade:a,ask:n,bid:d}=this._symbolDataProvider.lastData()||{},c=(this._data.plBasedOnLast?a:this.isBuyDirection()?d:n)??r;return(0,l.isNumber)(c)?(c-r)*o:null}_onProtect(t={}){return t=(0,p.mergeGaParams)(t,{event:"Protect Position"}),this._doActionWithBlock("protectPosition",!1,t,void 0,void 0,!1)}async _doActionWithBlock(t,e,o={},i={},s,a){if(void 0===this._data.callbacks[t])return!1;e&&this._source.setIsBlocked(!0),this._trackEventGA(o);let l=!1;try{l="modifyPosition"===t?await(0,r.ensureDefined)(this._data.callbacks.modifyPosition)(this._data.id,i,s,a):"protectPosition"===t?await(0,r.ensureDefined)(this._data.callbacks.protectPosition)(this._data.id,i,s,a):await(0,r.ensureDefined)(this._data.callbacks[t])(this._data.id)}catch(e){v.logWarn(`Try to ${t}, but got error: ${(0,n.errorToString)(e)}`)}finally{e&&(this._source.setIsBlocked(!1),this._source.syncData())}return l}}},918873:(t,e,o)=>{"use strict";o.d(e,{getDefaultStyleForPositionItem:()=>y});var r=o(934722),i=o(154426),s=o(829609),a=o(316167),l=o(478139);const n={pointShadowColor:l.buyPointShadow,lineColor:s.colorsPalette["color-tv-blue-500"],borderBackgroundColor:s.colorsPalette["color-cold-gray-900"],borderColor:s.colorsPalette["color-tv-blue-500"],pointBackgroundColor:s.colorsPalette["color-cold-gray-900"],
disabledLineColor:s.colorsPalette["color-tv-blue-a700"],positivePlColor:s.colorsPalette["color-minty-green-500"],negativePlColor:s.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:s.colorsPalette["color-tv-blue-500"],textColor:s.colorsPalette["color-white"],dividerColor:s.colorsPalette["color-tv-blue-500"],activeColor:s.colorsPalette["color-tv-blue-600"]},text:{backgroundColor:s.colorsPalette["color-cold-gray-900"],textColor:s.colorsPalette["color-cold-gray-600"],dividerColor:s.colorsPalette["color-tv-blue-a800"],activeColor:l.buyActive},close:{backgroundColor:s.colorsPalette["color-cold-gray-900"],iconColor:s.colorsPalette["color-tv-blue-500"],activeColor:l.buyActive},reverse:{backgroundColor:s.colorsPalette["color-cold-gray-900"],borderColor:s.colorsPalette["color-tv-blue-500"],iconColor:s.colorsPalette["color-tv-blue-500"],activeColor:l.buyActive},confirm:{disableBackgroundColor:s.colorsPalette["color-cold-gray-750"],backgroundColor:s.colorsPalette["color-tv-blue-500"],borderColor:s.colorsPalette["color-tv-blue-500"],textColor:s.colorsPalette["color-white"],disableTextColor:s.colorsPalette["color-cold-gray-600"],activeColor:s.colorsPalette["color-tv-blue-600"]},cancel:{disableBackgroundColor:s.colorsPalette["color-cold-gray-750"],backgroundColor:s.colorsPalette["color-cold-gray-900"],borderColor:s.colorsPalette["color-cold-gray-700"],textColor:s.colorsPalette["color-white"],disableTextColor:s.colorsPalette["color-cold-gray-600"],activeColor:s.colorsPalette["color-ripe-red-600"]},informer:{backgroundColor:l.errorNotificationBackdrop,iconColor:s.colorsPalette["color-ripe-red-500"]}},d={pointShadowColor:l.sellPointShadow,lineColor:s.colorsPalette["color-ripe-red-500"],borderBackgroundColor:s.colorsPalette["color-cold-gray-900"],borderColor:s.colorsPalette["color-ripe-red-500"],pointBackgroundColor:s.colorsPalette["color-cold-gray-900"],disabledLineColor:s.colorsPalette["color-ripe-red-a800"],positivePlColor:s.colorsPalette["color-minty-green-500"],negativePlColor:s.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:s.colorsPalette["color-ripe-red-500"],textColor:s.colorsPalette["color-white"],dividerColor:s.colorsPalette["color-ripe-red-500"],activeColor:s.colorsPalette["color-ripe-red-600"]},text:{backgroundColor:s.colorsPalette["color-cold-gray-900"],textColor:s.colorsPalette["color-cold-gray-600"],dividerColor:s.colorsPalette["color-ripe-red-a800"],activeColor:l.sellActive},close:{backgroundColor:s.colorsPalette["color-cold-gray-900"],iconColor:s.colorsPalette["color-ripe-red-500"],activeColor:l.sellActive},reverse:{backgroundColor:s.colorsPalette["color-cold-gray-900"],borderColor:s.colorsPalette["color-ripe-red-500"],iconColor:s.colorsPalette["color-ripe-red-500"],activeColor:l.sellActive},confirm:{disableBackgroundColor:s.colorsPalette["color-cold-gray-750"],backgroundColor:s.colorsPalette["color-ripe-red-500"],borderColor:s.colorsPalette["color-ripe-red-500"],textColor:s.colorsPalette["color-white"],disableTextColor:s.colorsPalette["color-cold-gray-600"],
activeColor:s.colorsPalette["color-ripe-red-600"]},cancel:{disableBackgroundColor:s.colorsPalette["color-cold-gray-750"],backgroundColor:s.colorsPalette["color-cold-gray-900"],borderColor:s.colorsPalette["color-cold-gray-700"],textColor:s.colorsPalette["color-white"],disableTextColor:s.colorsPalette["color-cold-gray-600"],activeColor:s.colorsPalette["color-ripe-red-600"]},informer:{backgroundColor:l.errorNotificationBackdrop,iconColor:s.colorsPalette["color-ripe-red-500"]}},c={buy:{normal:n,disabled:(0,a.generateBlendColors)(n,l.overlay)},sell:{normal:d,disabled:(0,a.generateBlendColors)(d,l.overlay)}};var h=o(371753);const u={pointShadowColor:h.buyPointShadow,lineColor:s.colorsPalette["color-tv-blue-500"],borderBackgroundColor:s.colorsPalette["color-white"],borderColor:s.colorsPalette["color-tv-blue-500"],pointBackgroundColor:s.colorsPalette["color-white"],disabledLineColor:s.colorsPalette["color-tv-blue-100"],positivePlColor:s.colorsPalette["color-minty-green-500"],negativePlColor:s.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:s.colorsPalette["color-tv-blue-500"],textColor:s.colorsPalette["color-white"],dividerColor:s.colorsPalette["color-tv-blue-500"],activeColor:s.colorsPalette["color-tv-blue-600"]},text:{backgroundColor:s.colorsPalette["color-white"],textColor:s.colorsPalette["color-cold-gray-300"],dividerColor:s.colorsPalette["color-tv-blue-50"],activeColor:l.buyActive},close:{backgroundColor:s.colorsPalette["color-white"],iconColor:s.colorsPalette["color-tv-blue-500"],activeColor:l.buyActive},reverse:{backgroundColor:s.colorsPalette["color-white"],borderColor:s.colorsPalette["color-tv-blue-500"],iconColor:s.colorsPalette["color-tv-blue-500"],activeColor:l.buyActive},confirm:{disableBackgroundColor:s.colorsPalette["color-cold-gray-150"],backgroundColor:s.colorsPalette["color-tv-blue-500"],borderColor:s.colorsPalette["color-tv-blue-500"],textColor:s.colorsPalette["color-white"],disableTextColor:s.colorsPalette["color-cold-gray-300"],activeColor:s.colorsPalette["color-tv-blue-600"]},cancel:{disableBackgroundColor:s.colorsPalette["color-cold-gray-750"],backgroundColor:s.colorsPalette["color-white"],borderColor:s.colorsPalette["color-cold-gray-150"],textColor:s.colorsPalette["color-cold-gray-900"],disableTextColor:s.colorsPalette["color-cold-gray-600"],activeColor:s.colorsPalette["color-ripe-red-600"]},informer:{backgroundColor:l.errorNotificationBackdrop,iconColor:s.colorsPalette["color-ripe-red-500"]}},p={pointShadowColor:h.sellPointShadow,lineColor:s.colorsPalette["color-ripe-red-500"],borderBackgroundColor:s.colorsPalette["color-white"],borderColor:s.colorsPalette["color-ripe-red-500"],pointBackgroundColor:s.colorsPalette["color-white"],disabledLineColor:s.colorsPalette["color-ripe-red-100"],positivePlColor:s.colorsPalette["color-minty-green-500"],negativePlColor:s.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:s.colorsPalette["color-ripe-red-500"],textColor:s.colorsPalette["color-white"],dividerColor:s.colorsPalette["color-ripe-red-500"],activeColor:s.colorsPalette["color-ripe-red-600"]},
text:{backgroundColor:s.colorsPalette["color-white"],textColor:s.colorsPalette["color-cold-gray-300"],dividerColor:s.colorsPalette["color-ripe-red-50"],activeColor:l.buyActive},close:{backgroundColor:s.colorsPalette["color-white"],iconColor:s.colorsPalette["color-ripe-red-500"],activeColor:l.sellActive},reverse:{backgroundColor:s.colorsPalette["color-white"],borderColor:s.colorsPalette["color-ripe-red-500"],iconColor:s.colorsPalette["color-ripe-red-500"],activeColor:l.sellActive},confirm:{disableBackgroundColor:s.colorsPalette["color-cold-gray-150"],backgroundColor:s.colorsPalette["color-ripe-red-500"],borderColor:s.colorsPalette["color-ripe-red-500"],textColor:s.colorsPalette["color-white"],disableTextColor:s.colorsPalette["color-cold-gray-300"],activeColor:s.colorsPalette["color-ripe-red-600"]},cancel:{disableBackgroundColor:s.colorsPalette["color-cold-gray-750"],backgroundColor:s.colorsPalette["color-white"],borderColor:s.colorsPalette["color-cold-gray-150"],textColor:s.colorsPalette["color-cold-gray-900"],disableTextColor:s.colorsPalette["color-cold-gray-600"],activeColor:s.colorsPalette["color-ripe-red-600"]},informer:{backgroundColor:l.errorNotificationBackdrop,iconColor:s.colorsPalette["color-ripe-red-500"]}},_={buy:{normal:u,disabled:(0,a.generateBlendColors)(u,h.overlay)},sell:{normal:p,disabled:(0,a.generateBlendColors)(p,h.overlay)}};function y(t,e,o,s=r.LineStyle.Solid,a){const l=o()?c:_,n=o()?a?.darkTheme:a?.lightTheme,d=t?l.buy:l.sell,h=t?n?.buy:n?.sell,u=e?d.disabled:d.normal,p=e?h?.disabled:h?.normal;return(0,i.deepExtend)({},{...u,lineStyle:s,borderStyle:s,labelBorderVisible:!1},p??{})}},95356:(t,e,o)=>{"use strict";o.d(e,{PreOrderItem:()=>d});var r=o(609838),i=o(934722),s=o(166554),a=o(570358),l=o(941520);const n=r.t(null,void 0,o(302873));class d extends a.OrderWithMenuItem{constructor(){super(...arguments),this._supportedOrderTypes=[]}qtyText(){return super._quantityText(this._data.qty)}style(){return this._infoGetters.style(this)}setSupportOrderType(t){this._supportedOrderTypes=t}canSwitchType(){return this._supportedOrderTypes.length>1}orderTypesItems(){return this._supportedOrderTypes.map((t=>({type:t,typeText:(0,s.orderTypeToText)({orderType:t})})))}isWorking(){return!0}profitLossText(t){return(0,s.orderTypeToText)({orderType:this.data().type,uppercase:t,shorten:t})}profitLossTooltip(){return n}lineStyle(){return i.LineStyle.Solid}supportClose(){return!0}supportModify(){return this._data.supportModify}supportModifyFromContextMenu(){return this._data.supportModify}async onClose(t){this._source.onClose?.(t)}async onModify(t){return this._source.isPlaced()||(t.event="Edit project order"),this._source.onModify?.(t),!0}async onModifyFromContextMenu(t){return this.onModify(t)}supportBrackets(){return!this._isBracket()&&this._symbolDataProvider.supportOrderBrackets()}_calcId(){return l.preOrderItemId}}},292318:(t,e,o)=>{"use strict";o.d(e,{ProjectionBracketItem:()=>g});var r=o(650151),i=o(150335),s=o(610555),a=o(609838),l=o(144421),n=o(934722),d=o(917053),c=o(894862),h=o(721762),u=o(570358)
;const p=a.t(null,{context:"Stop loss"},o(867008)),_=a.t(null,{context:"Guaranteed stop"},o(389026)),y=a.t(null,{context:"Trailing stop"},o(335363)),m=a.t(null,{context:"Take profit"},o(607660)),f=a.t(null,void 0,o(734474)),b=a.t(null,void 0,o(221718)),C=a.t(null,void 0,o(424234)),v=a.t(null,void 0,o(154908));class g extends u.OrderWithMenuItem{style(){return this._infoGetters.style(this)}setPrice(t){if(null!==t){const e=this._symbolDataProvider.getMinTick(t);t=(0,i.fixComputationError)(e*Math.round(t/e))}this.setData({...(0,l.clone)(this.data()),price:t})}setQty(t){this.setData({...(0,l.clone)(this.data()),qty:t})}data(){return super.data()}qtyText(){return this._bracketTypeText(!0)}tooltip(){switch(this.bracketType()){case c.BracketType.TakeProfit:return f;case c.BracketType.StopLoss:return b;case c.BracketType.GuaranteedStop:return C;case c.BracketType.TrailingStop:return v;default:throw new Error("Unknown bracket type")}}isWorking(){return!0}supportClose(){return!1}supportModify(){return!0}supportModifyFromContextMenu(){return!0}profitLossText(t){return!this._source.isBracketsPLVisible()?.value()||this.bracketType()===c.BracketType.TrailingStop||!this._source.supportRiskControlsAndInfo()&&this._infoGetters.displayMode.value()===d.PlDisplay.Money?"":super.profitLossText(t)}isMinifyMode(){return null===this.price()}bracketType(){return this.data().bracketType}async onMove(t){const e=new s.Point(t.localX,t.localY),o=this._mainSeries.priceScale(),i=this._mainSeries.firstValue();if(null===i)return;this._isMoving=!0;const a=o.coordinateToPrice(e.y,i);this.setPrice(a),t.isTouch&&(0,r.ensureDefined)(this._itemCommands.exitTrackingMode)()}async onFinishMove(t={},e={},o=!0,r,i=!0){return this._inEdit=!1,this._isMoving=!1,!0}async onMoveItem(t={},e=!0,o,r=!0){return!0}lineStyle(){return n.LineStyle.Dotted}_isBracket(){return!0}_calcId(){return this._data.id}_bracketTypeText(t){return this._data?this.bracketType()===c.BracketType.TakeProfit?m:this._source.bracketStopType()===h.StopType.TrailingStop?y:this._source.bracketStopType()===h.StopType.GuaranteedStop?_:p:""}}},753552:(t,e,o)=>{"use strict";o.d(e,{calcPipsByPrice:()=>i,calcPriceByPips:()=>s});var r=o(960521);function i(t,e,o,i){return(0,r.Big)(t).minus(e).div(i).mul(1===o?1:-1).toNumber()}function s(t,e,o,i){return(0,r.Big)(1===o?1:-1).mul(t).mul(i).plus(e).toNumber()}},414903:(t,e,o)=>{"use strict";o.d(e,{mergeGaParams:()=>l});var r,i,s,a=o(650151);function l(t,e){(0,a.assert)(!(t.origin&&e.origin&&t.origin!==e.origin||t.event&&e.event&&t.event!==e.event),"origin and event should be only in one params object");const o={...t,...e};return t.label&&e.label&&(o.label=`${t.label} ${e.label}`),o}!function(t){t.PlaceOrderDefault="Chart Place Order",t.OrderDefault="Chart Order",t.OrderContextMenu="Chart Order Context Menu",t.ProjectOrderContextMenu="Chart Project Order Context Menu",t.PositionDefault="Chart Position",t.PositionContextMenu="Chart Position Context Menu"}(r||(r={})),function(t){t.MoveOrder="Move Order",t.ModifyOrder="Modify order",
t.AddBracket="Add bracket from btn",t.StopTypeMenuOpen="Stop loss type menu opening",t.OrderTypeMenuOpen="Order type menu opening",t.ChangeOrderType="Change order type",t.ChangeQty="Change quantity",t.CancelOrder="Cancel order",t.CancelBracket="Cancel bracket",t.ConfirmPlaceOrder="Order placed"}(i||(i={})),function(t){t.Single="single",t.Group="group",t.TakeProfit="take profit",t.StopLoss="stop loss",t.TrailingStop="trailing stop",t.GuaranteedStop="guaranteed stop",t.BothBracket="both bracket"}(s||(s={}))},494136:(t,e,o)=>{"use strict";o.d(e,{createContextMenuTitle:()=>c,createNoOverlapMenuAction:()=>n,showContextMenu:()=>d});var r=o(609838),i=o(243716),s=o(574235),a=o(414903);const l=r.t(null,void 0,o(825586));function n(t,e,o){const r=(0,a.mergeGaParams)(e,{event:"No overlap orders and positions"});return new i.Action({actionId:"Trading.NoOverlapMode",options:{label:l,onExecute:()=>{o(r),t.setNoOverlapMode(!0)},disabled:!t.isItemsOverlap()}})}async function d(t,e,o,r){return s.ContextMenuManager.createMenu(t,{},{...r,menuName:"TradingOrderContextMenu"},o).then((t=>(t.show(e),t)))}async function c(t,e){return null}},360887:(t,e,o)=>{"use strict";o.d(e,{closeDropdownMenu:()=>C,updateDropdownMenu:()=>v});var r=o(50959),i=o(632227),s=o(610555),a=o(650151),l=o(930202),n=o(914090),d=o(734602),c=o(930052),h=o(759339),u=o(163694),p=o(284170),_=o(192063),y=o(729314);const m=new WeakMap;function f(t){const{position:e,activeItemIndex:o,title:i,onClose:s,onDestroy:a,onSelect:f,customCloseSubscriptions:b=[]}=t,[C,v]=(0,r.useState)(o);(0,d.useGlobalCloseOnScrollAndCustomEvents)(b);const g=t.items.map(((e,o)=>(m.has(e)||m.set(e,(0,p.randomHash)()),r.createElement(_.PopupMenuItem,{key:m.get(e),onClick:()=>function(e){v(e),f(t.items[e].value),a()}(o),label:e.title,isActive:o===C}))));return r.createElement(u.DrawerManager,null,r.createElement(c.MatchMedia,{rule:"(max-width: 440px)"},(t=>t?r.createElement(h.Drawer,{onClose:s,position:"Bottom"},r.createElement(y.ToolWidgetMenuSummary,null,i),g):r.createElement(n.TooltipPopup,{position:e,onClose:s,onClickOutside:P,onForceClose:a,onKeyDown:k},g))));function P(t){s(t)}function k(e){switch((0,l.hashFromEvent)(e)){case 40:e.preventDefault(),e.stopPropagation(),function(){const e=C+1>t.items.length-1?0:C+1;v(e)}();break;case 38:e.preventDefault(),e.stopPropagation(),function(){const e=C-1<0?t.items.length-1:C-1;v(e)}();break;case 13:e.preventDefault(),e.stopPropagation(),f(t.items[C].value),a()}}}const b=document.createElement("div");function C(){i.unmountComponentAtNode((0,a.ensureNotNull)(b))}function v(t,e,o,l,n,d,c,h,u){if(!t)return;const p={items:o,activeItemIndex:l,title:n,onClose:function(t){if(t){const e=t.target.getBoundingClientRect()||{left:0,top:0};h(new s.Point(t.clientX-e.left,t.clientY-e.top))}i.unmountComponentAtNode((0,a.ensureNotNull)(b))},onDestroy:function(){u(),i.unmountComponentAtNode((0,a.ensureNotNull)(b))},onSelect:c,customCloseSubscriptions:d,position:e};i.render(r.createElement(f,{...p}),b)}},612930:(t,e,o)=>{"use strict";o.d(e,{
drawErrorNotificationBackdrop:()=>u,drawExclamationIcon:()=>y,drawExecutionArrowBackdrop:()=>b,drawExecutionLabelText:()=>C,drawHalfArrow:()=>d,drawOutlinedArrowHead:()=>n,drawStackedExecutionArrow:()=>m,drawStackedExecutionArrowWithCounter:()=>f,drawText:()=>c,drawUnderlinedText:()=>h});var r,i,s=o(934722),a=o(617233),l=o(361882);function n(t,e,o,r,i,s,a,l,n=270){const d=2*l,c=2*d,h=90===n?-1:1,u=t.lineWidth%2?.5:0;t.translate(e+u+a/2*h+d,o+(u+a/2)*h),t.rotate(n*Math.PI/180);const p=Math.round(a/2);t.lineCap="square",t.lineWidth=c,t.strokeStyle=i,t.beginPath(),t.moveTo(0,p),t.lineTo(p,0),t.lineTo(a,p),t.stroke(),t.lineCap="square",t.lineWidth=d,t.strokeStyle=r,t.beginPath(),t.moveTo(0,p),t.lineTo(p,0),t.lineTo(a,p),t.stroke()}function d(t,e,o,r,i,s,a){t.save(),t.strokeStyle=r,t.lineJoin="miter";const l=t.lineWidth%2?.5:0,n=Math.round(s/3);t.translate(e+l,o+l),i&&t.scale(-1,-1),t.beginPath(),t.moveTo(0,s),t.lineTo(0,0),t.lineTo(-a,n),t.stroke(),t.restore()}function c(t,e,o,r,i,s,a,n,d="center"){t.save(),t.textAlign=d,t.textBaseline="middle",t.fillStyle=a,t.font=n,t.translate(r,i+s),(0,l.drawScaled)(t,e.horizontalPixelRatio,e.verticalPixelRatio,(()=>{t.fillText(o,0,0)})),t.restore()}function h(t,e,o,r,i,n,d,c,h){t.save(),t.textAlign="center",t.textBaseline="middle",t.fillStyle=d,t.font=c;const u=1,p=1,{horizontalPixelRatio:_,verticalPixelRatio:y}=(s.LineStyle.Dashed,e),m=Math.round(10*y)/2,f=Math.max(1,Math.floor(p*_)),b=h*_,C=Math.max(1,Math.floor(u*y)),v=Math.round(r-b/2),g=Math.round(i+m+C);t.strokeStyle=d,t.lineWidth=f;const P=Math.round(3*t.lineWidth),k=Math.round(3*t.lineWidth/2),T=Math.round(2*t.lineWidth);let x=Math.trunc(b/(P+T));const M=Math.trunc(b%(P+T)/2),w=[];for(w.push(k+M);x>1;)w.push(T,P),x--;w.push(T,k+M),t.setLineDash(w),(0,a.drawHorizontalLine)(t,g,v,v+Math.round(b)),t.translate(r,i+n),(0,l.drawScaled)(t,_,y,(()=>{t.fillText(o,0,0)})),t.restore()}function u(t){const{ctx:e,x:o,y:r,w:i,h:s,horizontalPixelRatio:a,verticalPixelRatio:l}=t;e.fillStyle="rgba(242, 54, 69, 0.1)",e.fillRect(o,r-s*l/2,i*a,s*l)}!function(t){t.TextAlign="center",t.TextBaseline="middle",t.FontWeight="normal",t[t.DashWidth=3]="DashWidth",t[t.SpaceWidth=2]="SpaceWidth"}(r||(r={})),function(t){t[t.Right=90]="Right",t[t.Left=270]="Left"}(i||(i={}));const p=new Path2D("M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"),_=18;function y(t){const{ctx:e,x:o,y:r,horizontalPixelRatio:i,verticalPixelRatio:s}=t;e.save(),e.translate(o,r),(0,l.drawScaled)(e,i,s,(()=>{e.fillStyle="white",e.beginPath(),e.arc(_/2,_/2,_/2-2,0,2*Math.PI,!0),e.fill(),e.fillStyle="rgba(242, 54, 69, 1)",e.fill(p,"evenodd")})),e.restore()}function m(t){const{ctx:e,x:o,y:r,fillStyle:i,strokeStyle:s,pixelRatio:a,isArrowUp:l,arrowDimensions:n}=t;e.fillStyle=i,e.lineWidth=Math.max(1,Math.round(a)),e.lineCap="square",e.strokeStyle=s
;const d=l?1:-1,{arrowHeadOuterWidth:c,arrowHeadInnerWidth:h,arrowHeadHeight:u,arrowHeadWidestPartHeight:p,arrowStemWidth:_,arrowStemHeight:y,arrowHeight:m}=n;e.beginPath(),e.moveTo(o,r),e.lineTo(o-c/2,r+p*d),e.lineTo(o-h/2,r+u*d),e.lineTo(o-h/2,r+u*d),e.lineTo(o-_/2,r+(m-y)*d),e.lineTo(o-_/2,r+m*d),e.lineTo(o+_/2,r+m*d),e.lineTo(o+_/2,r+(m-y)*d),e.lineTo(o+h/2,r+u*d),e.lineTo(o+h/2,r+u*d),e.lineTo(o+c/2,r+p*d),e.lineTo(o,r),e.closePath(),e.fill(),e.beginPath(),e.moveTo(o,r),e.lineTo(o-c/2,r+p*d),e.lineTo(o-h/2,r+u*d),e.lineTo(o-h/2,r+u*d),e.lineTo(o-_/2,r+(m-y)*d),e.lineTo(o-_/2,r+m*d),e.lineTo(o+_/2,r+m*d),e.lineTo(o+_/2,r+(m-y)*d),e.lineTo(o+h/2,r+u*d),e.lineTo(o+h/2,r+u*d),e.lineTo(o+c/2,r+p*d),e.lineTo(o,r),e.closePath(),e.stroke()}function f(t){const{ctx:e,x:o,y:r,fillStyle:i,executionCircleDiameter:s,strokeStyle:a,pixelRatio:l,isArrowUp:n,textWidth:d,isHovered:c,arrowDimensions:h}=t;e.fillStyle=i,e.lineWidth=Math.max(1,Math.round(l)),e.lineCap="square",e.strokeStyle=a;const u=n?1:-1,{arrowHeadOuterWidth:p,arrowHeadInnerWidth:_,arrowHeadHeight:y,arrowHeadWidestPartHeight:m,arrowStemWidth:f,arrowStemHeight:C,arrowHeight:v}=h;c&&b({ctx:e,x:o,y:r+v/2*u,height:v,diameter:s,fillStyle:i,isArrowUp:n}),e.beginPath(),e.moveTo(o,r),e.lineTo(o-p/2,r+m*u),e.lineTo(o-_/2,r+y*u),e.lineTo(o-_/2,r+y*u),e.lineTo(o-f/2,r+(v-C)*u),e.lineTo(o-f/2,r+v*u),e.lineTo(o+f/2,r+v*u),e.lineTo(o+f/2,r+(v-C)*u),e.lineTo(o+_/2,r+y*u),e.lineTo(o+_/2,r+y*u),e.lineTo(o+p/2,r+m*u),e.lineTo(o,r),e.closePath(),e.fill(),e.beginPath(),e.moveTo(o,r),e.lineTo(o-p/2,r+m*u),e.lineTo(o-_/2,r+y*u),e.lineTo(o-_/2,r+y*u),e.lineTo(o-f/2,r+(v-C)*u),e.lineTo(o-f/2,r+v*u),e.lineTo(o+f/2,r+v*u),e.lineTo(o+f/2,r+(v-C)*u),e.lineTo(o+_/2,r+y*u),e.lineTo(o+_/2,r+y*u),e.lineTo(o+p/2,r+m*u),e.lineTo(o,r),e.closePath(),e.stroke();const g=r+(v+4*l+s/2)*u;e.moveTo(o,r),e.beginPath(),e.arc(o-d/2,g,s/2,Math.PI/2,1.5*Math.PI),e.arc(o+d/2,g,s/2,-Math.PI/2,1.5*-Math.PI),e.moveTo(o-d/2,g+s/2),e.lineTo(o+d/2,g+s/2),e.moveTo(o-d/2,g-s/2),e.lineTo(o+d/2,g-s/2),e.closePath(),e.stroke(),e.beginPath(),e.arc(o-d/2,g,s/2,Math.PI/2,1.5*Math.PI),e.arc(o+d/2,g,s/2,-Math.PI/2,1.5*-Math.PI),e.moveTo(o-d/2,g+s/2),e.lineTo(o+d/2,g+s/2),e.moveTo(o-d/2,g-s/2),e.lineTo(o+d/2,g-s/2),e.closePath(),e.fill()}function b(t){const{ctx:e,x:o,y:r,height:i,diameter:s,fillStyle:a,isArrowUp:l}=t;e.save(),e.fillStyle=a,e.globalAlpha=.18,e.beginPath(),l?(e.arc(o,r,s/2,Math.PI,2*Math.PI),e.arc(o,r+i,s/2,2*-Math.PI,-Math.PI)):(e.arc(o,r-i,s/2,Math.PI,2*Math.PI),e.arc(o,r,s/2,2*-Math.PI,-Math.PI)),e.closePath(),e.fill(),e.restore()}function C(t){const{ctx:e,pixelRatio:o,text:r,centerX:i,centerY:s,textMidCorrection:a,font:n,fillStyle:d,strokeStyle:c,isArrowUp:h}=t;e.save(),e.textAlign="center",e.textBaseline="middle",e.fillStyle=d,e.font=n,e.lineJoin="round",e.strokeStyle=c;const[u,p]=r.split("\n");u.length>3?(h?e.translate(i,s+a):e.translate(i,s+a-15*o.horizontalPixelRatio),(0,l.drawScaled)(e,o.horizontalPixelRatio,o.verticalPixelRatio,(()=>{e.strokeText(u,0,0),e.fillText(u,0,0),e.strokeText(p,0,15),
e.fillText(p,0,15)}))):(e.translate(i,s+a),(0,l.drawScaled)(e,o.horizontalPixelRatio,o.verticalPixelRatio,(()=>{e.strokeText(r,0,0),e.fillText(r,0,0)}))),e.restore()}},560202:(t,e,o)=>{"use strict";o.d(e,{generateOrderColorTheme:()=>i});var r=o(316167);function i(t){const{text:e,buySecondary:o,buyDisabled:i,buyPrimary:s,confirmActiveBuy:a,textDisabled:l,backgroundDisabled:n,background:d,takeProfitPrimary:c,sellSecondary:h,sellDisabled:u,sellPrimary:p,confirmActiveSell:_,stopLossPrimary:y,takeProfitSecondary:m,stopLossSecondary:f,buyActive:b,sellActive:C,takeProfitActive:v,takeProfitHintColor:g,takeProfitMovingColor:P,stopLossActive:k,stopLossHintColor:T,stopLossMovingColor:x,buyPointShadow:M,sellPointShadow:w,takeProfitPointShadow:S,stopLossPointShadow:B,overlay:D,errorNotificationBackdrop:I,themedText:L,themedBorder:R}=t,O={pointShadowColor:M,labelTickColor:s,lineColor:s,borderBackgroundColor:d,borderColor:s,pointBackgroundColor:d,disabledLineColor:i,positivePlColor:c,negativePlColor:p,qty:{backgroundColor:d,textColor:s,dividerColor:o,activeColor:b},text:{backgroundColor:d,textColor:s,dividerColor:o,buttonTextColor:s,activeColor:b},close:{backgroundColor:d,iconColor:s,activeColor:b},confirm:{disableBackgroundColor:n,backgroundColor:s,borderColor:s,textColor:e,disableTextColor:l,activeColor:a},cancel:{disableBackgroundColor:n,backgroundColor:d,borderColor:R,textColor:L,disableTextColor:l,activeColor:a},informer:{backgroundColor:I,iconColor:p},anchor:{backgroundColor:d,borderColor:s,shadowColor:M}},W={pointShadowColor:w,labelTickColor:p,lineColor:p,borderBackgroundColor:d,borderColor:p,pointBackgroundColor:d,disabledLineColor:u,positivePlColor:c,negativePlColor:p,qty:{backgroundColor:d,textColor:p,dividerColor:h,activeColor:C},text:{backgroundColor:d,textColor:p,dividerColor:h,buttonTextColor:p,activeColor:C},close:{backgroundColor:d,iconColor:p,activeColor:C},confirm:{disableBackgroundColor:n,backgroundColor:p,borderColor:p,textColor:e,disableTextColor:l,activeColor:_},cancel:{disableBackgroundColor:n,backgroundColor:d,borderColor:R,textColor:L,disableTextColor:l,activeColor:a},informer:{backgroundColor:I,iconColor:p},anchor:{backgroundColor:d,borderColor:s,shadowColor:M}},H={pointShadowColor:S,labelTickColor:c,lineColor:c,borderBackgroundColor:d,borderColor:c,pointBackgroundColor:d,positivePlColor:c,negativePlColor:p,qty:{backgroundColor:d,textColor:c,dividerColor:m,activeColor:v},text:{backgroundColor:d,textColor:c,dividerColor:m,buttonTextColor:c,activeColor:v,hintAreaColor:g},close:{backgroundColor:d,iconColor:c,activeColor:v},informer:{backgroundColor:I,iconColor:p},anchor:{backgroundColor:d,borderColor:s,shadowColor:M},movingBackgroundColor:P,confirm:{disableBackgroundColor:n,backgroundColor:s,borderColor:s,textColor:e,disableTextColor:l,activeColor:a},cancel:{disableBackgroundColor:n,backgroundColor:d,borderColor:R,textColor:L,disableTextColor:l,activeColor:a}},A={pointShadowColor:B,labelTickColor:y,lineColor:y,borderBackgroundColor:d,borderColor:y,pointBackgroundColor:d,positivePlColor:c,negativePlColor:p,
qty:{backgroundColor:d,textColor:y,dividerColor:f,activeColor:k},text:{backgroundColor:d,textColor:y,dividerColor:f,buttonTextColor:y,activeColor:k,hintAreaColor:T},close:{backgroundColor:d,iconColor:y,activeColor:k},informer:{backgroundColor:I,iconColor:p},anchor:{backgroundColor:d,borderColor:s,shadowColor:M},movingBackgroundColor:x,confirm:{disableBackgroundColor:n,backgroundColor:s,borderColor:s,textColor:e,disableTextColor:l,activeColor:a},cancel:{disableBackgroundColor:n,backgroundColor:d,borderColor:R,textColor:L,disableTextColor:l,activeColor:a}};return{buy:{normal:O,disabled:(0,r.generateBlendColors)(O,D)},sell:{normal:W,disabled:(0,r.generateBlendColors)(W,D)},takeProfit:{normal:H,disabled:(0,r.generateBlendColors)(H,D)},stopLoss:{normal:A,disabled:(0,r.generateBlendColors)(A,D)}}}},484686:(t,e,o)=>{"use strict";o.d(e,{isTradingObjVisibleOnScreenshot:()=>i});var r=o(534934);function i(){return r.enabled("snapshot_trading_drawings")}}}]);