(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[4627],{533384:e=>{e.exports={button:"button-PYEOTd6i",disabled:"disabled-PYEOTd6i",hidden:"hidden-PYEOTd6i",icon:"icon-PYEOTd6i",dropped:"dropped-PYEOTd6i"}},678938:e=>{e.exports={dropdownButton:"dropdownButton-G6buUFKH",top:"top-G6buUFKH",left:"left-G6buUFKH",right:"right-G6buUFKH",bottom:"bottom-G6buUFKH"}},487426:e=>{e.exports={button:"button-pzM0w4il",open:"open-pzM0w4il",default:"default-pzM0w4il",disabled:"disabled-pzM0w4il",danger:"danger-pzM0w4il",warning:"warning-pzM0w4il",xsmall:"xsmall-pzM0w4il",small:"small-pzM0w4il",medium:"medium-pzM0w4il",large:"large-pzM0w4il",content:"content-pzM0w4il",startSlot:"startSlot-pzM0w4il",middleSlot:"middleSlot-pzM0w4il",stretch:"stretch-pzM0w4il",caret:"caret-pzM0w4il"}},297822:e=>{e.exports={label:"label-oHMFhnC8"}},769523:e=>{e.exports={container:"container-TCHLKPuQ","container-danger":"container-danger-TCHLKPuQ","light-title":"light-title-TCHLKPuQ","light-icon":"light-icon-TCHLKPuQ",icon:"icon-TCHLKPuQ",header:"header-TCHLKPuQ","light-container-danger":"light-container-danger-TCHLKPuQ","container-warning":"container-warning-TCHLKPuQ","light-container-warning":"light-container-warning-TCHLKPuQ","container-success":"container-success-TCHLKPuQ","light-container-success":"light-container-success-TCHLKPuQ","container-default":"container-default-TCHLKPuQ","light-container-default":"light-container-default-TCHLKPuQ","text-wrap":"text-wrap-TCHLKPuQ","light-text-wrap":"light-text-wrap-TCHLKPuQ","close-button":"close-button-TCHLKPuQ","light-close-button":"light-close-button-TCHLKPuQ",informerBody:"informerBody-TCHLKPuQ",mainProblem:"mainProblem-TCHLKPuQ","header-inline":"header-inline-TCHLKPuQ","header-new-line":"header-new-line-TCHLKPuQ"}},452583:e=>{e.exports={anchor:"anchor-hRFQR3av"}},13318:e=>{e.exports={"menu-divider":"menu-divider-YZ5qU_gy","menu-divider-line":"menu-divider-line-YZ5qU_gy"}},17175:e=>{e.exports={nestedPopovers:"nestedPopovers-LXzo3rzz"}},736535:e=>{e.exports={wrapper:"wrapper-HLS9OacM",help:"help-HLS9OacM"}},260382:e=>{e.exports={wait:"wait-DPlbqdw3",checkboxWrapper:"checkboxWrapper-DPlbqdw3"}},955806:e=>{e.exports={customField:"customField-64DiJaqR"}},66988:e=>{e.exports={wait:"wait-GhO6ya4a"}},578891:e=>{e.exports={container:"container-l6FVmx3S"}},812467:e=>{e.exports={wrapper:"wrapper-j3GOYMat",button:"button-j3GOYMat",buy:"buy-j3GOYMat",sell:"sell-j3GOYMat",profit:"profit-j3GOYMat",loss:"loss-j3GOYMat"}},669331:e=>{e.exports={cancelOrders:"cancelOrders-m2XMeKi6",reversed:"reversed-m2XMeKi6",countedVolume:"countedVolume-m2XMeKi6",cancelButton:"cancelButton-m2XMeKi6"}},47103:e=>{e.exports={hintPlaceholder:"hintPlaceholder-r_FUchCa"}},678641:e=>{e.exports={centeringContainer:"centeringContainer-AQZPvIZ5",volume:"volume-AQZPvIZ5",bid:"bid-AQZPvIZ5",ask:"ask-AQZPvIZ5"}},790891:e=>{e.exports={domControls:"domControls-YIrj9QFH"}},231139:e=>{e.exports={switchModeButton:"switchModeButton-XDRLiDDn",timer:"timer-XDRLiDDn"}},498121:e=>{e.exports={timer:"timer-xnZGqIWx"}},471886:e=>{e.exports={
headerWrapper:"headerWrapper-tEyqHGm0",header:"header-tEyqHGm0",details:"details-tEyqHGm0",duration:"duration-tEyqHGm0",arrow:"arrow-tEyqHGm0",upperCase:"upperCase-tEyqHGm0",textBlock:"textBlock-tEyqHGm0",tifValue:"tifValue-tEyqHGm0",summaryLine:"summaryLine-tEyqHGm0"}},615344:e=>{e.exports={widgetcolumnwidthbuysell:"58px",widgetcolumnwidthmiddle:"78px",widgetcolumnwidthorders:"56px",widgetborderwidth:"1px","tv-dom-panel":"tv-dom-panel-WJ5VG8Pz","tv-dom-panel__header":"tv-dom-panel__header-WJ5VG8Pz","tv-dom-panel__header-title":"tv-dom-panel__header-title-WJ5VG8Pz","tv-dom-panel__header-symbol":"tv-dom-panel__header-symbol-WJ5VG8Pz","tv-dom-panel__header-exchange":"tv-dom-panel__header-exchange-WJ5VG8Pz","tv-dom-panel__header-close":"tv-dom-panel__header-close-WJ5VG8Pz","tv-dom-panel__header-warning":"tv-dom-panel__header-warning-WJ5VG8Pz","tv-dom-panel__header-warning--active":"tv-dom-panel__header-warning--active-WJ5VG8Pz","tv-dom-panel__content":"tv-dom-panel__content-WJ5VG8Pz","tv-dom-panel__warning":"tv-dom-panel__warning-WJ5VG8Pz","tv-dom-panel__disabled":"tv-dom-panel__disabled-WJ5VG8Pz","tv-dom-panel__disabled-warning":"tv-dom-panel__disabled-warning-WJ5VG8Pz",mainblock:"mainblock-WJ5VG8Pz",emptyStateImage:"emptyStateImage-WJ5VG8Pz",header:"header-WJ5VG8Pz"}},240134:e=>{e.exports={wrapper:"wrapper-BpNh_MLZ",qty:"qty-BpNh_MLZ",errorsContainer:"errorsContainer-BpNh_MLZ"}},220070:e=>{e.exports={upperBlock:"upperBlock-pOOE9kBn",bottomBlock:"bottomBlock-pOOE9kBn"}},553e3:e=>{e.exports={widgetcolumnwidthbuysell:"58px",widgetcolumnwidthmiddle:"78px",widgetcolumnwidthorders:"56px",widgetordertypeheight:"10px",widgetborderwidth:"1px",widgetrowheight:"20px","tv-dom-widget-main":"tv-dom-widget-main-S1ZrBpKB","tv-dom-widget-main__anchor":"tv-dom-widget-main__anchor-S1ZrBpKB","tv-dom-widget-main__row":"tv-dom-widget-main__row-S1ZrBpKB","tv-dom-widget-main__value":"tv-dom-widget-main__value-S1ZrBpKB","tv-dom-widget-main__value--price":"tv-dom-widget-main__value--price-S1ZrBpKB","tv-dom-widget-main__value--highlighted":"tv-dom-widget-main__value--highlighted-S1ZrBpKB","tv-dom-widget-main__value--long-position":"tv-dom-widget-main__value--long-position-S1ZrBpKB","tv-dom-widget-main__value--short-position":"tv-dom-widget-main__value--short-position-S1ZrBpKB","tv-dom-widget-main__value--buy":"tv-dom-widget-main__value--buy-S1ZrBpKB","tv-dom-widget-main__value--sell":"tv-dom-widget-main__value--sell-S1ZrBpKB","tv-dom-widget-main__value--orders-buy":"tv-dom-widget-main__value--orders-buy-S1ZrBpKB","tv-dom-widget-main__value--orders-sell":"tv-dom-widget-main__value--orders-sell-S1ZrBpKB","tv-dom-widget-main__value--color-bid":"tv-dom-widget-main__value--color-bid-S1ZrBpKB","tv-dom-widget-main__value--color-ask":"tv-dom-widget-main__value--color-ask-S1ZrBpKB","tv-dom-widget-main__label":"tv-dom-widget-main__label-S1ZrBpKB","tv-dom-widget-main__label--active":"tv-dom-widget-main__label--active-S1ZrBpKB","tv-dom-widget-main__meter":"tv-dom-widget-main__meter-S1ZrBpKB",
"tv-dom-widget-main__meter--buy":"tv-dom-widget-main__meter--buy-S1ZrBpKB","tv-dom-widget-main__meter--buy-active":"tv-dom-widget-main__meter--buy-active-S1ZrBpKB","tv-dom-widget-main__meter--sell":"tv-dom-widget-main__meter--sell-S1ZrBpKB","tv-dom-widget-main__meter--sell-active":"tv-dom-widget-main__meter--sell-active-S1ZrBpKB","tv-dom-widget-main__value-readout":"tv-dom-widget-main__value-readout-S1ZrBpKB","tv-dom-widget-main__offscreen-arrow":"tv-dom-widget-main__offscreen-arrow-S1ZrBpKB","tv-dom-widget-main__offscreen-arrow--higher":"tv-dom-widget-main__offscreen-arrow--higher-S1ZrBpKB","tv-dom-widget-main__offscreen-arrow--lower":"tv-dom-widget-main__offscreen-arrow--lower-S1ZrBpKB","tv-dom-widget-main__order":"tv-dom-widget-main__order-S1ZrBpKB","tv-dom-widget-main__order--collapsed":"tv-dom-widget-main__order--collapsed-S1ZrBpKB","tv-dom-widget-main__drag-shield":"tv-dom-widget-main__drag-shield-S1ZrBpKB","tv-dom-widget-main__drag-shield--order":"tv-dom-widget-main__drag-shield--order-S1ZrBpKB","tv-dom-widget-main__hidden":"tv-dom-widget-main__hidden-S1ZrBpKB"}},569282:e=>{e.exports={widgetordertypeheight:"10px",widgetrowheight:"20px",widgetborderwidth:"1px",widgetyellow:"#ffc84a","tv-dom-widget-order":"tv-dom-widget-order-YzgGdJzq","tv-dom-widget-order--ghost":"tv-dom-widget-order--ghost-YzgGdJzq","tv-dom-widget-order--inactive":"tv-dom-widget-order--inactive-YzgGdJzq","tv-dom-widget-order--type-stop":"tv-dom-widget-order--type-stop-YzgGdJzq","tv-dom-widget-order__close":"tv-dom-widget-order__close-YzgGdJzq","tv-dom-widget-order--type-stoplimit":"tv-dom-widget-order--type-stoplimit-YzgGdJzq","tv-dom-widget-order--highlighted":"tv-dom-widget-order--highlighted-YzgGdJzq","tv-dom-widget-order--buy":"tv-dom-widget-order--buy-YzgGdJzq","tv-dom-widget-order--notcanceled":"tv-dom-widget-order--notcanceled-YzgGdJzq","tv-dom-widget-order__qty":"tv-dom-widget-order__qty-YzgGdJzq","tv-dom-widget-order--immovable":"tv-dom-widget-order--immovable-YzgGdJzq","tv-dom-widget-order--unmodified":"tv-dom-widget-order--unmodified-YzgGdJzq","tv-dom-widget-order__type":"tv-dom-widget-order__type-YzgGdJzq"}},877254:e=>{e.exports={hotKeyTitle:"hotKeyTitle-C608a1Xd"}},470116:e=>{e.exports={wrapper:"wrapper-btWtGFgr",marketBlock:"marketBlock-btWtGFgr",tradingActionBlock:"tradingActionBlock-btWtGFgr",container:"container-btWtGFgr",row:"row-btWtGFgr",button:"button-btWtGFgr"}},553238:e=>{e.exports={wrapper:"wrapper-RoaZjf69",title:"title-RoaZjf69",label:"label-RoaZjf69"}},932443:e=>{e.exports={dateTimeWrapper:"dateTimeWrapper-Dg2Jb5Mv",dateInputContainer:"dateInputContainer-Dg2Jb5Mv",dateInput:"dateInput-Dg2Jb5Mv"}},116673:e=>{e.exports={hiddenLabel:"hiddenLabel-XFowpoet"}},456213:e=>{e.exports={wrapper:"wrapper-kE2Vzuu8",label:"label-kE2Vzuu8"}},74968:e=>{e.exports={informer:"informer-iBPUmjfh"}},21923:e=>{e.exports={wrapper:"wrapper-eYAfVbpw"}},695864:e=>{e.exports={container:"container-yrIMi47q",title:"title-yrIMi47q",title_normal:"title_normal-yrIMi47q",icon:"icon-yrIMi47q",text:"text-yrIMi47q",text_large:"text_large-yrIMi47q",
action:"action-yrIMi47q"}},148982:(e,t,i)=>{"use strict";i.d(t,{Caret:()=>h,CaretButton:()=>m});var s=i(50959),r=i(497754),n=i.n(r),o=i(878112),a=i(602948),l=i.n(a),d=i(533384),c=i.n(d);function u(e){const{isDropped:t}=e;return s.createElement(o.Icon,{className:n()(c().icon,t&&c().dropped),icon:l()})}function h(e){const{className:t,disabled:i,isDropped:r}=e;return s.createElement("span",{className:n()(c().button,i&&c().disabled,t)},s.createElement(u,{isDropped:r}))}function m(e){const{className:t,tabIndex:i=-1,disabled:r,isDropped:o,...a}=e;return s.createElement("button",{...a,type:"button",tabIndex:i,disabled:r,className:n()(c().button,r&&c().disabled,t)},s.createElement(u,{isDropped:o}))}},962089:(e,t,i)=>{"use strict";i.d(t,{DropdownButton:()=>h});var s,r,n=i(50959),o=i(497754),a=i.n(o),l=i(148982),d=i(800417),c=i(487426),u=i.n(c);function h(e){const{role:t,startSlot:i,children:s,isOpen:r,onClick:o,onKeyDown:c,id:h,reference:m,ariaActivedescendant:p,stretch:_,buttonClassname:g,disabled:v,ariaHaspopup:b,ariaControls:y,ariaLabelledby:w,size:f="medium",intent:S="default",...k}=e,x=(0,d.filterDataProps)(k);return n.createElement("button",{type:"button",ref:m,role:t,"aria-controls":y,"aria-expanded":r,"aria-haspopup":b,"aria-activedescendant":p,"aria-disabled":v,"aria-labelledby":w,tabIndex:v?-1:0,onClick:v?void 0:o,onKeyDown:v?void 0:c,id:h,className:a()(u().button,g,v&&u().disabled,_&&u().stretch,f&&u()[f],u()[S],r&&u().open),...x},n.createElement("div",{className:u().content},i&&n.createElement("div",{className:u().startSlot},i),s&&n.createElement("div",{className:u().middleSlot},s),n.createElement(l.Caret,{isDropped:r,className:u().caret,disabled:!0})))}!function(e){e.Default="default",e.Danger="danger",e.Warning="warning"}(s||(s={})),function(e){e.XSmall="xsmall",e.Small="small",e.Medium="medium",e.Large="large"}(r||(r={}))},463039:(e,t,i)=>{"use strict";i.d(t,{Label:()=>d});var s=i(50959),r=i(497754),n=i.n(r),o=i(102691),a=i(297822),l=i.n(a);function d(e){const{htmlFor:t,children:i,className:r,id:a,...d}=e;return s.createElement(o.BeforeSlot,{...d,className:n()(l().label,r)},s.createElement("label",{id:a,htmlFor:t},i))}},918460:(e,t,i)=>{"use strict";i.d(t,{Informer:()=>w});var s,r,n=i(50959),o=i(497754),a=i.n(o),l=i(878112),d=i(389986),c=i(800417),u=i(530162),h=i.n(u),m=i(527941),p=i.n(m),_=i(499084),g=i.n(_),v=i(769523),b=i.n(v);!function(e){e.Danger="danger",e.Warning="warning",e.Success="success",e.Default="default"}(s||(s={})),function(e){e.Inline="inline",e.NewLine="new-line"}(r||(r={}));const y={danger:h(),warning:h(),success:g(),default:p()};function w(e){const{informerIntent:t,content:i,className:s,header:r,isIconShown:o=!0,isCloseButtonShown:u,icon:h,onCloseClick:m,closeButtonLabel:p="Close",headerPlacement:_="inline",children:g,isLight:v}=e;return n.createElement("div",{className:a()(b().container,b()[`container-${t}`],v&&b()[`light-container-${t}`],s),...(0,c.filterDataProps)(e),...(0,c.filterAriaProps)(e)},n.createElement("div",{className:b().informerBody},i&&n.createElement("div",{
className:b().mainProblem},o&&n.createElement(l.Icon,{className:a()(b().icon,v&&b()["light-icon"]),icon:h??y[t]}),n.createElement("div",{className:a()(b()["text-wrap"],v&&b()["light-text-wrap"])},r&&n.createElement("span",{className:a()(v&&b()["light-title"],b().header,b()[`header-${v?"new-line":_}`])},r),n.createElement("span",{"aria-live":"assertive"}," ",i))),g),u&&n.createElement(d.CloseButton,{"aria-label":p,onClick:m,className:a()(v&&b()["light-close-button"],b()["close-button"]),size:v?"xxsmall":"xsmall",preservePaddings:!v}))}},721717:(e,t,i)=>{"use strict";i.d(t,{Select:()=>I,SelectPopover:()=>y,useSelectAnchorProps:()=>x});var s=i(50959),r=i(497754),n=i.n(r),o=i(962089),a=i(380327),l=i(678938),d=i.n(l);function c(e){const{isGrouped:t,cellState:i}=(0,s.useContext)(a.ControlGroupContext);return t?s.createElement("div",{className:n()(d().dropdownButton,i.isTop&&d().top,i.isLeft&&d().left,i.isBottom&&d().bottom,i.isRight&&d().right)},s.createElement(o.DropdownButton,{...e,stretch:e.stretch??!0})):s.createElement(o.DropdownButton,{...e})}var u=i(152601),h=i(723991),m=i(354648),p=i(911794);function _(e){return"divider"!==e?.type}function g(e){return e.flatMap((e=>"items"in e?e.items:e))}var v=i(167554),b=i(603369);function y(e){const{isOpen:t,onClose:i,anchorId:r,anchorButtonRef:n,contentId:o,items:a,value:l,onChange:d,placementRules:c,width:h,height:m,closeOnClickAway:y,mobileBreakpoint:f,closeOnResizeWindow:S,closeOnScrollOutside:k,...x}=e,T=(0,s.useCallback)((e=>{i(!0,"currentLevel"),d(e)}),[i,d]),P=(0,s.useId)(),I=(0,s.useMemo)((()=>g(a.filter(_))),[a]),C=(0,s.useMemo)((()=>I.findIndex((e=>e.value===l))),[I,l]);(0,s.useEffect)((()=>{if(!t)return;if(-1===C)return;const e=`item_${P}_${C}`,i=document.getElementById(e);i&&function(e){if(window.requestIdleCallback){const t=window.requestIdleCallback(e);return()=>window.cancelIdleCallback(t)}{const t=setTimeout(e)}}((()=>{i.focus({preventScroll:!0}),(0,p.scrollPopoverItemIntoView)(i,!1)}))}),[P,C,t]);const O=(0,s.useCallback)((()=>{let e=0;function t(t){return s.createElement(w,{id:`item_${P}_${e++}`,key:`${t.title}:${t.description}`,value:l,item:t,onSelectItem:T})}return s.createElement(s.Fragment,null,a.map(((e,i)=>{return"items"in(r=e)||"divider"===r?.type?"divider"===e.type?s.createElement(b.DividerPopoverItem,{role:"presentation",key:`divider_${P}_${i}`}):s.createElement(v.SectionPopoverItem,{key:`group_${P}_${i}`,title:e.title},e.items.map(t)):t(e);var r})))}),[a,T,P,l]),E=(0,s.useMemo)(O,[O]),M=x;return s.createElement(u.PopoverKeyboardNavigator,{role:"listbox",ariaLabelledby:r,isOpen:t,onClose:i,anchored:{type:"element",at:n},idOfContentWrapperElement:o,placementRules:c,width:h,height:m,focusFirstItemOnOpen:!1,closeOnClickAway:y,mobileBreakpoint:f,closeOnResizeWindow:S,closeOnScrollOutside:k,...M},E)}function w(e){const{id:t,value:i,item:r,onSelectItem:n}=e,o=(0,s.useCallback)((()=>n(r.value)),[n,r.value]),a=i===r.value;return s.createElement(h.PopoverItem,{role:"option",selected:a,ariaChecked:a,title:r.title,leftSlot:(0,m.iconPart)(r),key:r.title,
popoverItemButtonId:t,onClick:o,disabled:r.disabled,"data-qa-id":"ui-lib-popoverItem"})}var f=i(925286),S=i(928141),k=i(937901);function x(e){return function(e){const{isOpen:t,onClose:i,contentId:s,anchorButtonRef:r,anchorId:n,handleAnchorClick:o,handleAnchorKeyDown:a}=(0,f.useDefaultButtonAnchorProps)({anchorId:e.anchorId,openOnEnter:e.openOnEnter});return{isOpen:t,anchorProps:{id:n,role:"combobox",onClick:o,onKeyDown:a,...(0,k.createRefProp)(e.refStyle,r),...(0,S.createAriaAttributesProps)(e.ariaStyle,{expanded:t,controls:s,haspopup:"listbox"})},popoverProps:{isOpen:t,anchorId:n,anchorButtonRef:r,contentId:s,onClose:i,items:e.items,value:e.value,onChange:e.onChange}}}({items:e.items,value:e.value,onChange:e.onChange,refStyle:e?.refStyle??"reference",ariaStyle:e?.ariaStyle??"kebab-case",openOnEnter:e.openOnEnter,anchorId:e?.anchorId})}var T=i(452583),P=i.n(T);function I(e){const{title:t,items:i,onChange:r,value:o,noneSelectedTitle:a,popoverPlacementRules:l,popoverWidth:d,popoverHeight:u,stretch:h,anchorButtonId:m,disabled:p,anchorButtonSize:v,anchorButtonSizeClassname:b,openOnEnter:w,anchorButtonIntent:f,popoverMobileBreakpoint:S,popoverCloseOnScrollOutside:k,popoverCloseOnResizeWindow:T}=e,I=(0,s.useMemo)((()=>g(i.filter(_)).find((e=>e.value===o))),[i,o]),{isOpen:C,anchorProps:O,popoverProps:E}=x({items:i,value:o,onChange:r,openOnEnter:w,ariaStyle:"camelCase",anchorId:m}),M=t??I?.title??a;return s.createElement(s.Fragment,null,s.createElement("div",{className:n()(b,P().anchor)},s.createElement(c,{...O,children:M,isOpen:C,stretch:h,disabled:p,size:v,intent:f})),s.createElement(y,{...E,placementRules:l,width:d,height:u,mobileBreakpoint:S,closeOnScrollOutside:k,closeOnResizeWindow:T}))}},603369:(e,t,i)=>{"use strict";i.d(t,{DividerPopoverItem:()=>o});var s=i(50959),r=i(13318),n=i.n(r);function o(e){const{role:t,...i}=e,r=i;return s.createElement("div",{className:n()["menu-divider"],role:t,...r},s.createElement("div",{className:n()["menu-divider-line"]}))}},167554:(e,t,i)=>{"use strict";i.d(t,{SectionPopoverItem:()=>d});var s=i(50959),r=i(497754),n=i.n(r),o=i(601367),a=i(17175),l=i.n(a);function d(e){const{id:t,title:i,children:r,itemRole:a,wrappable:d,defaultWrapped:c,onWrappedChanged:u,ariaLabel:h,rightSlot:m,rightSlotAriaLabelledby:p,..._}=e,g=_,[v,b]=(0,s.useState)(c??!1),y=(0,s.useId)(),w=(0,s.useId)();return s.createElement(s.Fragment,null,s.createElement(o.TitlePopoverItem,{...g,"data-qa-id":"ui-lib-sectionPopoverItem",id:t,title:i,role:a,rightSlot:m,rightSlotAriaLabelledby:p,ariaLabel:h,variant:"secondary",ariaControls:d?w:void 0,titleId:y,wrappable:d,wrapped:v,onClick:d?function(){b((e=>{const t=!e;return u?.(t),t}))}:void 0}),s.createElement("div",{role:"group","aria-labelledby":y,id:w,className:n()(v&&l().wrapped)},!v&&r))}},928141:(e,t,i)=>{"use strict";function s(e,t){const i={};for(const r of Object.entries(t))i["camelCase"===e?"aria"+(s=r[0],""===s?"":s[0].toUpperCase()+s.substring(1)):"aria-"+r[0]]=r[1];var s;return i}i.d(t,{createAriaAttributesProps:()=>s})},937901:(e,t,i)=>{"use strict"
;function s(e,t){return{[e]:t}}i.d(t,{createRefProp:()=>s})},14699:(e,t,i)=>{"use strict";i.d(t,{CustomFields:()=>T});var s=i(50959),r=i(302946),n=i(481476),o=i(472488),a=i(892106),l=i(260382);function d(e){const{id:t,inputType:i,className:d,text:c,title:u,placeholder:h,onCheckboxToggle:m,onClick:p,onInputChange:_,errorMessage:g,checked:v,checkboxTitle:b}=e,y=`custom_field_with_checkbox__${t}`;return s.createElement("div",{className:d},u&&u.length>0&&s.createElement(o.Label,{htmlFor:y},u),s.createElement(n.FormInput,{stretch:!0,id:y,type:i,value:c,placeholder:h,onChange:_,onClick:p,hasErrors:void 0!==g,messagesPosition:a.MessagesPosition.Attached,messagesAttachment:a.ControlMessagesAttachment.Top,errors:g?[g]:void 0}),s.createElement("div",{className:l.checkboxWrapper},s.createElement(r.Checkbox,{checked:v,label:b,onChange:m})))}var c=i(661851);function u(e){const{inputType:t,id:i,text$:r,getText:n,setText:o,checked$:a,getChecked:u,setChecked:h,title:m,checkboxTitle:p,placeholder:_,isWait:g,onControlFocused:v,errorMessage$:b}=e,y=(0,c.useObservable)(r,n()),w=(0,c.useObservable)(a,u()),f=(0,c.useObservable)(b);return s.createElement(d,{className:g?l.wait:void 0,id:i,inputType:t,text:y,checked:w,title:m,checkboxTitle:p,placeholder:_,onInputChange:e=>o(e.currentTarget.value),onCheckboxToggle:()=>{h(!w),v.fire()},onClick:()=>v.fire(),errorMessage:f})}var h=i(609838),m=i(721717),p=i(102691),_=i(148982);function g(e){const{items:t,forceUserToSelectValue:r,alwaysShowAttachedErrors$:l,selectedItem:d,disabled:u,title:g,onClick:v,onItemSelected:b}=e,y=`custom-combobox__${e.id}`,w=(0,s.useMemo)((()=>function(e){return e.map((e=>({value:e.value,title:e.text})))}(t)),[t]),f=(0,s.useMemo)((()=>function(e,t){if(e)return t.find((t=>t.value===e))?.text}(d,t)),[d,t]),{anchorProps:S,popoverProps:k}=(0,m.useSelectAnchorProps)({items:w,value:d,onChange:b}),x=(0,c.useObservable)(l),T=void 0===d&&r;return s.createElement(s.Fragment,null,s.createElement(o.Label,{htmlFor:y},g),s.createElement(n.FormInput,{...S,stretch:!0,readonly:!0,noReadonlyStyles:!0,disabled:u,disableMessagesRtlStyles:!0,id:y,onClick:e=>{S.onClick(e),v?.()},value:f||h.t(null,void 0,i(707343)),onChange:()=>{},endSlot:s.createElement(p.EndSlot,null,s.createElement(_.Caret,{isDropped:k.isOpen})),"aria-required":r,"aria-invalid":T,hasErrors:T,messagesPosition:a.MessagesPosition.Attached,messagesAttachment:a.ControlMessagesAttachment.Top,alwaysShowAttachedErrors:x,errors:[h.t(null,void 0,i(280784))]}),s.createElement(m.SelectPopover,{...k}))}function v(e){const{title:t,id:i,items:r,selectedItem$:n,getSelectedItem:o,setSelectedItem:a,forceUserToSelectValue:l,alwaysShowAttachedErrors$:d,disabled:u,onControlFocused:h}=e,m=(0,c.useObservable)(n,o());return s.createElement(g,{title:t,id:i,items:r,selectedItem:m,onItemSelected:e=>a(e),disabled:u,onClick:()=>h?.fire(),forceUserToSelectValue:l,alwaysShowAttachedErrors$:d})}var b=i(842865),y=i(736535);function w(e){const{title:t,help:i,solutionId:n,disabled:o,checked$:a,getChecked:l,setChecked:d,onControlFocused:u}=e,h=(0,
c.useObservable)(a,l()),m=Boolean(i)||void 0!==n;return s.createElement("div",{className:y.wrapper,onFocus:function(){u?.fire()}},s.createElement(r.Checkbox,{label:t,checked:h,onChange:function(){d(!h)},disabled:o}),m&&s.createElement(b.TradingInformer,{informerMessage:i,solutionId:n,className:y.help,intent:"neutral-light"}))}function f(e){const{inputType:t,className:i,id:r,text:l,title:d,placeholder:c,onInputChange:u,onClick:h,errorMessage:m,disabled:p}=e,_=`custom-text-input__${r}`;return s.createElement("div",null,d&&d.length>0&&s.createElement(o.Label,{htmlFor:_},d),s.createElement(n.FormInput,{stretch:!0,className:i,id:_,type:t,value:l,placeholder:c,onChange:u,onClick:h,hasErrors:void 0!==m,messagesPosition:a.MessagesPosition.Attached,messagesAttachment:a.ControlMessagesAttachment.Top,errors:m?[m]:void 0,disabled:p}))}var S=i(66988);function k(e){const{inputType:t,text$:i,id:r,getText:n,setText:o,title:a,placeholder:l,isWait:d,onControlFocused:u,errorMessage$:h,disabled:m}=e,p=(0,c.useObservable)(i,n()),_=(0,c.useObservable)(h);return s.createElement(f,{className:d?S.wait:void 0,id:r,inputType:t,text:p,title:a,placeholder:l,onInputChange:e=>o(e.currentTarget.value),onClick:()=>u.fire(),errorMessage:_,disabled:m})}var x=i(955806);function T(e){const{customFieldModels:t,isWait:i,forceUserToSelectValue:r}=e;return s.createElement(s.Fragment,null,t.map((e=>s.createElement("div",{key:e.id,className:x.customField},"TextField"===e.type&&s.createElement(k,{inputType:e.inputType,id:e.id,text$:e.text$,getText:e.getText,setText:e.setText,placeholder:e.placeholder,title:e.title,isWait:i,onControlFocused:e.onControlFocused,errorMessage$:e.errorMessage$,disabled:e.disabled}),"TextWithCheckBox"===e.type&&s.createElement(u,{inputType:e.inputType,id:e.id,text$:e.text$,getText:e.getText,setText:e.setText,placeholder:e.placeholder,checked$:e.checked$,getChecked:e.getChecked,setChecked:e.setChecked,title:e.title,checkboxTitle:e.checkboxTitle,isWait:i,onControlFocused:e.onControlFocused,errorMessage$:e.errorMessage$}),"Checkbox"===e.type&&s.createElement(w,{...e}),"ComboBox"===e.type&&s.createElement(v,{title:e.title,id:e.id,items:e.items,selectedItem$:e.selectedItem$,getSelectedItem:e.getSelectedItem,setSelectedItem:e.setSelectedItem,onControlFocused:e.onControlFocused,disabled:e.items.length<=1,forceUserToSelectValue:r,alwaysShowAttachedErrors$:e.alwaysShowAttachedErrors$})))))}},179050:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DOMPanel:()=>ut});var s,r,n=i(609838),o=i(632227),a=i(50959),l=i(662941),d=i(963632),c=i(650151),u=i(748838),h=i(180185),m=i(960521),p=i.n(m),_=i(947488),g=i(997345),v=i(760775),b=i(534934),y=i(181436),w=i(825850),f=i(617998),S=i(932473),k=i(485173),x=i(563859),T=i(243716),P=i(574235),I=i(130557);!function(e){e[e.Inside=0]="Inside",e[e.Lower=1]="Lower",e[e.Higher=2]="Higher"}(s||(s={})),function(e){e[e.Up=1]="Up",e[e.Down=2]="Down"}(r||(r={}));var C=i(737538),O=i(714635),E=i(799573),M=i(569282),D=i(553e3);const B={limitOrder:n.t(null,void 0,i(790258)),stopOrder:n.t(null,void 0,i(898251))};class L{constructor(e){
this._pool=[],this._handlers=e||{},this._ordersPool=new N(this._handlers),this._useCssTransform="transform"in document.createElement("span").style}allocate(){return this._pool.pop()||new V(this._ordersPool,this._handlers,this._useCssTransform)}free(e){e.destroy(),this._pool.push(e)}}class V{constructor(e,t,i){this._isStopOrderModeEnabled=!1,this._price=0,this._useCssTransform=i,this._ordersPool=e,this._handlers=t,this._allocatedOrderViews=[];const s=document.createElement("div");s.setAttribute("class",D["tv-dom-widget-main__row"]);const r=document.createElement("span");r.setAttribute("class",`${D["tv-dom-widget-main__value"]} ${D["tv-dom-widget-main__value--price"]}`);const n=document.createElement("span");n.setAttribute("class",`${D["tv-dom-widget-main__value"]} ${D["tv-dom-widget-main__value--sell"]}`);const o=document.createElement("span");o.setAttribute("class",`${D["tv-dom-widget-main__value"]} ${D["tv-dom-widget-main__value--buy"]}`);const a=document.createElement("span");a.setAttribute("class",`${D["tv-dom-widget-main__meter"]} ${D["tv-dom-widget-main__meter--sell"]}`);const l=document.createElement("span");l.setAttribute("class",`${D["tv-dom-widget-main__meter"]} ${D["tv-dom-widget-main__meter--buy"]}`);const d=document.createElement("span");d.setAttribute("class",D["tv-dom-widget-main__value-readout"]);const c=document.createElement("span");c.setAttribute("class",D["tv-dom-widget-main__value-readout"]);const u=document.createTextNode(""),h=document.createTextNode(""),m=document.createTextNode("");this._useCssTransform&&(a.style.width=l.style.width="100%",a.style.transform=l.style.transform="scale(0, 1)");const p=document.createElement("span");p.setAttribute("class",`${D["tv-dom-widget-main__value"]} ${D["tv-dom-widget-main__value--orders-buy"]}`);const _=document.createElement("span");_.textContent=B.limitOrder,_.setAttribute("class",D["tv-dom-widget-main__label"]),p.appendChild(_);const g=document.createElement("span");g.setAttribute("class",`${D["tv-dom-widget-main__value"]} ${D["tv-dom-widget-main__value--orders-sell"]}`);const v=document.createElement("span");v.textContent=B.limitOrder,v.setAttribute("class",D["tv-dom-widget-main__label"]),g.appendChild(v),s.appendChild(n),s.appendChild(o),s.appendChild(r),s.appendChild(p),s.appendChild(g),r.appendChild(m),n.appendChild(a),o.appendChild(l),n.appendChild(d),o.appendChild(c),d.appendChild(u),c.appendChild(h),this._priceCell=r,this._priceText=m,this._askText=u,this._bidText=h,this._askMeter=a,this._bidMeter=l,this._ordersBuy=p,this._ordersSell=g,this._orderBuyLabel=_,this._orderSellLabel=v,this._isHigherThanBestBid=!1,this._isLowerThanBestAsk=!1,this._orderType=1,t&&t.bidAskClick&&(n.addEventListener("click",(e=>this._handlerCellClick(-1,e)),!1),o.addEventListener("click",(e=>this._handlerCellClick(1,e)),!1)),t&&t.bidAskContextMenu&&(n.addEventListener("contextmenu",(e=>{t.bidAskContextMenu.call(null,e,{price:this._price,side:-1})}),!1),o.addEventListener("contextmenu",(e=>{t.bidAskContextMenu.call(null,e,{price:this._price,side:1})}),!1)),
n.addEventListener(E.mobiletouch?"touchstart":"mouseover",(e=>{v.textContent=this._isStopOrderModeEnabled?B.stopOrder:B.limitOrder,v.style.visibility="visible"}),!1),n.addEventListener(E.mobiletouch?"touchend":"mouseout",(()=>{v.style.visibility="hidden"}),!1),o.addEventListener(E.mobiletouch?"touchstart":"mouseover",(e=>{_.textContent=this._isStopOrderModeEnabled?B.stopOrder:B.limitOrder,_.style.visibility="visible"}),!1),o.addEventListener(E.mobiletouch?"touchend":"mouseout",(()=>{_.style.visibility="hidden"}),!1),this.element=s}updatePriceText(e){this._priceText.nodeValue=e}updateBidVolume(e){this._bidText.nodeValue!==e&&(this._bidText.nodeValue=e)}updateAskVolume(e){this._askText.nodeValue!==e&&(this._askText.nodeValue=e)}updateBidMeter(e){const t=Math.min(Math.max(e,0),1)||0;this._useCssTransform?this._bidMeter.style.transform=`scale(${t}, 1)`:this._bidMeter.style.width=100*t+"%"}updateAskMeter(e){const t=Math.min(Math.max(e,0),1)||0;this._useCssTransform?this._askMeter.style.transform=`scale(${t}, 1)`:this._askMeter.style.width=100*t+"%"}updatePriceHighlight(e,t){const i=this._priceCell.classList;if(i)i.toggle(D["tv-dom-widget-main__value--highlighted"],e),i.toggle(D["tv-dom-widget-main__value--long-position"],t>0),i.toggle(D["tv-dom-widget-main__value--short-position"],t<0);else{let i=`${D["tv-dom-widget-main__value"]} ${D["tv-dom-widget-main__value--price"]}`;e&&(i+=` ${D["tv-dom-widget-main__value--highlighted"]}`),t>0?i+=` ${D["tv-dom-widget-main__value--long-position"]}`:t<0&&(i+=` ${D["tv-dom-widget-main__value--short-position"]}`),this._priceCell.setAttribute("class",i)}}setHigherThanBid(e){this._isHigherThanBestBid=e,this._updateLabelColor(this._orderBuyLabel,this._isActive(e))}updateAskLabels(e){this._isLowerThanBestAsk=e,this._updateLabelColor(this._orderSellLabel,this._isActive(e))}setStopOrderMode(e){this._isStopOrderModeEnabled=e,this._orderType=e?3:1,this._orderSellLabel.textContent=e?B.stopOrder:B.limitOrder,this._orderBuyLabel.textContent=e?B.stopOrder:B.limitOrder,this._updateLabelColor(this._orderBuyLabel,this._isActive(this._isHigherThanBestBid)),this._updateLabelColor(this._orderSellLabel,this._isActive(this._isLowerThanBestAsk))}updatePrice(e){this._price=e}updateOrders(e){for(;this._allocatedOrderViews.length>e.length;){const e=this._allocatedOrderViews.pop();e&&this._ordersPool.free(e)}for(;this._allocatedOrderViews.length<e.length;)this._allocatedOrderViews.push(this._ordersPool.allocate());const t={};for(let i=0;i<e.length;i++){const s=e[i],r=this._allocatedOrderViews[i],n=Boolean(s.buy),o=n?1:-1;t[o]?.collapse(),t[o]=s.noCollapse?void 0:r,s.order!==r.order()&&(r.updateOrderData(s.order,s.pricePropertyName),r.updateQty(s.qty),r.updateTypeText(s.typeText),n?this._ordersBuy.prepend(r.element):this._ordersSell.append(r.element)),r.updateClassName({isBuy:n,type:s.type,inactive:s.inactive,ghost:s.ghost,highlighted:s.highlighted,isModifiable:s.isModifiable,isMovable:s.isMovable,isCancellable:s.isCancellable})}}destroy(){const e=this._allocatedOrderViews.length;if(e>0){
for(let t=0;t<e;t++)this._ordersPool.free(this._allocatedOrderViews[t]);this._allocatedOrderViews.length=0}}paintPrice(e){const t=this.element.classList;t.toggle(D["tv-dom-widget-main__value--color-ask"],"ask"===e),t.toggle(D["tv-dom-widget-main__value--color-bid"],"bid"===e)}_handlerCellClick(e,t){const i=(0,h.modifiersFromEvent)(t);if(![h.Modifiers.None,h.Modifiers.Mod].includes(i))return;const s=1===e?this._bidMeter:this._askMeter,r=1===e?"buy":"sell";clearTimeout(this._activeStateTimerId),s.classList.add(`${D[`tv-dom-widget-main__meter--${r}-active`]}`),this._activeStateTimerId=setTimeout((()=>{s.classList.remove(`${D[`tv-dom-widget-main__meter--${r}-active`]}`)}),500),this._handlers.bidAskClick.call(null,t,{price:this._price,side:e,type:i===h.Modifiers.Mod?3:1})}_updateLabelColor(e,t){const i=e.classList;if(i)i.toggle(D["tv-dom-widget-main__label--active"],t);else{let i=D["tv-dom-widget-main__label"];t&&(i+=` ${D["tv-dom-widget-main__label--active"]}`),e.setAttribute("class",i)}}_isActive(e){const t=3===this._orderType;return t&&!e||!t&&e}}class N{constructor(e){this._pool=[],this._handlers=e}allocate(){return this._pool.pop()||new F(this._handlers)}free(e){e.destroy(),this._pool.push(e)}}class F{constructor(e){this._order=null,this._pricePropertyName=null;const t=document.createElement("div");t.setAttribute("class",`${D["tv-dom-widget-main__order"]} ${M["tv-dom-widget-order"]}`);const s=document.createElement("div");s.innerHTML=i(548927),s.setAttribute("class",M["tv-dom-widget-order__close"]);const r=document.createElement("span");r.setAttribute("class",M["tv-dom-widget-order__qty"]);const n=document.createTextNode(""),o=document.createElement("span");o.setAttribute("class",M["tv-dom-widget-order__type"]);const a=document.createTextNode("");t.appendChild(s),t.appendChild(r),r.appendChild(n),t.appendChild(o),o.appendChild(a),e&&e.closeButtonClick&&s.addEventListener("click",(t=>{e.closeButtonClick.call(null,t,this._order)}),!1),e&&e.qtyClick&&r.addEventListener("click",(t=>{e.qtyClick.call(null,t,this._order)}),!1),e&&e.orderMousedown&&r.addEventListener("mousedown",(t=>{null!==this._order&&null!==this._pricePropertyName&&e.orderMousedown.call(null,t,{order:this._order,pricePropertyName:this._pricePropertyName})}),!1),this.element=t,this._qtyText=n,this._typeText=a}order(){return this._order}updateQty(e){this._qtyText.nodeValue=e||""}updateTypeText(e){this._typeText.nodeValue=e||""}updateClassName(e){const{isBuy:t,type:i,inactive:s,ghost:r,highlighted:n,isModifiable:o,isMovable:a,isCancellable:l}=e,d=this.element;d.className=`${D["tv-dom-widget-main__order"]} ${M["tv-dom-widget-order"]}`,d.classList.toggle(M["tv-dom-widget-order--buy"],!!t),d.classList.toggle(M[`tv-dom-widget-order--type-${i}`],!!i),d.classList.toggle(M["tv-dom-widget-order--inactive"],!!s),d.classList.toggle(M["tv-dom-widget-order--ghost"],!!r),d.classList.toggle(M["tv-dom-widget-order--highlighted"],!!n),d.classList.toggle(M["tv-dom-widget-order--unmodified"],!1===o),d.classList.toggle(M["tv-dom-widget-order--immovable"],!1===a),
d.classList.toggle(M["tv-dom-widget-order--notcanceled"],!1===l)}collapse(){this.element.classList.add(D["tv-dom-widget-main__order--collapsed"])}updateOrderData(e,t){this._order=e,this._pricePropertyName=t}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this._order=null}}const A=b.enabled("static_dom");function $(e,t){const i=[];if(0===e.length||0===t.length)return[...e,...t];let s=0,r=0;for(;s<=e.length&&r<=t.length;){const n=e[s],o=t[r];n>=o?(s++,i.push(n)):(r++,i.push(o))}return s===e.length&&i.push(...t.slice(r+1)),r===t.length&&i.push(...e.slice(s+1)),i}function q(e,t){let i=0;for(const s of e){const e=s.filter(isFinite);if(0===e.length)continue;const r=e[0]-(t-i);if(r<0)return t-i;if(r<e.length)return e[r];const n=e.length-1;i+=e[0]-e[n]-n}return t-i}function H(e,t){return t-e}function z(e,t,i,s){return t===s[i-1]||e.push(Number(t)),e}class R{constructor(e,t,i){this._container=null,this._listContainer=null,this._dragShield=null,this._viewsList=[],this._bids={},this._asks={},this._indexes=[],this._repaintScheduled=!1,this._currentVolumeMax=0,this._orders={},this._positionIndex=NaN,this._positionQty=0,this._orderGhost=null,this._totalVolumeBid=0,this._totalVolumeAsk=0,this._buyOrdersValue=0,this._sellOrdersValue=0,this._buyOrdersValueInactive=0,this._sellOrdersValueInactive=0,this._buyOrdersQuantity=0,this._sellOrdersQuantity=0,this._offscreenIndexLocation$=new C.Subject,this._cellIndexesInAskZone=[],this._cellIndexesInBidZone=[],this._bestAskIndex=Number.POSITIVE_INFINITY,this._bestBidIndex=Number.NEGATIVE_INFINITY,this._worstBidIndex=Number.POSITIVE_INFINITY,this._worstAskIndex=Number.NEGATIVE_INFINITY,this._isPositionAlreadyUpdated=!1,this._handlers=e||{},this._realtimeProvider=i,this._showPricesWith=t,this.autoCenterRequired=new d.WatchedValue(!1),this.height=0,this.topIndex=NaN,this._symbolData=null,this.indexToPrice=()=>NaN,this.priceToIndex=()=>NaN,this._lastPriceIndex=NaN,this._viewAllocated=new Map,this._viewPool=null,this._invalidatedAsk={},this._invalidatedBid={},this._invalidatedPriceHighlight={},this._invalidatedOrders={},this._dynamicModeState=!1,this._numericFormatter=new O.NumericFormatter,this._showPricesWith.zeroVolume.subscribe(this.centerOnLast.bind(this)),this._showPricesWith.spread.subscribe(this.centerOnLast.bind(this)),this.reset()}reset(){this.topIndex=NaN,this._symbolData=null,this.indexToPrice=()=>NaN,this.priceToIndex=()=>NaN,this._lastPriceIndex=NaN,this.resetData(),this.resetView(),this.resetOrders(),this.resetOrderGhost(),this.resetPosition(),this.autoCenterRequired.setValue(!1)}resetData(){if(this._bids={},this._asks={},this._totalVolumeBid=0,this._totalVolumeAsk=0,this._recalcMaxVolume(),this._recalcBestWorstBid(),this._recalcBestWorstAsk(),this._viewAllocated)for(const[e]of this._viewAllocated)this._invalidatedAsk[e]=!0,this._invalidatedBid[e]=!0;this._offscreenIndexLocation$.next(s.Inside),this.scheduleRepaint()}resetOrders(){if(this._orders)for(const e in this._orders)this._orders.hasOwnProperty(e)&&(this._invalidatedOrders[e]=!0)
;this._orders={},this._buyOrdersValue=0,this._sellOrdersValue=0,this._buyOrdersValueInactive=0,this._sellOrdersValueInactive=0,this._buyOrdersQuantity=0,this._sellOrdersQuantity=0,this.scheduleRepaint()}resetPosition(){this._invalidatedPriceHighlight[this._positionIndex]=!0,this._positionIndex=NaN,this._positionQty=0,this.scheduleRepaint()}resetView(){if(this._viewAllocated&&this._viewPool)for(const[e]of this._viewAllocated){const t=this._viewAllocated.get(e);t&&(t.element.remove(),this._viewPool.free(t),this._viewAllocated.delete(e))}this._listContainer&&(this._viewsList.length=0,this._listContainer.innerHTML=""),this.setDragShield(!1,!1),this.scheduleRepaint()}setSymbolInfo(e){this._symbolData={...e},this.indexToPrice=(0,I.makePriceIndexToPriceConverter)(e.minTick,e.variableMinTickData),this.priceToIndex=(0,I.makePriceToPriceIndexConverter)(e.minTick,e.variableMinTickData),this._isPositionAlreadyUpdated=!1}setContainer(e){if(this._container===e)return;this._container&&(this.resetView(),this._container.innerHTML=""),this._container=e,this._viewPool=new L(this._handlers),this._viewAllocated=new Map;const t=this._listContainer=document.createElement("div");t.className=D["tv-dom-widget-main__anchor"],e.append(t);const i=this._dragShield=document.createElement("div");i.className=`${D["tv-dom-widget-main__drag-shield"]} js-hidden`,e.append(i),this._repaintScheduled=!1,this.scheduleRepaint()}setHeight(e){e!==this.height&&(this.height=e,A&&0!==e&&(this.centerOnLast(),this._isPositionAlreadyUpdated=!1),this.checkAutoCenter(),this.scheduleRepaint())}shiftTopIndexRelativeToIndex(e,t){this._setTopIndex(e+t)}setStopOrderMode(e){let t=this.topIndex;this._canIndexBeDisplayed(t)||(t=this.correctIndex(t,-1));const i=this.correctIndex(t,1-this.height);if(!isFinite(i))return;const s=this._viewAllocated;for(const[,t]of s)t&&t.setStopOrderMode(e)}correctIndex(e,t=0){const i=e+t;if(!this._hasQuotes())return i;const s=this._showPricesWith.zeroVolume.value(),r=this._showPricesWith.spread.value();return s&&r?i:s&&!r?q([[this._bestAskIndex,this._bestBidIndex]],i):!s&&r?q([this._cellIndexesInAskZone,this._cellIndexesInBidZone],i):s||r?i:q([(new Array).concat(this._cellIndexesInAskZone,this._cellIndexesInBidZone)],i)}centerOnLast(){this.autoCenterRequired.setValue(!1);const e=this._autoCenterTargetTopIndex();isFinite(e)&&this._setTopIndex(e)}guessOrderType(e,t){const i=this.priceToIndex(e);if(!isFinite(e))return null;if(1!==t&&-1!==t)return null;let s=this._bestAskIndex,r=this._bestBidIndex;return isFinite(s)||(s=r+1),isFinite(r)||(r=s-1),isFinite(s)||isFinite(r)||(s=r=this._lastPriceIndex),1===t?i&&i<s?1:3:i&&i>r?1:3}updateData(e){this._indexes.forEach((e=>{isFinite(this._asks[e])||delete this._asks[e],isFinite(this._bids[e])||delete this._bids[e]}));let t=!1;e.snapshot&&(t=A?this._hasStaticDOMRequiredData()&&!this._isPositionAlreadyUpdated:!this._showPricesWith.zeroVolume.value()&&!this._showPricesWith.spread.value(),this.resetData());let i=!1;if(e.bids)for(let t=0;t<e.bids.length;t++){const s=(0,
c.ensureDefined)(e.bids[t]),r=this.priceToIndex(s.price),n=s.volume,o=this._bids[r]||null;o!==n&&(i=!0,n>0?(this._totalVolumeBid+=n-Number(o),this._bids[r]=n):(this._totalVolumeBid-=Number(o),delete this._bids[r]),this._invalidatedBid[r]=!0)}if(e.asks)for(let t=0;t<e.asks.length;t++){const s=(0,c.ensureDefined)(e.asks[t]),r=this.priceToIndex(s.price),n=s.volume,o=this._asks[r]||null;o!==n&&(i=!0,n>0?(this._totalVolumeAsk+=n-Number(o),this._asks[r]=n):(this._totalVolumeAsk-=Number(o),delete this._asks[r]),this._invalidatedAsk[r]=!0)}if(this._collectIndexes(),!this._hasDataInDOM()){if(i=!0,0!==e.bids.length){const t=this.priceToIndex(e.bids[0].price);this._bids[t]=Number.POSITIVE_INFINITY}if(0!==e.asks.length){const t=this.priceToIndex(e.asks[0].price);this._asks[t]=Number.POSITIVE_INFINITY}this._collectIndexes()}i&&this._recalcDepthInfo(),this._recalcMaxVolume(),t?(this.centerOnLast(),this._isPositionAlreadyUpdated=!0):this.checkAutoCenter(),this._dynamicModeState&&this.centerOnLast(),this.scheduleRepaint()}totalVolumeBid(){return this._totalVolumeBid}totalVolumeAsk(){return this._totalVolumeAsk}buyOrdersValue(){return this._buyOrdersValue}sellOrdersValue(){return this._sellOrdersValue}buyInactiveOrdersValue(){return this._buyOrdersValueInactive}sellInactiveOrdersValue(){return this._sellOrdersValueInactive}buyOrdersQuantity(){return this._numericFormatter.format(this._buyOrdersQuantity)}sellOrdersQuantity(){return this._numericFormatter.format(this._sellOrdersQuantity)}updateOrders(e){this.resetOrders();for(let t=0;t<e.length;t++){const i=e[t],s=6===i.status;if(1===i.side?(this._buyOrdersValue+=Number(s),this._buyOrdersValueInactive+=Number(!s),this._buyOrdersQuantity=s?new(p())(this._buyOrdersQuantity).plus(i.qty).toNumber():0):(this._sellOrdersValue+=Number(s),this._sellOrdersValueInactive+=Number(!s),this._sellOrdersQuantity=s?new(p())(this._sellOrdersQuantity).plus(i.qty).toNumber():0),i.stopPrice){const e=this.priceToIndex(i.stopPrice);this._orders[e]||(this._orders[e]=[]),this._orders[e].push({order:i,pricePropertyName:"stopPrice"}),this._invalidatedOrders[e]=!0}if(void 0!==i.limitPrice){const e=this.priceToIndex(i.limitPrice);this._orders[e]||(this._orders[e]=[]),this._orders[e].push({order:i,pricePropertyName:"limitPrice"}),this._invalidatedOrders[e]=!0}}this._recalcDepthInfo(),this.scheduleRepaint()}updateLast(e){const t=this.priceToIndex(e);t!==this._lastPriceIndex&&(this._invalidatedPriceHighlight[this._lastPriceIndex]=!0,this._invalidatedPriceHighlight[t]=!0,this._lastPriceIndex=t,this.checkAutoCenter(),this.scheduleRepaint())}updatePosition(e){if(void 0===e||0===e.qty)return void this.resetPosition();const t=this.priceToIndex(e.avgPrice),i=Math.abs(e.qty)*(1===e.side?1:-1);this._positionIndex===t&&this._positionQty===i||(this._invalidatedPriceHighlight[this._positionIndex]=!0,this._invalidatedPriceHighlight[t]=!0,this._positionIndex=t,this._positionQty=i,this.scheduleRepaint())}resetOrderGhost(){this._orderGhost&&(this._invalidatedOrders[this._orderGhost.index]=!0,
this._invalidatedOrders[this._orderGhost.originIndex]=!0,this._orderGhost=null,this.scheduleRepaint())}setOrderGhost(e){const{order:t,pricePropertyName:i,price:s}=e;this.resetOrderGhost();const r=this.priceToIndex(s);isFinite(r)&&(this._orderGhost={ghost:!0,order:t,pricePropertyName:i,price:s,index:r,originIndex:this.priceToIndex(t[i])},this._invalidatedOrders[r]=!0,this.scheduleRepaint())}setDragShield(e,t){this._dragShield&&(this._dragShield.classList.toggle("js-hidden",!e),this._dragShield.classList.toggle(D["tv-dom-widget-main__drag-shield--order"],t))}scheduleRepaint(){this._repaintScheduled||this._symbolData&&(requestAnimationFrame((()=>this.repaint())),this._repaintScheduled=!0)}formatVolume(e){return null===this._symbolData?String(e):this._symbolData.volumeFormatter.format(e)}repaint(){if(this._repaintScheduled=!1,!this._listContainer)return;if(null===this._viewPool)return;const e=this.topIndex,t=this.correctIndex(e,1-this.height);if(isFinite(t)){for(;this._viewsList.length<this.height;){const e=this._viewPool.allocate();this._listContainer.append(e.element),this._viewsList.push(e)}for(;this._viewsList.length>this.height;){const e=(0,c.ensureDefined)(this._viewsList.pop());e.element.remove(),this._viewPool.free(e)}this._oldViewAllocated=this._viewAllocated,this._viewAllocated=new Map;for(let t=0;t<this._viewsList.length;t++){const i=this.correctIndex(e,-t),s=this._viewsList[t];this._viewAllocated.set(i,s),this._updateRow(i)}this._updateOffscreenIndexLocation(this._lastPriceIndex,e,t);for(const e in this._invalidatedBid)this._invalidatedBid.hasOwnProperty(e)&&delete this._invalidatedBid[e];for(const e in this._invalidatedAsk)this._invalidatedAsk.hasOwnProperty(e)&&delete this._invalidatedAsk[e];for(const e in this._invalidatedPriceHighlight)this._invalidatedPriceHighlight.hasOwnProperty(e)&&delete this._invalidatedPriceHighlight[e];for(const e in this._invalidatedOrders)this._invalidatedOrders.hasOwnProperty(e)&&delete this._invalidatedOrders[e]}}typePrice(e){return e>=this._bestAskIndex?"ask":e<=this._bestBidIndex?"bid":void 0}toggleDynamicModeState(){return this._dynamicModeState=!this._dynamicModeState,this._dynamicModeState}getDynamicModeState(){return this._dynamicModeState}checkAutoCenter(){isFinite(this.topIndex)||this.centerOnLast();const e=this.topIndex,t=this.correctIndex(this.topIndex,1-this.height);let i;i=isFinite(this._bestBidIndex)?this._bestBidIndex:isFinite(this._bestAskIndex)?this._bestAskIndex:isFinite(this._lastPriceIndex)?this._lastPriceIndex:NaN;let s=NaN;isFinite(this._bestAskIndex)?s=this._bestAskIndex:isFinite(this._bestBidIndex)?s=this._bestBidIndex:isFinite(this._lastPriceIndex)&&(i=this._lastPriceIndex);let r=!1;(s+3>e||i-3<t)&&(this.topIndex===this._autoCenterTargetTopIndex()||A||(r=!0)),this.autoCenterRequired.setValue(r)}isSpread(e){return this._bestAskIndex>e&&e>this._bestBidIndex}getOffscreenIndexLocationObservable(){return this._offscreenIndexLocation$.asObservable()}_hasDataInDOM(){return 0!==this._indexes.length}_updateOffscreenIndexLocation(e,t,i){
isFinite(this._lastPriceIndex)&&(e>t?this._offscreenIndexLocation$.next(s.Higher):e<i?this._offscreenIndexLocation$.next(s.Lower):this._offscreenIndexLocation$.next(s.Inside))}_hasStaticDOMRequiredData(){return 0!==this.height&&isFinite(this.topIndex)&&null!==this._symbolData&&isFinite(this._lastPriceIndex)}_hasQuotes(){return this._indexes.length>1}_collectIndexes(){this._indexes=Object.keys(Object.assign({},this._asks,this._bids))}_recalcDepthInfo(){const e=Object.keys(this._asks).reduce(z,[]).sort(H),t=Object.keys(this._bids).reduce(z,[]).sort(H),i=Object.keys(this._orders).reduce(z,[]).sort(H);this._worstAskIndex=e[0],this._bestAskIndex=e[e.length-1],this._bestBidIndex=t[0],this._worstBidIndex=t[t.length-1];const s=[],r=[];for(const e of i)e<=this._worstAskIndex&&e>=this._bestAskIndex&&void 0===this._asks[e]&&s.push(e),e<=this._bestBidIndex&&e>=this._worstBidIndex&&void 0===this._bids[e]&&r.push(e);this._cellIndexesInAskZone=$(e,s),this._cellIndexesInBidZone=$(t,r)}_updateRow(e){if(!this._symbolData)return;const t=this._oldViewAllocated,s=this._viewAllocated;let r=s.get(e);this._viewPool&&!r&&(r=this._viewPool.allocate(),s.set(e,r));const o=this._orderGhost;if(t&&t.get(e)!==s.get(e)){const t=this.indexToPrice(e);r.updatePrice(t),r.updatePriceText(this._symbolData.priceFormatter.format(t))}r.paintPrice(this.typePrice(e)),this._asks[e]&&this._asks[e]!==Number.POSITIVE_INFINITY?r.updateAskVolume(this.formatVolume(this._asks[e])):r.updateAskVolume(""),r.updateAskLabels(e<this._bestAskIndex),this._bids[e]&&this._bids[e]!==Number.POSITIVE_INFINITY?r.updateBidVolume(this.formatVolume(this._bids[e])):r.updateBidVolume(""),r.setHigherThanBid(e>this._bestBidIndex),r.updateAskMeter(this._asks[e]===Number.POSITIVE_INFINITY?100:this._asks[e]/this._currentVolumeMax||0),r.updateBidMeter(this._bids[e]===Number.POSITIVE_INFINITY?100:this._bids[e]/this._currentVolumeMax||0);const a=e===this._lastPriceIndex,l=e===this._positionIndex?this._positionQty:0;r.updatePriceHighlight(a,l);let d,c,u=this._orders[e]||[];null!==o&&(o.index===e&&(o.originIndex!==e?u=u.concat(o):c=o.order.id),o.index!==e&&o.originIndex!==e||(d=o.order.side));const h=this._realtimeProvider.activeBroker()?.metainfo().configFlags;for(let e=0;e<u.length;e++){const t=u[e],s=t.order,r=s.filledQty||0;switch(t.inactive=6!==s.status||4===s.type&&"limitPrice"===t.pricePropertyName,t.isModifiable=void 0!==h&&(0,v.isModifyOrderSupported)(s,h),t.isMovable=void 0!==h&&(0,v.isMoveOrderSupported)(s,h),t.isCancellable=!0,s.type){case 2:t.typeText=n.t(null,void 0,i(490138)),t.type="market";break;case 1:t.typeText=s.parentId?n.t(null,void 0,i(486933)):n.t(null,void 0,i(790258)),t.type="limit";break;case 3:t.typeText=s.parentId?n.t(null,void 0,i(426497)):n.t(null,{context:"order"},i(679953)),t.type="stop";break;case 4:t.typeText=n.t(null,void 0,i(264073)),t.type="stoplimit";break;default:t.typeText=""}t.qty=this._symbolData.quantityFormatter.format(s.qty-r),t.buy=1===s.side,t.noCollapse=s.side===d,
t.highlighted=null!==o&&void 0!==c&&s.id===c&&o.pricePropertyName===t.pricePropertyName}r.updateOrders(u)}_setTopIndex(e){e!==this.topIndex&&(this.topIndex=e,this.checkAutoCenter()),this.scheduleRepaint()}_canIndexBeDisplayed(e){const t=this._showPricesWith.zeroVolume.value(),i=this._showPricesWith.spread.value();if(t&&!this.isSpread(e))return!0;if(i&&this.isSpread(e))return!0;const s=e===this._lastPriceIndex,r=e===this._positionIndex,n=this._bids.hasOwnProperty(e)||this._asks.hasOwnProperty(e),o=e<=this._worstBidIndex||this._worstAskIndex<=e,a=this._orders[e]||[],l=this._orderGhost&&this._orderGhost.index===e;return r||s||l||o||n||0!==a.length}_getGapMiddleIndex(){let e=this._bestAskIndex,t=this._bestBidIndex;return isFinite(e)||(e=t),isFinite(t)||(t=e),Math.floor((t+e)/2)}_autoCenterTargetTopIndex(){const e=Math.floor(this.height/2);return this._showPricesWith.zeroVolume.value()&&this._showPricesWith.spread.value()?this._getCenterIndex()+e:this._getCorrectCenterIndex()+e}_getCorrectCenterIndex(){const e=this._getCenterIndex(),t=this._bestAskIndex??e,i=this._worstAskIndex??e;let s=e;if(!this._showPricesWith.zeroVolume.value()){s=e+i-t-1-(this._cellIndexesInAskZone.length-1>=0?this._cellIndexesInAskZone.length-1:0)+1}return this._showPricesWith.spread.value()||(s+=t-e),s}_getCenterIndex(){const e=this._getGapMiddleIndex();return isFinite(e)?e:isFinite(this._bestBidIndex)?this._bestBidIndex:isFinite(this._bestAskIndex)?this._bestAskIndex:isFinite(this._lastPriceIndex)?this._lastPriceIndex:NaN}_recalcMaxVolume(){let e=0;for(const t in this._asks)this._asks.hasOwnProperty(t)&&(e=Math.max(this._asks[t],e));for(const t in this._bids)this._bids.hasOwnProperty(t)&&(e=Math.max(this._bids[t],e));e!==this._currentVolumeMax&&(this._currentVolumeMax=e)}_recalcBestWorstBid(){let e=Number.NEGATIVE_INFINITY,t=Number.POSITIVE_INFINITY;for(const i in this._bids)this._bids.hasOwnProperty(i)&&(+i>e&&(e=+i),+i<t&&(t=+i));this._bestBidIndex=e,this._worstBidIndex=t}_recalcBestWorstAsk(){let e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY;for(const i in this._asks)this._asks.hasOwnProperty(i)&&(+i<e&&(e=+i),+i>t&&(t=+i));this._bestAskIndex=e,this._worstAskIndex=t}}var W,K=i(218286),U=i(894862);!function(e){e[e.Percentage=0]="Percentage",e[e.Pips=1]="Pips",e[e.Currency=2]="Currency"}(W||(W={}));class G{constructor(e,t){this._symbolData=null,this._calculatePLUsingLast=!1,this._hasLotSize=new d.WatchedValue(!1),this._plState$=new C.Subject,this._positionState$=new C.Subject,this._pipValueType=null,this.changePLViewType=()=>{switch(this._displayProfitState){case 2:this._displayProfitState=1;break;case 0:this._displayProfitState=2;break;case 1:this._displayProfitState=0}u.setValue(f.settingsKeys.PROFIT_VIEW_TYPE,this._displayProfitState),this.updatePL()},this.compareQty=()=>{const e=Math.abs(Number(this._position?.qty));e>0&&isFinite(e)&&this.qty.setValue(e)},this._updatePipValueType=e=>{this._pipValueType=e},this.defaultPLState={plText:null,tradeDirection:null,plTooltipText:n.t(null,void 0,i(74966))},this.defaultPositionState={
positionText:null,side:null},this.plState$=this._plState$.pipe((0,K.distinctUntilChanged)(((e,t)=>e.plText===t.plText&&e.tradeDirection===t.tradeDirection&&e.plTooltipText===t.plTooltipText))),this.positionState$=this._positionState$.pipe((0,K.distinctUntilChanged)(((e,t)=>e.positionText===t.positionText&&e.side===t.side))),this._handlers=e||{},t.subscribe(this._updatePipValueType),this._displayProfitState=u.getJSON(f.settingsKeys.PROFIT_VIEW_TYPE,2),this.reset(),this._integerFormatter=new O.NumericFormatter({precision:0}),this._oneDecimalFormatter=new O.NumericFormatter({precision:1}),this._twoDecimalFormatter=new O.NumericFormatter({precision:2}),this.qty=new d.WatchedValue(1),this.qty.subscribe((e=>this._handlers.qtyChange.call(null,e))),this._qtyProperties=new d.WatchedValue({min:1,step:1,max:1})}reset(){this._position=void 0,this._pl=void 0,this._lastPrice=void 0,this._bid=void 0,this._ask=void 0,this._symbolData=null,this._updatePositionState(this.defaultPositionState),this._updatePLState(this.defaultPLState)}setBrokerConfigFlags(e){this._calculatePLUsingLast=e.calculatePLUsingLast}setSymbolInfo(e){const{qtyProperties:t,units:i}=e;this._symbolData=e,this._qtyProperties.setValue({...t,units:i})}getQtyProperties(){return this._qtyProperties}updatePosition(e){if(this._position=e,void 0===this._position||0===this._position.qty||null===this._symbolData)return void this._updatePositionState(this.defaultPositionState);const{qty:t,avgPrice:i,side:s}=this._position,r=this._symbolData.priceFormatter.format(i),n=Math.abs(t),o=this._symbolData.volumeFormatter.format(n);this._updatePositionState({positionText:`${o} @ ${r}`,side:s})}updatePL(e){if(void 0!==e&&(this._pl=e),void 0===this._position)return void this._updatePLState(this.defaultPLState);const{side:t,avgPrice:i}=this._position,s=-1===t,r=this._calculatePLUsingLast?this._lastPrice:s?this._ask:this._bid;if(void 0===r){if(void 0===this._pl||2!==this._displayProfitState)this._updatePLState(this.defaultPLState);else{const e=this._pl>=0?1:2;this._updatePLState({plText:this._makePlText(),tradeDirection:e,plTooltipText:this._makePlTooltipText()})}return}const n=(r-i)*(s?-1:1),o=n>0?1:2;switch(this._displayProfitState){case 0:{const e=this._calculatePLPercentage(i,n);this._updatePLState({plText:e,tradeDirection:o,plTooltipText:this._makePlTooltipText()});break}case 1:{const e=this._makePipsText(n);this._updatePLState({plText:e,tradeDirection:o,plTooltipText:this._makePlTooltipText()});break}case 2:this._updatePLState({plText:this._makePlText(),tradeDirection:o,plTooltipText:this._makePlTooltipText()})}}updateLast(e,t,i){this._lastPrice=e,this._bid=t,this._ask=i,this.updatePL()}bid(){return this._bid}ask(){return this._ask}setHasLotSize(e){this._hasLotSize.setValue(e)}hasLotSize(){return this._hasLotSize.readonly()}_calculatePLPercentage(e,t){const i=t/e;return isFinite(i)?this._twoDecimalFormatter.format(100*i)+"%":null}_makePipsText(e){if(null===this._symbolData)return null
;const{pipSize:t,minTick:s}=this._symbolData,r=isFinite(t)&&t!==s?this._oneDecimalFormatter:this._integerFormatter,o=parseFloat(r.format(e/(t||s)));if(!isFinite(o))return null;switch(this._pipValueType){case U.PipValueType.Pips:return n.t(null,{plural:"{pips} pips",count:Math.abs(o),replace:{pips:String(o)}},i(161156));case U.PipValueType.Ticks:return n.t(null,{plural:"{ticks} ticks",count:Math.abs(o),replace:{ticks:String(o)}},i(800338));default:return null}}_makePlText(){if(void 0===this._pl)return null;const e=this._twoDecimalFormatter.format(this._pl);return void 0!==this._symbolData?.positionCurrency?`${e} ${this._symbolData.positionCurrency}`:e}_makePlTooltipText(){switch(this._displayProfitState){case 2:return this._pipValueType===U.PipValueType.Pips?n.t(null,void 0,i(370639)):n.t(null,void 0,i(679308));case 0:return this._symbolData?.positionCurrency?n.t(null,{replace:{currency:this._symbolData.positionCurrency}},i(357428)):this.defaultPLState.plTooltipText;case 1:return n.t(null,void 0,i(496469));default:return this.defaultPLState.plTooltipText}}_updatePositionState(e){this._positionState$.next(e)}_updatePLState(e){this._plState$.next(e)}}class Q{constructor(e,t,i){this._expiresAt=0,this._delay=e,this._doneCb=t,this._progressCb=i}run(){if(this._timeoutId)return;const e=Date.now?Date.now():+new Date;this._expiresAt=e+this._delay,this._timeoutId=window.setTimeout((()=>{this.abort(),this._doneCb()}),this._delay),this._trackProgressScheduled||this._trackProgress()}revert(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=void 0,this.run())}abort(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=void 0,this._expiresAt=0,this._progressCb&&this._progressCb(0))}setWindow(e){this._wnd=e}_trackProgress(){if(this._trackProgressScheduled=!1,!this._progressCb||!this._timeoutId)return;const e=Date.now?Date.now():+new Date;let t=1-(this._expiresAt-e)/this._delay;t=Math.max(Math.min(t,1),0),this._progressCb(t),this._wnd&&this._wnd.requestAnimationFrame?this._wnd.requestAnimationFrame((()=>{this._trackProgress()})):window.setTimeout((()=>{this._trackProgress()}),40),this._trackProgressScheduled=!0}}var Z=i(586639),Y=i(627692),j=i(958607);class J{constructor(){this._currentValuesSummaryLine$=new _.BehaviorSubject(""),this._isVisible$=new _.BehaviorSubject(!1),this._isOpen$=new _.BehaviorSubject(!1),this._durationError$=new _.BehaviorSubject({res:!1}),this._onCustomFieldsUpdate=new Y.Delegate,this._customFieldsViewModelSubscription=void 0,this.setDurationError=e=>{this._durationError$.next(e)},this._rewriteDisplayedSelectedItems=()=>{const e=this.customFieldsViewModel?.getCustomFieldsModels().flatMap((e=>{switch(e.type){case"Checkbox":return e.getChecked()?e.title:[];case"ComboBox":return e.getSelectedItem()??[];default:return[]}}))??[],t=this._getCurrentDurationName();void 0!==t&&e.push(t);const i=e.join(", ");this._currentValuesSummaryLine$.next(i)},this._updateVisibility=()=>{this._isVisible$.next(this._hasDuration()||this._hasCustomFields())},
this.currentValuesSummaryLine$=this._currentValuesSummaryLine$.asObservable(),this.isOpen$=this._isOpen$.asObservable(),this.durationError$=this._durationError$.asObservable(),this._updateVisibility()}setCustomFields(e){this._createCustomFieldsViewModel(e),this._rewriteDisplayedSelectedItems(),this._updateVisibility(),this._onCustomFieldsUpdate.fire()}setDurationsInfo(e,t){void 0!==t&&(this._durationsMetaInfo=t),this._currentDuration=e,this._rewriteDisplayedSelectedItems(),this._updateVisibility()}isVisible(){return this._isVisible$.getValue()}setIsOpen(e){this._isOpen$.next(e)}_getCurrentDurationName(){const e=this._currentDuration?.type,t=this._durationsMetaInfo?.find((t=>t.value===e));return t?.name}_hasDuration(){return void 0!==this._currentDuration}_hasCustomFields(){return void 0!==this.customFieldsViewModel&&0!==Object.keys(this.customFieldsViewModel.getCustomFieldsInputValues()).length}_createCustomFieldsViewModel(e){void 0!==this.customFieldsViewModel&&(this.customFieldsViewModel.unsubscribe(),this._customFieldsViewModelSubscription?.unsubscribe()),this.customFieldsViewModel=new j.CustomFieldsViewModel({existingOrder:!1,customFields:e,initialInputState:void 0,orderType$:(0,Z.of)(null),initialOrderType:null}),this.customFieldsViewModel.subscribe(),this._customFieldsViewModelSubscription=this.customFieldsViewModel.customFieldsInputValues$.subscribe((()=>{this._rewriteDisplayedSelectedItems(),this._updateVisibility()}))}}var X=i(661851),ee=i(383778),te=i(878112),ie=i(930202),se=i(497754),re=i.n(se),ne=i(297265),oe=i(14699),ae=i(657947);function le(e){const{currentDuration:t,durationMetaInfoList:i,onDurationChanged:s,showErrorMessages:r,error:n,onError:o}=e;return a.createElement(ae.DurationControl,{currentDuration:t,durationMetaInfoList:i,onDurationChanged:s,showErrorMessages:r,error:n,onError:o})}var de=i(471886),ce=i(488263),ue=i(611902);function he(e){const{domDetails:t,onDurationChanged:s,onDurationError:r}=e,o=t.customFieldsViewModel?.getCustomFieldsModels()||[],l=(0,X.useObservable)(t.isOpen$),d=(0,ne.useWatchedValueReadonly)({watchedValue:e.currentDuration}),c=(0,ne.useWatchedValueReadonly)({watchedValue:e.durationMetaInfoList}),u=(0,X.useObservable)(t.currentValuesSummaryLine$),h=(0,X.useObservable)(t.durationError$,{res:!1});return a.createElement(a.Fragment,null,a.createElement("div",{className:de.headerWrapper},a.createElement("div",{className:de.header,tabIndex:0,onKeyDown:e=>{const i=(0,ie.hashFromEvent)(e);13!==i&&32!==i||t.setIsOpen(!l)},onClick:()=>t.setIsOpen(!l)},a.createElement("div",{className:se(de.textBlock,de.summaryLine)},a.createElement("span",null,n.t(null,void 0,i(278892)))," ",a.createElement("span",{className:se(de.tifValue)},u)),a.createElement("div",{className:de.arrow},a.createElement(te.Icon,{icon:l?ce:ue})))),l&&a.createElement("div",{className:de.details},a.createElement(oe.CustomFields,{customFieldModels:o,isWait:!1,forceUserToSelectValue:!1}),a.createElement("div",{className:de.duration},void 0!==d&&void 0!==c&&a.createElement(le,{currentDuration:d,durationMetaInfoList:c,
onDurationChanged:s,error:h,showErrorMessages:!0,onError:r}))))}var me=i(595943),pe=i(972535),_e=i(228837),ge=i(229144),ve=i(901317),be=i(729354),ye=i(240134);function we(e){const{calcData:t}=e,i=(0,a.useRef)(null),[s,r]=(0,ve.useWatchedValue)(t.qty),n=(0,ne.useWatchedValueReadonly)({watchedValue:t.getQtyProperties()}),o=(0,ne.useWatchedValueReadonly)({watchedValue:t.hasLotSize()});return a.createElement(a.Fragment,null,a.createElement("div",{ref:i,className:ye.errorsContainer}),a.createElement("div",{className:ye.wrapper},a.createElement(be.QuantityInput,{id:"dom-quantity-input",dataQaId:"qty-dom",qty:s,quantityMetainfo:n,onValueChange:r,hideLabel:!0,hasLotSize:o,button:a.createElement(a.Fragment,null),className:ye.qty,customErrorsAttachment:{target:i.current}})))}var fe=i(896009),Se=i(877254);const ke=e=>a.createElement(a.Fragment,null,a.createElement("span",{className:Se.hotKeyTitle},e.title),a.createElement("span",null,e.keyboardKeys.map((e=>a.createElement(fe.HotkeyBox,{key:e,keyboardKey:e})))));var xe=i(470116);const Te=n.t(null,void 0,i(231234)),Pe=n.t(null,void 0,i(442687));function Ie(e){const{uiPlaceOrder:t,calcData:s}=e,r=a.createElement(ke,{title:n.t(null,void 0,i(248463)),keyboardKeys:["Shift","B"]}),o=a.createElement(ke,{title:n.t(null,void 0,i(554663)),keyboardKeys:["Shift","S"]});return a.createElement("div",{className:se(xe.row,xe.wrapper,xe.marketBlock)},a.createElement(me.Tooltip,{content:r,isRtl:(0,ge.isRtl)(),trigger:pe.mobiletouch?[me.Trigger.Focus]:[me.Trigger.Hover,me.Trigger.Focus]},a.createElement(_e.SquareButton,{size:"xsmall",color:"blue",variant:"primary",className:se(xe.button),onClick:e=>{e.preventDefault(),t({type:2,side:1})},"data-qa-id":"buy-market-dom"},Te)),a.createElement(we,{calcData:s}),a.createElement(me.Tooltip,{content:o,isRtl:(0,ge.isRtl)(),trigger:pe.mobiletouch?[me.Trigger.Focus]:[me.Trigger.Hover,me.Trigger.Focus]},a.createElement(_e.SquareButton,{size:"xsmall",color:"red",variant:"primary",className:se(xe.button),onClick:e=>{e.preventDefault(),t({type:2,side:-1})},"data-qa-id":"sell-market-dom"},Pe)))}var Ce=i(812467);const Oe=n.t(null,void 0,i(267539));function Ee(e){const{plState$:t,positionState$:i,defaultPLState:s,defaultPositionState:r,changePLViewType:n,compareQty:o}=e,{plText:l,plTooltipText:d,tradeDirection:c}=(0,X.useObservable)(t,s),{positionText:u,side:h}=(0,X.useObservable)(i,r),m=null===u,p=se(Ce.button,!m&&1===c&&Ce.profit,!m&&2===c&&Ce.loss),_=se(Ce.button,!m&&1===h&&Ce.buy,!m&&-1===h&&Ce.sell);return a.createElement("div",{className:Ce.wrapper},a.createElement(me.Tooltip,{isRtl:(0,ge.isRtl)(),content:Oe,trigger:pe.mobiletouch?[me.Trigger.Focus]:[me.Trigger.Hover,me.Trigger.Focus]},a.createElement(_e.SquareButton,{className:_,"aria-disabled":m,onClick:m?void 0:o,size:"xsmall",color:"gray",variant:"secondary","data-qa-id":"position-DOM"},u??"")),a.createElement(me.Tooltip,{isRtl:(0,ge.isRtl)(),content:d,trigger:pe.mobiletouch?[me.Trigger.Focus]:[me.Trigger.Hover,me.Trigger.Focus]},a.createElement(_e.SquareButton,{className:p,"aria-disabled":m,
onClick:m?void 0:n,size:"xsmall",color:"gray",variant:"secondary","data-qa-id":"switch-pl-view"},l??"")))}const Me=n.t(null,void 0,i(795379)),De=n.t(null,void 0,i(745769)),Be=n.t(null,void 0,i(364489)),Le=n.t(null,void 0,i(714747)),Ve=n.t(null,void 0,i(410844)),Ne=n.t(null,void 0,i(244948));function Fe(e){const t=e.isPositionBlocked||!e.isTradable||!e.hasPosition||!e.hasFlatten,i=!e.isTradable||!(e.hasBuyOrders||e.hasSellOrders),s=e.isPositionBlocked||!e.isTradable||!e.hasPosition||!e.hasReverse,r=(0,a.useCallback)((i=>{t||(i.preventDefault(),e.uiClosePosition())}),[t,e.uiClosePosition]),n=(0,a.useCallback)((t=>{i||(t.preventDefault(),e.uiCancelAllOrders())}),[i,e.uiCancelAllOrders]),o=(0,a.useCallback)((t=>{s||(t.preventDefault(),e.uiReversePosition())}),[s,e.uiReversePosition]);return a.createElement("div",{className:se(xe.row,xe.wrapper,xe.tradingActionBlock)},a.createElement(me.Tooltip,{content:Ve,isRtl:(0,ge.isRtl)(),trigger:pe.mobiletouch?[me.Trigger.Focus]:[me.Trigger.Hover,me.Trigger.Focus]},a.createElement(_e.SquareButton,{"aria-disabled":t,size:"xsmall",color:"gray",variant:"secondary",className:xe.button,onClick:r,tabIndex:t?-1:0,"data-qa-id":"flatten"},De)),a.createElement(me.Tooltip,{content:Le,isRtl:(0,ge.isRtl)(),trigger:pe.mobiletouch?[me.Trigger.Focus]:[me.Trigger.Hover,me.Trigger.Focus]},a.createElement(_e.SquareButton,{"aria-disabled":i,size:"xsmall",color:"gray",variant:"secondary",className:xe.button,onClick:n,tabIndex:i?-1:0,"data-qa-id":"cancel-all-orders-dom"},Me)),a.createElement(me.Tooltip,{content:Ne,isRtl:(0,ge.isRtl)(),trigger:pe.mobiletouch?[me.Trigger.Focus]:[me.Trigger.Hover,me.Trigger.Focus]},a.createElement(_e.SquareButton,{"aria-disabled":s,size:"xsmall",color:"gray",variant:"secondary",className:xe.button,onClick:o,tabIndex:s?-1:0,"data-qa-id":"reverse"},Be)))}var Ae=i(578891);function $e(e){const{uiState$:t,warningMessage$:i,domDetailsDropdownProps:s,domMarketActionBlockProps:r,tradingActionBlockControllers:n,domCalcBlockProps:o}=e,l=(0,X.useObservable)(t,{isTradable:!1,isPositionBlocked:!1,hasPosition:!1,hasBuyOrders:!1,hasSellOrders:!1,qty:1,gtcOrder:!1,hasFlatten:!1,hasReverse:!1}),d=[];return l.isTradable&&d.push({id:"symbol-specific-warning",warningMessageSource:l.symbolSpecificWarningMessage}),a.createElement("div",{className:Ae.container},a.createElement(Ee,{...o}),a.createElement(Fe,{...n,...l}),a.createElement(Ie,{...r}),l.isTradable&&s.domDetails.isVisible()&&a.createElement(he,{...s}),a.createElement(ee.TradingPanelWarningInformersContainer,{warningInformersItems:d}))}var qe=i(898237),He=i(669331),ze=i(11728);function Re(e){const{isLoading:t,onClick:i,buttonTitle:s,volume:r,countedVolumeTitle:n,side:o,disabled:l,dataQaId:d}=e;return a.createElement("div",{className:re()(He.cancelOrders,-1===o&&He.reversed)},a.createElement(me.Tooltip,{content:s,isRtl:(0,ge.isRtl)(),trigger:pe.mobiletouch?[me.Trigger.Focus]:[me.Trigger.Hover,me.Trigger.Focus]},a.createElement(qe.LightButton,{iconOnly:!0,"data-qa-id":d,startSlot:a.createElement(te.Icon,{icon:ze}),variant:"quiet-primary",
size:"xsmall",className:He.cancelButton,onClick:i,disabled:t||l,tabIndex:0})),""!==r&&void 0!==r&&a.createElement("span",{className:re()(He.countedVolume,Boolean(n)&&"apply-common-tooltip"),title:n},r))}i(47103);var We=i(102464);const Ke=a.createElement(ke,{title:n.t(null,void 0,i(678046)),keyboardKeys:[(0,ie.humanReadableModifiers)(ie.Modifiers.Shift,!1),(0,ie.humanReadableModifiers)(ie.Modifiers.Alt,!1),"C"]});function Ue(e){const{isLoading:t,onClick:i,trackEvent:s}=e;return a.createElement("div",{style:{position:"relative"}},a.createElement(me.Tooltip,{content:Ke,isRtl:(0,ge.isRtl)(),trigger:pe.mobiletouch?[me.Trigger.Focus]:[me.Trigger.Hover,me.Trigger.Focus]},a.createElement(qe.LightButton,{iconOnly:!0,"data-qa-id":"data-centering-DOM",startSlot:a.createElement(te.Icon,{icon:We}),variant:"quiet-primary",size:"xsmall",onClick:()=>{i(),s("Center DOM data")}})),!1)}const Ge=e=>{let t="M 0 0";return e>0&&(e>=1?t="M 0 -1":t+="L 0 -1",e>.5&&(t+="A 1 1 0 0 1 0 1"),t+="A 1 1 0 0 1 "+Math.sin(2*e*Math.PI)+" "+-Math.cos(2*e*Math.PI)+"Z"),t};var Qe=i(498121);function Ze(e){const{className:t,timer:i}=e,[s,r]=(0,a.useState)({d:"M 0,0"});return(0,a.useLayoutEffect)((()=>{i((e=>{r({d:Ge(e||0)})}))}),[]),a.createElement("svg",{className:re()(Qe.timer,t),viewBox:"-1 -1 2 2",width:"2",height:"2"},a.createElement("path",{...s}))}var Ye=i(231139);const je={on:i(781957),off:i(943145)};function Je(e){const{onClick:t,toggleDynamicModeState:s,trackEvent:r,timer:o}=e,[l,d]=(0,a.useState)({icon:je.off,title:n.t(null,void 0,i(167785))});return a.createElement("div",{className:Ye.switchModeButton},a.createElement(Ze,{timer:o,className:Ye.timer}),a.createElement(me.Tooltip,{isRtl:(0,ge.isRtl)(),content:l.title,trigger:pe.mobiletouch?[me.Trigger.Focus]:[me.Trigger.Hover,me.Trigger.Focus]},a.createElement(qe.LightButton,{iconOnly:!0,"data-qa-id":"switch-mode-DOM",startSlot:a.createElement(te.Icon,{icon:l.icon}),variant:"quiet-primary",size:"xsmall",onClick:()=>{const e=s();d((e=>e?{icon:je.on,title:n.t(null,void 0,i(413264))}:{icon:je.off,title:n.t(null,void 0,i(167785))})(e)),t(),r(e?"Enable dynamic mode":"Disable dynamic mode")}})))}var Xe=i(678641);function et(e){const{isLoading:t,onClick:s,isStaticDOMEnabled:r,toggleDynamicModeState:o,trackEvent:l,timer:d,totalVolumeAsk:c,totalVolumeBid:u}=e;return a.createElement("div",{className:Xe.centeringContainer},a.createElement("div",{className:re()(Xe.volume,Xe.bid)},a.createElement("span",{title:n.t(null,void 0,i(662627)),className:"apply-common-tooltip"},u)),r?a.createElement(Ue,{isLoading:t,onClick:s,trackEvent:l}):a.createElement(Je,{toggleDynamicModeState:o,isLoading:t,onClick:s,trackEvent:l,timer:d}),a.createElement("div",{className:re()(Xe.volume,Xe.ask)},a.createElement("span",{title:n.t(null,void 0,i(867713)),className:"apply-common-tooltip"},c)))}var tt=i(790891);function it(e){const{isLoading:t,uiState$:s,onCenteringButtonClick:r,isStaticDOMEnabled:o,toggleDynamicModeState:l,trackEvent:d,timer:c,cancelOrders:u,cancelOrdersState$:h}=e,m=(0,ne.useWatchedValueReadonly)({watchedValue:t
}),p=(0,X.useObservable)(s),_=(0,X.useObservable)(h,{cancelBuyOrdersDisabled:!0,cancelSellOrdersDisabled:!0});return a.createElement("div",{className:tt.domControls},a.createElement(Re,{isLoading:m,buttonTitle:n.t(null,void 0,i(195133)),dataQaId:"cancel-all-buy-orders",onClick:()=>u(1),side:1,countedVolumeTitle:_?.countedVolumeBuyTitle,volume:_?.countedVolumeBuy,disabled:_.cancelBuyOrdersDisabled}),a.createElement(et,{isStaticDOMEnabled:o,isLoading:m,onClick:r,totalVolumeAsk:p?.totalVolumeAsk,totalVolumeBid:p?.totalVolumeBid,toggleDynamicModeState:l,trackEvent:d,timer:c}),a.createElement(Re,{isLoading:m,buttonTitle:n.t(null,void 0,i(193212)),dataQaId:"cancel-all-sell-orders",onClick:()=>u(-1),side:-1,countedVolumeTitle:_?.countedVolumeSellTitle,volume:_?.countedVolumeSell,disabled:_.cancelSellOrdersDisabled}))}var st=i(615344),rt=i(220070);const nt=b.enabled("static_dom");function ot(e,t){return`${f.settingsKeys.DOM_DURATION}${e}.${t}`}const at={1:"LIMIT",2:"MARKET",3:"STOP",4:"STOPLIMIT"};function lt(e){return e instanceof MouseEvent?e.pageY:e.touches[0]?.pageY??0}class dt{constructor(e){this.delayedData=new d.WatchedValue(!1),this.isBats=new d.WatchedValue(!1),this._container=null,this._warning=null,this._mainBlock=null,this._subscription=null,this._noDataTimeout=null,this._actionMarketButtons=null,this._actionPositionButtons=null,this._cancelOrdersState$=null,this._currentDuration=new d.WatchedValue,this._durationMetaInfoList=new d.WatchedValue,this._viewTotalVolumeScheduled=!1,this._csxAllTitle=n.t(null,void 0,i(714747)),this._flattenTitle=n.t(null,void 0,i(410844)),this._reverseTitle=n.t(null,void 0,i(244948)),this._handleModKeyStateChange=e=>{const t=(0,h.modifiersFromEvent)(e)===h.Modifiers.Mod;this._content.setStopOrderMode(t)},this._createTimer=e=>(this._timer=new Q(2e3,(()=>{this._content.centerOnLast()}),e),this._timer),this._onDurationChanged=e=>{this._currentDuration.setValue(e),this._domDetails.setDurationsInfo(e);const t=this._realtimeProvider.activeBroker();if(null===t)return;const i=ot(t.metainfo().id,this._tradingLinking.value().symbol);u.setValue(i,e.type)},this._onSuggestedQtyChange=e=>{this._calcData.qty.setValue(e),this._mergeUiState({qty:e})};const{body:t,visible:s,trading:r,qtySuggester:o,tradingLinking:a,headerState:l,isLoading:c}=e;this._headerState=l,this._headerState.setDescription(void 0),this._visible=s,this._symbolData=null,this._isLoading=c,this._supportedOrderTypes=[2],this._domDetails=new J,this._trading=r,this._qtySuggester=o,this._tradingLinking=a,this._realtimeProvider=this._trading.realtimeProvider();const m=this._handlers(),p={zeroVolume:this._trading.showPricesWith().zeroVolume.readonly(),spread:this._trading.showPricesWith().spread.readonly()};this._content=new R(m,p,this._realtimeProvider),this._calcData=new G(m,r.pipValueType()),this._uiState={isTradable:!1,isPositionBlocked:!1,hasPosition:!1,hasBuyOrders:!1,hasSellOrders:!1,qty:1,gtcOrder:!1,hasFlatten:!1,hasReverse:!1},this._upperBlockResizeObserver=new ResizeObserver((e=>{for(const t of e){
const e=Math.ceil(t.target.clientHeight/20);this._content.setHeight(e)}})),this._uiState$=new _.BehaviorSubject(this._uiState),this.isTradable$=this._uiState$.pipe((0,g.map)((({isTradable:e,nonTradableMessage:t})=>({tradable:e,reason:t})))),this._timerLockState={},nt||this._content.autoCenterRequired.subscribe((e=>{this._mergeTimerLockState({autoCenterRequired:e})})),t.subscribe((e=>this._recreateLayout(e)),{callWithLast:!0}),this._tradingLinking.valueObservable().subscribe((({warning:e})=>{this._onStateChange(),this._updateDetails(),this._warningMessage$?.next(e)})),this._realtimeProvider.onStatusChanged.subscribe(null,(()=>{this._onStateChange(),this._updateDetails()})),s.subscribe((()=>{this._onStateChange(),this._warningMessage$?.next(this._warningMessage$.getValue())})),this._onStateChange(),this._updateDetails()}uiScroll(e){this._content.getDynamicModeState()||(this._content.shiftTopIndexRelativeToIndex(this._content.topIndex,0|e),this._timer?.revert())}uiCenter(){this._content.centerOnLast(),this._trackEvent("Center")}uiCancelOrder(e){this._uiState.isTradable&&null!==e&&((0,c.ensureNotNull)(this._trading.brokerCommandsUI()||null).cancelOrder(e),this._trackEvent("Cancel Order"))}uiModifyOrder(e,t=null){if(!e||!this._uiState.isTradable||void 0===this._configFlags||!(0,v.isModifyOrderSupported)(e,this._configFlags))return Promise.resolve();let i=!0;null===t&&(t={},i=!1);const s=(0,c.ensureNotNull)(this._trading.brokerCommandsUI()||null).modifyOrder({...e,...t},i,void 0,!0);return this._lockTimerUntilSettled(s),this._trackEvent("Modify Order"),Promise.resolve()}uiPlaceOrder({side:e,type:t,price:i=NaN,altPrice:s=NaN}){if(!this._realtimeProvider.activeBroker())return void this._trading.toggleTradingWidget().then((()=>{this._trading.onNeedSelectBroker.fire()}));if(!this._subscription?.broker)return void this._trading.toggleTradingWidget();if(2!==t&&!isFinite(i))return;null===t&&(t=this._content.guessOrderType(i,e));let r=!0;if(null===t&&(r=!1,t=1),!this._isOrderTypeSupported(t))return;const n=this._calcData.ask(),o=this._calcData.bid(),a=1===e?n:o,l={symbol:this._tradingLinking.value().symbol,qty:this._calcData.qty.value(),side:e,type:t,seenPrice:a??null,duration:this._currentDuration.value(),customFields:this._domDetails.customFieldsViewModel?.getCustomFieldsInputValues()};void 0!==n&&void 0!==o&&(l.currentQuotes={ask:n,bid:o}),3===l.type&&(l.stopPrice=i),1===l.type&&(l.limitPrice=i),4===l.type&&(l.stopPrice=i,isFinite(s)?l.limitPrice=s:r=!1),this._lockTimerUntilSettled((0,c.ensureNotNull)(this._trading.brokerCommandsUI()||null).placeOrder(l,r,!0));const d=this._content.getDynamicModeState()?"enabled":"disabled";this._trackEvent("Place Order",at[t]),this._trackEvent(`Place Order (dynamic mode ${d})`,at[t])}uiCancelAllOrders(e){const t=this._uiState;if(!t.isTradable||!t.hasBuyOrders&&!t.hasSellOrders||1===e&&!t.hasBuyOrders||-1===e&&!t.hasSellOrders)return Promise.resolve();const i=(0,c.ensureNotNull)(this._trading.brokerCommandsUI()||null).cancelOrders(this._tradingLinking.value().symbol,e)
;return this._lockTimerUntilSettled(i),e?this._trackEvent("Cancel All "+(1===e?"Buy":"Sell")+" Orders"):this._trackEvent("Cancel All Orders"),Promise.resolve()}async uiClosePosition(){if(this._uiState.isPositionBlocked||!this._uiState.isTradable||!this._uiState.hasPosition||!this._uiState.hasFlatten)return;const e=this._realtimeProvider.activeBroker();if(!e)return;this._mergeUiState({isPositionBlocked:!0});const t=e.positions(this._tradingLinking.value().symbol).then((e=>{for(const t of e)if(0!==t.qty)return(0,c.ensureNotNull)(this._trading.brokerCommandsUI()).closePosition(t.id);return Promise.resolve(!1)})).finally((()=>this._mergeUiState({isPositionBlocked:!1})));this._lockTimerUntilSettled(t),this._trackEvent("Close Position")}async uiReversePosition(){if(this._uiState.isPositionBlocked||!this._uiState.isTradable||!this._uiState.hasPosition||!this._uiState.hasReverse)return;const e=this._realtimeProvider.activeBroker();if(!e)return;this._mergeUiState({isPositionBlocked:!0});const t=e.positions(this._tradingLinking.value().symbol).then((e=>{for(const t of e)if(0!==t.qty)return(0,c.ensureNotNull)(this._trading.brokerCommandsUI()).reversePosition(t.id);return Promise.resolve(!1)})).finally((()=>this._mergeUiState({isPositionBlocked:!1})));this._lockTimerUntilSettled(t),this._trackEvent("Reverse")}uiOrderMousedown(e,t,i){if(1!==e.buttons||null===t||null===this._mainBlock||null===this._subscription)return;this.uiStopOrderDrag();const s=t[i],r=this._subscription;let n=NaN;r.orderMouseRoot=document.documentElement,r.orderMousemoveHandler=e=>{if(e.preventDefault(),1!==(e.buttons||e.which)||void 0===this._configFlags||!(0,v.isMoveOrderSupported)(t,this._configFlags))return void this.uiStopOrderDrag();const s=(0,c.ensureNotNull)(this._mainBlock).getBoundingClientRect().y,r=lt(e)-s,o=-Math.floor(r/20),a=this._content.correctIndex(this._content.topIndex,o);n=this._content.indexToPrice(a),this._content.setDragShield(!0,!0),this._mergeTimerLockState({drag:!0}),this._content.setOrderGhost({order:t,pricePropertyName:i,price:n})},r.orderMouseupHandler=()=>{this.uiStopOrderDrag();this._realtimeProvider.activeBroker()&&isFinite(n)&&n!==s&&(this._content.setOrderGhost({order:t,pricePropertyName:i,price:n}),this._content.setDragShield(!0,!0),this._trackEvent("Move Order"),this.uiModifyOrder(t,{[i]:n}).then((()=>this.uiStopOrderDrag())).catch((()=>this.uiStopOrderDrag())))},r.orderMousedownHandler=()=>{this.uiStopOrderDrag()},r.orderMouseRoot.addEventListener("mousemove",r.orderMousemoveHandler),r.orderMouseRoot.addEventListener("mouseup",r.orderMouseupHandler),setTimeout((()=>{const{orderMouseRoot:e,orderMousedownHandler:t}=r;e&&t&&e.addEventListener("mousedown",t)}),0)}uiStopOrderDrag(){if(this._content.setDragShield(!1,!1),this._content.resetOrderGhost(),this._mergeTimerLockState({drag:!1}),!this._subscription)return;const{orderMousemoveHandler:e,orderMouseupHandler:t,orderMousedownHandler:i,orderMouseRoot:s}=this._subscription;delete this._subscription.orderMousemoveHandler,delete this._subscription.orderMouseupHandler,
delete this._subscription.orderMousedownHandler,delete this._subscription.orderMouseRoot,s&&e&&s.removeEventListener("mousemove",e),s&&t&&s.removeEventListener("mouseup",t),s&&i&&s.removeEventListener("mousedown",i)}uiContextMenu(e,t,s){if(!this._uiState.isTradable)return;if(1!==t&&-1!==t)return;const r=this._uiState.qty||NaN,o=(0,v.safeSplitSymbol)(this._tradingLinking.value().symbol)[1],a=(0,x.abbreviatedNumber)(r),l=[],d=this._symbolData?.priceFormatter||new S.PriceFormatter;if(this._trackEvent("Context Menu"),isFinite(s)){const e=d.format(s);if(this._isOrderTypeSupported(3)){const r={stopPrice:e,qty:a,symbol:o};let d="";d=1===t?n.t(null,{replace:r},i(175275)):n.t(null,{replace:r},i(87480));const c=new T.Action({actionId:"Trading.DOMPlaceStopOrder",options:{label:d,onExecute:()=>{this.uiPlaceOrder({side:t,price:s,type:3})}}});l.push(c)}if(this._isOrderTypeSupported(1)){const r={limitPrice:e,qty:a,symbol:o};let d="";d=1===t?n.t(null,{replace:r},i(454127)):n.t(null,{replace:r},i(998267));const c=new T.Action({actionId:"Trading.DOMPlaceLimitOrder",options:{label:d,onExecute:()=>{this.uiPlaceOrder({side:t,price:s,type:1})}}});l.push(c)}if(this._symbolData&&this._isOrderTypeSupported(4)){const r=(0,I.getMinTick)({minTick:this._symbolData.minTick,price:s,variableMinTickData:this._symbolData.variableMinTickData}),c=new(p())(r).mul(1===t?1:-1).plus(s).toNumber(),u={stopPrice:e,limitPrice:d.format(c),qty:a,symbol:o};let h="";h=1===t?n.t(null,{replace:u},i(374717)):n.t(null,{replace:u},i(628431));const m=new T.Action({actionId:"Trading.DOMPlaceStopLimitOrder",options:{label:h,onExecute:()=>{this.uiPlaceOrder({side:t,price:s,altPrice:c,type:4})}}});l.push(m)}}if(this._isOrderTypeSupported(2)){const e={qty:a,symbol:o};let s="";s=1===t?n.t(null,{replace:e},i(548866)):n.t(null,{replace:e},i(193012));const r=new T.Action({actionId:"Trading.DOMPlaceMarketOrder",options:{label:s,onExecute:()=>{this.uiPlaceOrder({side:t,type:2})}}});l.push(r)}l.length&&P.ContextMenuManager.showMenu(l,e,void 0,{menuName:"DOMWidgetContextMenu"})}_recreateLayout(e){null!==this._container&&(this._container.innerHTML="");const t=document.createElement("div"),r=document.createElement("div");this._upperBlockResizeObserver.disconnect(),this._upperBlockResizeObserver.observe(t),t.classList.add(rt.upperBlock),r.classList.add(rt.bottomBlock),this._container=e;const n=function(e){const t=document.createElement("span"),r=document.createElement("span");return t.className=`${D["tv-dom-widget-main__offscreen-arrow"]} ${D["tv-dom-widget-main__offscreen-arrow--higher"]} js-hidden`,r.className=`${D["tv-dom-widget-main__offscreen-arrow"]} ${D["tv-dom-widget-main__offscreen-arrow--lower"]} js-hidden`,t.innerHTML=i(355482),r.innerHTML=i(482075),e.append(t),e.append(r),e=>{t.classList.toggle("js-hidden",e!==s.Higher),r.classList.toggle("js-hidden",e!==s.Lower)}}(t);this._content.getOffscreenIndexLocationObservable().subscribe(n),this._createMainBlock(t),this._createControlsBlock(r),this._createDOMBottomWidget(r),this._container.append(t),this._container.append(r),
this._calcData.reset()}_createMainBlock(e){const t=document.createElement("div");t.className=D["tv-dom-widget-main"],e.append(t);const s=this._warning=document.createElement("div");s.className=`${st["tv-dom-panel__warning"]} i-hidden`,s.textContent=n.t(null,void 0,i(212938)),t.append(s),this._content.setContainer(t);let r=0;t.addEventListener("wheel",(e=>{if(!this._content.getDynamicModeState()&&(e.deltaMode!==e.DOM_DELTA_PAGE?r-=(0,y.getPixelsFromEvent)(e).y/100:r-=(0,w.clamp)(e.deltaY,-1,1),Math.abs(r)>=1)){const e=r%1;this.uiScroll(r-e),r=e}}));let o=!1;const a=e=>{if(o)return;const t="touches"in e;if(!t&&1!==(e.buttons||e.which))return;const i=this._content.topIndex;if(!isFinite(i))return;if(t&&1!==e.touches.length)return;if(!(e.target instanceof Element))return;if(!e.target.closest(`.${D["tv-dom-widget-main__value--price"]}`))return;o=!0;const s=lt(e),r=document.documentElement,n=()=>{["mouseup","mousedown","touchend","touchstart","touchcancel"].forEach((e=>r.removeEventListener(e,n))),r.removeEventListener("mousemove",a),r.removeEventListener("touchmove",a),o=!1,this._content.setDragShield(!1,!1),this._mergeTimerLockState({scroll:!1})},a=e=>{if(!this._content.getDynamicModeState()){if(!t&&1!==(e.buttons||e.which))return void n();const r=lt(e)-s,o=Math.round(r/20);o&&(this._content.setDragShield(!0,!1),this._mergeTimerLockState({scroll:!0})),this._content.shiftTopIndexRelativeToIndex(i,o)}};r.addEventListener(t?"touchmove":"mousemove",a),r.addEventListener(t?"touchend":"mouseup",n),t&&r.addEventListener("touchcancel",n),setTimeout((()=>{o&&r.addEventListener(t?"touchstart":"mousedown",n)}),0)};t.addEventListener("mousedown",a),t.addEventListener("touchstart",a),t.addEventListener("dblclick",(e=>{if(!(e.target instanceof Element))return;e.target.closest(`.${D["tv-dom-widget-main__value--price"]}`)&&this.uiCenter()})),this._mainBlock=t}_createDOMBottomWidget(e){const t=document.createElement("div");e.append(t);const i={domDetails:this._domDetails,currentDuration:this._currentDuration,durationMetaInfoList:this._durationMetaInfoList,onDurationChanged:this._onDurationChanged,onDurationError:this._domDetails.setDurationError},s={uiPlaceOrder:e=>this.uiPlaceOrder(e),calcData:this._calcData},r={uiClosePosition:()=>this.uiClosePosition(),uiCancelAllOrders:()=>this.uiCancelAllOrders(),uiReversePosition:()=>this.uiReversePosition()},n={plState$:this._calcData.plState$,positionState$:this._calcData.positionState$,defaultPLState:this._calcData.defaultPLState,defaultPositionState:this._calcData.defaultPositionState,changePLViewType:this._calcData.changePLViewType,compareQty:this._calcData.compareQty};!function(e,t){o.render(a.createElement($e,{...t}),e)}(t,{uiState$:this._uiState$.asObservable(),warningMessage$:this._warningMessage$?.asObservable(),tradingActionBlockControllers:r,domDetailsDropdownProps:i,domMarketActionBlockProps:s,domCalcBlockProps:n})}_createControlsBlock(e){const t=document.createElement("div"),{isTradable:i,hasBuyOrders:s,hasSellOrders:r}=this._uiState;this._cancelOrdersState$=new _.BehaviorSubject({
cancelBuyOrdersDisabled:!i||!s,cancelSellOrdersDisabled:!i||!r}),this._updateValueBuySellOrders(),function(e){const{container:t,props:i}=e;o.render(a.createElement(it,{...i}),t)}({container:t,props:{isLoading:this._isLoading,cancelOrdersState$:this._cancelOrdersState$.asObservable(),uiState$:this._uiState$.asObservable(),cancelOrders:e=>this.uiCancelAllOrders(e),onCenteringButtonClick:()=>this.uiCenter(),trackEvent:e=>this._trackEvent(e),toggleDynamicModeState:()=>this._content.toggleDynamicModeState(),isStaticDOMEnabled:nt,timer:this._createTimer}}),e.append(t)}_showNoDataNotice(){}_hideNoDataNotice(){}_syncActionButtons(){const{isPositionBlocked:e,isTradable:t,hasPosition:i,hasBuyOrders:s,hasSellOrders:r,hasFlatten:n,hasReverse:o}=this._uiState;if(this._actionPositionButtons&&this._actionMarketButtons){const a={...this._actionPositionButtons,...this._actionMarketButtons},l="i-disabled";a.flatten.disabled=e||!t||!i||!n,a.reverse.disabled=e||!t||!i||!o,a.clear.disabled=!t||!(s||r),a.flatten.title=this._flattenTitle,a.reverse.title=this._reverseTitle,a.clear.title=this._csxAllTitle;const d=this._isOrderTypeSupported(2);a.buyMarket.classList.toggle(l,!d),a.sellMarket.classList.toggle(l,!d)}this._cancelOrdersState$&&this._mergeCancelOrdersState({cancelBuyOrdersDisabled:!t||!s,cancelSellOrdersDisabled:!t||!r})}_mergeUiState(e){const t=this._uiState;let i,s=!1;for(i in e)t[i]!==e[i]&&(t[i]=e[i],s=!0);s&&(this._uiState$.next({...t}),this._headerState.setIsTradable(t.isTradable),this._syncActionButtons())}_handlers(){return{closeButtonClick:(e,t)=>{e.preventDefault(),this.uiCancelOrder(t&&t.id)},qtyClick:(e,t)=>{e.preventDefault(),this.uiModifyOrder(t)},bidAskClick:(e,{side:t,price:i,type:s})=>{e.preventDefault(),this.uiPlaceOrder({side:t,price:i,type:s||null})},bidAskContextMenu:(e,{side:t,price:i})=>{e.preventDefault(),this.uiContextMenu(e,t,i)},qtyChange:e=>{!isFinite(e)||e<0||(this._qtySuggester.setQty(this._tradingLinking.value().symbol,e),this._mergeUiState({qty:e}))},qtyInput:e=>{!isFinite(e)||e<0||this._mergeUiState({qty:e})},orderMousedown:(e,{order:t,pricePropertyName:i})=>{this.uiOrderMousedown(e,t,i)}}}_mergeTimerLockState(e){if(void 0===this._timer)return;const t=this._timerLockState;let i,s=!1;for(i in e)t[i]!==e[i]&&(t[i]=e[i],s=!0);s&&(!t.autoCenterRequired||t.scroll||t.drag||t.dialog?this._timer.abort():this._timer.run())}_lockTimerUntilSettled(e){if(!e)return;this._mergeTimerLockState({dialog:e});const t=()=>{this._timerLockState?.dialog===e&&this._mergeTimerLockState({dialog:null})};e.then(t,t)}async _getSymbolData(e){const t=this._realtimeProvider.activeBroker(),[i,s,[r,n,o],a]=await Promise.all([this._realtimeProvider.symbolInfo(e),this._realtimeProvider.quantityFormatter(e),this._realtimeProvider.isTradable(e).then((async({tradable:i,reason:s})=>[i,s,i?await(t?.getPositionCurrency(e)):void 0])),t?.formatter(e,!0)]),l=a??await this._realtimeProvider.formatter(e),d=Math.max(0,Math.ceil(-Math.log10(i.qty.step))),c=new k.VolumeFormatter({precision:d});return{brokerSymbol:i.brokerSymbol?(0,
v.getSymbolNameOverFullname)(i.brokerSymbol):(0,v.getSymbolNameOverFullname)(e),minTick:i.minTick,pipSize:i.pipSize,priceFormatter:l,volumeFormatter:c,quantityFormatter:s,qtyProperties:i.qty,lotSize:i.lotSize,isTradable:r,nonTradableMessage:n,positionCurrency:o,variableMinTickData:i.variableMinTick?(0,I.makeVariableMinTickData)(i.minTick,i.variableMinTick):void 0,units:i.units}}_unsubscribeData(){if(!this._subscription)return;const{broker:e,symbol:t,domHandler:i,realtimeHandler:s,orderHandler:r,positionHandler:n,plHandler:o,plPositionId:a,fullUpdateOrders:l,fullUpdatePosition:d}=this._subscription;this._subscription=null,t&&s&&this._realtimeProvider.unsubscribeRealtime(t,s),t&&i&&this._realtimeProvider.unsubscribeDOM(t,i),e&&r&&e.orderUpdate.unsubscribe(null,r),e&&n&&e.positionUpdate.unsubscribe(null,n),e&&o&&a&&e.unsubscribePL(a,o),e&&l&&e.currentAccountUpdate.unsubscribe(null,l),e&&d&&e.currentAccountUpdate.unsubscribe(null,d),this._suggestedQtySubscription?.unsubscribe()}_trackEvent(e,t){this._trading.trackEvent("DOM",e,t)}_processOrders(e){const t=[];let i=!1,s=!1;for(let r=0;r<e.length;r++){const n=e[r];if(4===n.status||3===n.status||6===n.status)switch(t.push(n),n.side){case 1:i=!0;break;case-1:s=!0}}this._content.updateOrders(t),this._updateValueBuySellOrders(),this._mergeUiState({hasBuyOrders:i,hasSellOrders:s})}_processPositions(e,t,i){const s=i.find((e=>0!==e.qty));this._mergeUiState({hasPosition:!!s}),void 0!==s&&s.id===t.plPositionId||t.plPositionId&&t.plHandler&&e.unsubscribePL&&(e.unsubscribePL(t.plPositionId,t.plHandler),delete t.plPositionId,t.plHandler=null),void 0===s||t.plPositionId===s.id&&t.plHandler||(t.plHandler=(e,i)=>{this._subscription===t&&this._calcData.updatePL(i)},t.plPositionId=s.id,e.subscribePL(t.plPositionId,t.plHandler)),this._content.updatePosition(s),this._calcData.updatePosition(s),this._calcData.updatePL()}_updateDurationMetainfo(e,t,i){const s=e?.metainfo().durations;if(this._durationMetaInfoList.setValue(void 0!==s?(0,v.filterDurationsBySymbolDurations)(s,i):void 0),null===e||void 0===this._durationMetaInfoList.value())return;const r=ot(e.metainfo().id,t),n=u.getValue(r),o=void 0!==n?this._makeOrderDuration(n):this._makeDefaultOrderDuration();this._currentDuration.setValue(o),void 0!==o&&this._domDetails.setDurationsInfo(o,this._durationMetaInfoList.value())}_makeDefaultOrderDuration(){const e=this._durationMetaInfoList.value();if(void 0===e||0===e.length)return;const t=e.find((e=>!0===e.default))||e[0];return(0,v.makeOrderDuration)(t)}_makeOrderDuration(e){const t=this._durationMetaInfoList.value()?.find((t=>t.value===e));return void 0!==t?(0,v.makeOrderDuration)(t):void 0}async _onStateChange(){const{symbol:e}=this._tradingLinking.value(),t=this._realtimeProvider.activeBroker(),i=t?.metainfo().configFlags.calculatePLUsingLast;if(!this._visible.value())return void this._unsubscribeData();this._noDataTimeout&&clearTimeout(this._noDataTimeout),this._noDataTimeout=setTimeout((()=>{this._warning?.classList.remove("i-hidden")}),3e3),this._headerState.setTitle((0,
v.safeSplitSymbol)(this._tradingLinking.value().symbol)[1]),this._headerState.setSymbol(e),this._headerState.setBrokerId(t?.metainfo().id),this._headerState.setAccountType(t?.currentAccountType()),this._headerState.setBrokerLogo({logo:t?.metainfo().logoMiniUrl,logoBlack:t?.metainfo().logoMiniBlackUrl}),this._headerState.setBrokerName(t?.metainfo().title),this._symbolData=null,this._unsubscribeData(),this._content.reset(),this._calcData.setBrokerConfigFlags({calculatePLUsingLast:!0===i}),this._calcData.reset();const s=null===t||t?.metainfo().configFlags.supportDOM;this._configFlags=t?.metainfo().configFlags,this._mergeUiState({isTradable:!1,hasPosition:!1,hasBuyOrders:!1,hasSellOrders:!1,qty:void 0,hasFlatten:null!==t&&!t.metainfo().configFlags.supportMultiposition}),this._mergeTimerLockState({scroll:!1,drag:!1,dialog:null}),this.uiStopOrderDrag();let r=[],n=[];if(!e)return;const o=await this._getSymbolData(e),a=o.isTradable,l=o.nonTradableMessage;if(this._calcData.setHasLotSize(void 0!==o.lotSize),!o)return;if(this._symbolData=o,this._content.setSymbolInfo(o),this._calcData.setSymbolInfo(o),this._headerState.setTitle((0,v.safeSplitSymbol)(o.brokerSymbol??e)[1]),this._headerState.setBrokerName(t?.metainfo().title),!s)return;const d={broker:t,symbol:e,domHandler:null,realtimeHandler:null,orderHandler:null,positionHandler:null,plHandler:null,plPositionId:void 0,fullUpdateOrders:null,fullUpdatePosition:null};this._subscription=d;const c=await this._qtySuggester.getQty(e);if(this._onSuggestedQtyChange(c),this._suggestedQtySubscription=this._qtySuggester.suggestedQtyChanged(e).subscribe(this._onSuggestedQtyChange),this._subscription!==d)return;this.isBats.setValue(!1),d.realtimeHandler=(e,t)=>{const i=t.trade||t.bid||t.ask;i&&this._noDataTimeout&&(this._warning?.classList.add("i-hidden"),clearTimeout(this._noDataTimeout),this._noDataTimeout=null),this._content.updateLast(i||NaN),this._calcData.updateLast(t.trade||NaN,t.bid||NaN,t.ask||NaN),this.delayedData.setValue(Boolean(t.isDelayed)),this._headerState.setHasDelayedQuotes(Boolean(t.isDelayed)),this._headerState.setHasBatsQuotes((0,v.isBatsQuotes)(t)),!this.isBats.value()&&(0,v.isBatsQuotes)(t)&&this.isBats.setValue(!0)},d.domHandler=(e,t)=>{this._content.updateData(t),this._scheduleUpdateViewTotalVolume()};const u=a?await(t?.getSymbolSpecificTradingOptions(e)):void 0;this._updateDurationMetainfo(t,e,u?.allowedDurations),this._mergeUiState({isTradable:a,nonTradableMessage:l,symbolSpecificWarningMessage:u?.warningMessage,hasReverse:u?.supportReversePosition}),this._realtimeProvider.subscribeRealtime(e,d.realtimeHandler),this._realtimeProvider.subscribeDOM(e,d.domHandler),this._supportedOrderTypes=this._getSupportedOrderTypes(t,u?.allowedOrderTypes),this._isOrderTypeSupported(3)?(document.addEventListener("keydown",this._handleModKeyStateChange,!1),document.addEventListener("keyup",this._handleModKeyStateChange,!1)):(document.removeEventListener("keydown",this._handleModKeyStateChange),document.removeEventListener("keyup",this._handleModKeyStateChange)),
t&&a&&(d.orderHandler=e=>{if(e.symbol!==d.symbol)return;const t=r.findIndex((t=>t.id===e.id));-1!==t?r[t]=e:r.push(e),this._processOrders(r)},d.positionHandler=e=>{if(e.symbol!==d.symbol)return;const i=n.findIndex((t=>t.id===e.id));-1!==i?n[i]=e:n.push(e),this._processPositions(t,d,n)},d.fullUpdateOrders=()=>{const i=t.orders(e);d.orderPromise=i,i.then((e=>{this._subscription===d&&d.orderPromise===i&&(r=e,this._processOrders(e))}))},d.fullUpdatePosition=()=>{const i=t.positions(e);d.positionPromise=i,i.then((e=>{this._subscription===d&&d.positionPromise===i&&(n=e,this._processPositions(t,d,e))}))},t.orderUpdate.subscribe(null,d.orderHandler),t.positionUpdate.subscribe(null,d.positionHandler),t.currentAccountUpdate.subscribe(null,d.fullUpdateOrders),t.currentAccountUpdate.subscribe(null,d.fullUpdatePosition),d.fullUpdateOrders(),d.fullUpdatePosition()),this._updateViewTotalVolume(),this._updateValueBuySellOrders()}async _updateDetails(){const e=await(this._realtimeProvider.activeBroker()?.getOrderDialogOptions(this._tradingLinking.value().symbol)),t=e?.customFields??[];this._domDetails.setCustomFields(t)}_getSupportedOrderTypes(e,t){const i=[];return null===e||1!==e.connectionStatus()?[2]:(e.metainfo().configFlags.supportMarketOrders&&(0,v.isOrderTypeAllowed)(2,t)&&i.push(2),e.metainfo().configFlags.supportLimitOrders&&(0,v.isOrderTypeAllowed)(1,t)&&i.push(1),e.metainfo().configFlags.supportStopOrders&&(0,v.isOrderTypeAllowed)(3,t)&&i.push(3),e.metainfo().configFlags.supportStopLimitOrders&&(0,v.isOrderTypeAllowed)(4,t)&&i.push(4),i)}_isOrderTypeSupported(e){return-1!==this._supportedOrderTypes.indexOf(e)}_scheduleUpdateViewTotalVolume(){this._viewTotalVolumeScheduled||(this._viewTotalVolumeScheduled=!0,window.requestAnimationFrame((()=>this._updateViewTotalVolume())))}_updateViewTotalVolume(){if(this._viewTotalVolumeScheduled=!1,this._symbolData){const e=this._content.totalVolumeBid(),t=this._content.totalVolumeAsk();this._mergeUiState({totalVolumeAsk:isFinite(t)?this._content.formatVolume(t):"-",totalVolumeBid:isFinite(e)?this._content.formatVolume(e):"-"})}}_mergeCancelOrdersState(e){this._cancelOrdersState$?.next({...this._cancelOrdersState$.value,...e})}_updateValueBuySellOrders(){const e=this._content.buyOrdersValue(),t=this._content.sellOrdersValue(),i=this._content.buyInactiveOrdersValue(),s=this._content.sellInactiveOrdersValue(),r=this._content.buyOrdersQuantity(),n=this._content.sellOrdersQuantity();this._mergeCancelOrdersState({countedVolumeBuy:String(i>0?e:e||""),countedVolumeSell:String(s>0?t:t||""),countedVolumeBuyTitle:0!==e||0!==i?this._setFormattingTextForCountVolume(e,i,+r):"",countedVolumeSellTitle:0!==t||0!==s?this._setFormattingTextForCountVolume(t,s,+n):""})}_setFormattingTextForCountVolume(e,t,s){const r=n.t(null,{plural:"{countOrders} active orders x {countQuantity}",count:e},i(24994)).format({countOrders:String(e),countQuantity:String(s)}),o=n.t(null,{plural:"{countInactiveOrders} inactive orders",count:t},i(304994)).format({countInactiveOrders:String(t)});return r+(t>0?`, ${o}`:"")}}
var ct=i(324889);class ut{constructor(e,t,s,r,c,u){var h;this._container=document.createElement("div"),this.centerDOM=()=>{this._centerDOM?.()},this._syncEnabled=e=>{const t=this._trading.activeBroker();1!==t?.connectionStatus()||t.metainfo().configFlags.supportDOM?!1===e?.tradable&&e.reason?this._showEmptyState({title:n.t(null,void 0,i(645207)),text:e.reason}):this._hideEmptyState():this._showEmptyState({title:n.t(null,void 0,i(904666)),text:n.t(null,void 0,i(984892))})},this._hideEmptyState=()=>{void 0!==this._emptyStateContainer&&(o.unmountComponentAtNode(this._emptyStateContainer),this._emptyStateContainer.remove(),this._emptyStateContainer=void 0,this._emptyStateTextContent=void 0,this._content?.classList.remove("js-hidden"))},this._showEmptyState=e=>{const{title:t,text:i}=e;if(void 0!==this._emptyStateContainer){if(this._emptyStateTextContent===i)return;this._hideEmptyState()}this._content?.classList.add("js-hidden"),this._emptyStateTextContent=i,this._emptyStateContainer=document.createElement("div"),this._emptyStateContainer.classList.add(st["tv-dom-panel__disabled"]),o.render(a.createElement(l.EmptyStateBlock,{iconClass:st.emptyStateImage,title:t,titleSize:"normal",text:i}),this._emptyStateContainer),this._container.appendChild(this._emptyStateContainer)},this._syncVisibility=e=>{e?this._body.append(this._container):this._container.remove()},this._resizerBridge=t,this._widgetBody=new d.WatchedValue,this._visible=new d.WatchedValue(!1),this._trading=e,this._qtySuggester=s,this._tradingLinking=r,this._headerState=c,this._headerState.setSettings((h=e.showPricesWith(),[{settingType:0,label:n.t(null,void 0,i(140229)),value$:(0,ct.makeObservableFromWatchedValue)(h.zeroVolume),onClick:()=>h.zeroVolume.setValue(!h.zeroVolume.value())},{settingType:0,label:n.t(null,void 0,i(843379)),value$:(0,ct.makeObservableFromWatchedValue)(h.spread),onClick:()=>h.spread.setValue(!h.spread.value())}])),this._body=this._resizerBridge.container.value().querySelector(".trading-panel-content"),this._container=document.createElement("div"),this._trading.onConnectionStatusChange.subscribe(null,(()=>this._syncEnabled())),this._syncEnabled(),this._visible.when((()=>{this._resizerBridge.container.subscribe((e=>{this._body=e.querySelector(".trading-panel-content"),this._createLayout(),this._syncEnabled()}),{callWithLast:!0});const e=new dt({body:this._widgetBody,visible:this._visible,trading:this._trading,qtySuggester:this._qtySuggester,tradingLinking:this._tradingLinking,headerState:this._headerState,isLoading:u});this._centerDOM=()=>e.uiCenter(),e.isTradable$.subscribe(this._syncEnabled),this._visible.subscribe(this._syncVisibility)}))}setCloseHandler(e){this._headerState.setCloseFunction(e)}setVisibility(e){this._visible.setValue(e)}_createLayout(){this._container.classList.add(st["tv-dom-panel"]);const e=this._content=document.createElement("div");e.classList.add(st["tv-dom-panel__content"],st.mainblock),this._container.append(e),this._container.addEventListener("contextmenu",(e=>{
e.target instanceof HTMLElement&&e.target.matches("input, textarea")||e.preventDefault()})),this._body.append(this._container),this._widgetBody.setValue(e)}}},657947:(e,t,i)=>{"use strict";i.d(t,{DurationControl:()=>b});var s=i(609838),r=i(50959),n=i(721717),o=i(760775),a=i(472488),l=i(930202),d=i(44807),c=i(508550),u=i(614793),h=i(932443);function m(e){const{initDateTime:t,onDateSelect:i,onTimeSelect:s,onControlFocused:n,hasDatePicker:o,hasTimePicker:a,showErrorMessages:m,revertInvalidData:p,keepFocusOnKeyBoardTimeNavigation:_,error:g,openTimePopupByFocus:v,onError:b}=e;if((0,r.useEffect)((()=>()=>b?.({res:!1})),[]),!o&&!a)return r.createElement(r.Fragment,null);const y=()=>{n?.()};return r.createElement("div",{className:h.dateTimeWrapper,onKeyDown:e=>{13===(0,l.hashFromEvent)(e)&&e.stopPropagation()}},o&&r.createElement(u.DatePicker,{name:"duration-date-input",containerClassName:h.dateInputContainer,className:h.dateInput,initial:t,onPick:e=>{i(e)},onFocus:y,showErrorMessages:m,revertInvalidData:p,showOnFocus:!1,errors:g&&g.res&&g.msg?[g.msg]:void 0}),a&&r.createElement(d.TimeInput,{name:"duration-time-input",value:(w=t,(0,c.twoDigitsFormat)(w.getHours())+":"+(0,c.twoDigitsFormat)(w.getMinutes())),onChange:e=>{s(function(e){const[t,i]=e.split(":"),s=new Date;return s.setHours(Number(t),Number(i)),s}(e))},onFocus:y,showErrorMessages:m,keepFocusOnKeyBoardNavigation:_,openPopupByFocus:v}));var w}var p=i(553238);function _(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes()).getTime()}const g="duration-select-input",v=s.t(null,void 0,i(383870));function b(e){const{currentDuration:t,durationMetaInfoList:l,onDurationChanged:d,onControlFocused:c,showErrorMessages:u,revertInvalidData:h,onError:b,error:y}=e,[w,f]=(0,r.useState)(t.datetime),S=(0,o.findDurationMetaInfo)(l,t.type);(0,r.useEffect)((()=>{if(void 0===c)return;const e=document.getElementById(g);return e?.addEventListener("focus",c),()=>e?.removeEventListener("focus",c)}),[c]);const k=(0,r.useMemo)((()=>y?.res&&void 0!==w?new Date(w):y?.res||void 0===t.datetime?["GTT","GTD"].includes(t.type)?(0,o.makeDatePlus24UTCHours)():new Date:new Date(t.datetime)),[t.datetime,t.type,w,y]);(0,r.useEffect)((()=>{(S?.hasTimePicker&&k.getTime()<=Date.now()||!S?.hasTimePicker&&k.getTime()<(new Date).setHours(0,0,0,0))&&P({type:e.currentDuration.type,datetime:(0,o.makeDatePlus24UTCHours)().getTime()})}),[]);const x=(0,r.useMemo)((()=>l.map((e=>({title:e.name,value:e.value})))),[l]);if(void 0===S)return r.createElement(r.Fragment,null);const T=x.length<2;return r.createElement("div",{className:p.wrapper},r.createElement("div",{className:p.title},r.createElement(a.Label,{htmlFor:g,className:p.label},s.t(null,void 0,i(296344)))),r.createElement(n.Select,{anchorButtonId:g,value:S?.value,items:x,disabled:T,onChange:function(i){const s={type:i},r=(0,o.findDurationMetaInfo)(l,i);void 0!==r&&(r.hasDatePicker||r.hasTimePicker)&&(s.datetime=t.datetime||(0,o.getTimestamp)((0,o.makeDatePlus24UTCHours)()));P(s),void 0!==e.onClose&&e.onClose()},
anchorButtonSize:"small",stretch:!0}),r.createElement(m,{initDateTime:k,hasDatePicker:S.hasDatePicker,hasTimePicker:S.hasTimePicker,onControlFocused:c,onDateSelect:function(t){if(null===t)return void b?.({res:!0});const i=_(t,k);if(f(i),S?.hasTimePicker&&i<=Date.now()||!S?.hasTimePicker&&i<(new Date).setHours(0,0,0,0))return void b?.({res:!0,msg:v});P({type:e.currentDuration.type,datetime:i})},onTimeSelect:function(t){const i=_(k,t);if(f(i),i<=Date.now())return void b?.({res:!0,msg:v});P({type:e.currentDuration.type,datetime:i})},revertInvalidData:h,showErrorMessages:u,onError:b,keepFocusOnKeyBoardTimeNavigation:!0,error:y,openTimePopupByFocus:!1}));function P(e){b?.({res:!1}),d(e)}}},729354:(e,t,i)=>{"use strict";i.d(t,{QuantityInput:()=>p});var s=i(50959),r=i(609838),n=i(463039),o=i(514970);var a=i(587125),l=i(441219),d=i(621363),c=i(209957),u=i(773743),h=i(760775),m=i(116673);function p(e){const{id:t,qty:p,quantityMetainfo:_,onValueChange:g,className:v,customTitle:b,hasLotSize:y,dataQaId:w,onClick:f,inputReference:S,hideLabel:k,button:x,customErrorsAttachment:T,replaceDivider:P}=e,{error:I,errorMessage:C,setError:O,setErrorMessage:E,handleInputError:M}=function(e,t){const[i,r]=(0,s.useState)(!1),[n,a]=(0,s.useState)(void 0),[l,d]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{const{res:i,msg:s}=(0,o.checkQtyError)(t,e,!0),n=l?void 0:s;r(l||i),a(n)}),[e,t,l]),{error:i,errorMessage:n,setError:r,setErrorMessage:a,handleInputError:e=>{d(e)}}}(p,_),D=(0,s.useMemo)((()=>(0,l.numberFormattersParsersChain)({chain:[(0,d.prohibitNanOnParseStep)(),(0,c.decimalNumberMagnitudeStep)({standardNotationOnly:!0}),(0,u.signumStep)({negativeSign:u.longMinusSign})]},{ignoreLocaleNumberFormat:!0,noExponentialForm:!0})),[_]),B=b??(y?r.t(null,void 0,i(833526)):r.t(null,void 0,i(715432)));return s.createElement(s.Fragment,null,s.createElement(n.Label,{className:k&&m.hiddenLabel,htmlFor:t},B),s.createElement(a.NumberInput,{..._,button:x,id:t,className:v,value:(0,h.applyRounding)(p,D),onValueChange:e=>{const{res:t,msg:i}=(0,o.checkQtyError)(_,e,!0);t||g(e),O(t),E(i)},error:I,errorMessage:C,errorHandler:M,onBlur:()=>{O(!1),E(void 0)},onClick:f,inputReference:S,useFormatter:!1,mode:"float",customErrorsAttachment:T,inputMode:"decimal",replaceDivider:P,dataQaId:w}))}},472488:(e,t,i)=>{"use strict";i.d(t,{Label:()=>a});var s=i(50959),r=i(497754),n=i.n(r),o=i(456213);function a(e){const{children:t,className:i,...r}=e;return s.createElement("span",{className:n()(o.wrapper,i)},s.createElement("label",{...r,className:o.label},t))}},383778:(e,t,i)=>{"use strict";i.d(t,{TradingPanelWarningInformersContainer:()=>m});var s=i(50959),r=i(209185),n=i(586639),o=i(609838),a=i(918460);const l=e=>{const[t,i]=(0,s.useState)(e);return[t,(0,s.useCallback)((()=>i(!1)),[]),(0,s.useCallback)((()=>i(!0)),[])]};var d=i(661851),c=i(74968);function u(e){const{warningMessageSource:t,isCloseButtonShown:u=!0}=e,[h,m]=(0,s.useState)(),[p,_,g]=l(!0),v=(0,s.useCallback)((e=>{m(e),g()}),[]),b=(0,s.useMemo)((()=>(0,r.isObservable)(t)?t:(0,n.of)(t)),[t]);return(0,
d.useObservableSubscription)(b,v),p&&void 0!==h&&""!==h?s.createElement(a.Informer,{content:h,header:o.t(null,void 0,i(392298)),informerIntent:"warning",isCloseButtonShown:u,className:c.informer,onCloseClick:_}):s.createElement(s.Fragment,null)}var h=i(21923);function m(e){const{warningInformersItems:t}=e;return 0===t.length?s.createElement(s.Fragment,null):s.createElement("div",{className:h.wrapper},t.map((e=>s.createElement(u,{key:e.id,...e}))))}},662941:(e,t,i)=>{"use strict";i.d(t,{EmptyStateBlock:()=>l});var s=i(50959),r=i(497754),n=i.n(r),o=i(695864);function a(e){const{title:t,tagName:i,titleSize:r,className:a}=e,l=i||"strong";return s.createElement(l,{className:n()(o.title,o[`title_${r}`],a)},t)}const l=(0,s.forwardRef)((function(e,t){return s.createElement("div",{className:r(o.container,e.className),ref:t},s.createElement("div",{className:r(o.icon,e.iconClass)},e.icon),e.title&&s.createElement(a,{title:e.title,titleSize:e.titleSize,tagName:e.titleTagName,className:e.titleClass}),e.text&&s.createElement("div",{className:r(o.text,"large"===e.textSize&&o.text_large,e.textClass)},e.text),e.action&&s.createElement("div",{className:o.action},e.action))}))},901317:(e,t,i)=>{"use strict";i.d(t,{useWatchedValue:()=>r});var s=i(50959);const r=(e,t=[])=>{const[i,r]=(0,s.useState)(e.value());return(0,s.useEffect)((()=>{const t=e=>r(e);return e.subscribe(t),()=>e.unsubscribe(t)}),[e,...t]),[i,t=>e.setValue(t)]}},181436:(e,t,i)=>{"use strict";i.d(t,{getPixelsFromEvent:()=>r});const s=[()=>navigator.userAgent.includes("Win")&&navigator.userAgent.includes("Chrome")?1/window.devicePixelRatio:1,()=>16,(e=()=>0)=>.8*(e()??0)];function r(e,t=()=>({})){return{x:e.deltaX*s[e.deltaMode]((()=>t().width)),y:e.deltaY*s[e.deltaMode]((()=>t().height))}}},209185:(e,t,i)=>{"use strict";i.d(t,{isObservable:()=>n});var s=i(26722),r=i(38323);function n(e){return!!e&&(e instanceof s.Observable||(0,r.isFunction)(e.lift)&&(0,r.isFunction)(e.subscribe))}},842865:(e,t,i)=>{"use strict";i.d(t,{TradingInformer:()=>n});var s=i(50959);i(632227),i(661851);const r=s.lazy((async()=>({default:(await Promise.all([i.e(442),i.e(9978),i.e(4010)]).then(i.bind(i,421848))).TradingInformerImpl})));function n(e){return s.createElement(s.Suspense,{fallback:null},s.createElement(r,{...e}))}},102464:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.578 9.5A5.446 5.446 0 008.5 14.422V16h1v-1.578A5.446 5.446 0 0014.422 9.5H16v-1h-1.578A5.446 5.446 0 009.5 3.578V2h-1v1.578A5.446 5.446 0 003.578 8.5H2v1h1.578zM8.5 6V4.583A4.446 4.446 0 004.583 8.5H6v1H4.583A4.446 4.446 0 008.5 13.417V12h1v1.417A4.446 4.446 0 0013.417 9.5H12v-1h1.417A4.446 4.446 0 009.5 4.583V6h-1z"/></svg>'},499084:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm4-9.97L11.9 6 8.3 9.82 6.1 7.46 4.99 8.5 8.32 12 13 7.03Z"/></svg>'},530162:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"/></svg>'},527941:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm1-12a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM8.5 9.5H7V8h3v6H8.5V9.5Z"/></svg>'},611902:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path stroke="currentcolor" stroke-linecap="round" d="M4 7l5 4 5-4"/></svg>'},488263:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path stroke="currentcolor" stroke-linecap="round" d="M4 11l5-4 5 4"/></svg>'},11728:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 9 9" width="9" height="9"><path stroke="currentcolor" stroke-width="1.2" d="M1 1l7 7m0-7L1 8"/></svg>'},781957:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17" width="16" height="17" fill="none"><rect width="15" height="9" stroke="currentcolor" rx="2.5" x=".5" y="7.5"/><circle stroke="currentcolor" cx="8" cy="12" r=".5"/><path stroke="currentcolor" d="M3.5 7c0 .28.22.5.5.5h8a.5.5 0 0 0 .5-.5V5a4.5 4.5 0 1 0-9 0v2z"/></svg>'},943145:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17" width="16" height="17" fill="none"><path fill="currentcolor" fill-rule="evenodd" clip-rule="evenodd" d="M4 5v2h9a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V5a5 5 0 0 1 8.66-3.4l-.74.66A3.99 3.99 0 0 0 4 5z"/><rect width="15" height="9" stroke="currentcolor" rx="2.5" x=".5" y="7.5"/><circle stroke="currentcolor" cx="8" cy="12" r=".5"/></svg>'},482075:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 7" width="12" height="7"><path d="M1 0a1 1 0 0 0-1 1c0 .276.1.538.28.72l5 5c.182.18.444.28.72.28.276 0 .538-.1.72-.28l5-5c.18-.182.28-.444.28-.72a1 1 0 0 0-1-1c-.276 0-.538.1-.72.28L6 4.563 1.72.282C1.537.1 1.275 0 1 0z"/></svg>'},355482:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 7" width="12" height="7"><path d="M1 7a1 1 0 0 1-1-1c0-.276.1-.538.28-.72l5-5C5.463.1 5.725 0 6 0c.276 0 .538.1.72.28l5 5c.18.182.28.444.28.72a1 1 0 0 1-1 1c-.276 0-.538-.1-.72-.28L6 2.437l-4.28 4.28C1.537 6.9 1.275 7 1 7z"/></svg>'},548927:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 9 9" width="9px" height="9px"><path d="M2 1L1 2l2.5 2.5L1 7l1 1 2.5-2.5L7 8l1-1-2.5-2.5L8 2 7 1 4.5 3.5z"/></svg>'}}]);